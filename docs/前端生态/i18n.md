### 为什么要做国际化

- 1、扩大用户基础：通过将应用程序翻译成多种语言，可以吸引更多的用户来使用您的产品或服务。不同语言和地区的用户能够以自己熟悉的语言使用应用程序，这有助于拓展用户基础并增加潜在的客户。

- 2、提升用户体验：国际化使得用户能够在自己的语言环境中使用应用程序，这提供了更好的用户体验。用户可以更容易地理解应用程序的界面、指令和内容，从而提高使用效率和满意度。

- 3、遵循法律法规：在一些国家或地区，有法律要求将应用程序提供给用户的语言进行本地化。通过进行国际化，您可以遵守这些法律法规，并确保您的应用程序在全球范围内合法运营。

- 4、方便公司出海战略实施

### 一般改造

项目中常见的国际化方案如下：
- 1、首先需要将项目中的中文提取成一个个的`json文件`,并且需要按照不同的语种来进行文件划分
- 2、其次需要将项目代码中原本的中文，替换成 `$t(...)`的形式
- 3、切换语种的时候，本地设置一个locale，然后重新刷新一下页面即可

<img src='@assets/i18/old.png' alt="center"  height="250" />


#### 存在的问题

虽然社区方案给我们带来了极大便利，但是仍有2个问题没有解决：

- 1、需要手工将代码中的主语言（比如中文）替换成国际化标记，导致查找相关代码时变得繁琐。
- 2、开发的时候，需要将中文写在配置文件里面，影响开发时候的效率。
- 3、语言包应该是一种配置，不必强耦合到项目代码里。


那么如何快速的改造老项目？如何规范新项目呢？

基于上述的几个问题，我们开发了一款国际化工具和国际化平台来实现项目的国际化快速改造。


### 工具流程

<img src='@assets/i18/new.png' alt="center"  height="250" />


我们的工具主要的流程如下：
- 1、首先初始化一个配置文件，配置文件主要包含的是我们工具运作的一些参数，比如入口，匹配的文件，关联的项目id
- 2、通过命令提取语料，全部提取到根目录项目的配置文件中

提取出来的文件：

```js
const langs = {
  "zh-cn": {
    "你好啊#!!!#src/app.vue_1": "你好啊",
    "你在干啥#!!!#src/app.vue_1": "你在干啥"
  },
}

globalThis.__tci18n_langs__ = langs

const getLocale = () => {
  const langs = [
    'zh-cn',
    'zh-tw',
    'zh-hk',
    'en-hk',
    'en-gb',
    'en-us',
    'ko-kr',
    'ja-jp',
    'fr-fr',
    'th-th',
    'ge-de',
    'ma-ms',
    'ar-ar',
    'it-it',
    'es-es',
    'po-pt',
    'bl-mj',
    'ru-ru'
  ];
  const navigatorLang = {
    'zh-CN': 'zh-cn',
    'zh-TW': 'zh-tw',
    'zh-HK': 'zh-hk',
    'en': 'en-us',
    'en-US': 'en-us',
    'en-GB': 'en-gb',
    'ko': 'ko-kr',
    'ko-KR': 'ko-kr',
    'ja': 'ja-jp',
    'ja-JP': 'ja-jp',
    'fr': 'fr-fr',
    'fr-BE': 'fr-fr',
    'fr-CA': 'fr-fr',
    'fr-LU': 'fr-fr',
    'th': 'th-th',
  };
  const locale = localStorage.getItem('tci18nLocale') || navigatorLang[navigator.language] || 'zh-cn';
  return langs.find((lang) => ~location.href.indexOf(lang)) || locale;
}

globalThis.__tci18n_locale__ = getLocale();
```

- 3、提取出来之后需要上传到我们研发的国际化平台上面 ，通过命令 `publish`发布到国际化平台上面去

- 4、在平台上面统一使用后端服务来一键翻译语料成不同的语种

- 5、复制语料链接，并通过`script`标签引入到本地项目中，这个时候，全局的window下面就会有一些语料资源

<img src='@assets/i18/language.png' alt="center"  height="250" />

- 6、项目中配置`webpack插件`或者`vite插件`，用于在运行时和构建时将中文动态替换成`$t(...)`的形式，开发者还是正常使用中文开发就行


优势：
- 1、开发者不需要手动提取语料和翻译，全部通过平台使用的谷歌或者百度等翻译工具
- 2、开发的时候还是用中文开发，只需要开发完成或者变更的时候重新提取一下语料
- 3、从0-1改造一个老项目国际化只需要5分钟
- 4、语言包和项目代码完全解耦。

### 工具流程原理

此处以`vue3`项目为例

#### 安装

1、安装脚手架工具

```js
npm install i18n-cli -g
```

2、在项目中安装以下依赖包

```js
npm install i18n-plugin i18n-vue3
```

#### 项目配置
1、初始化配置

```js
app-i18n init
```
这个时候项目的根目录会生成一个配置文件 : `i18n.config.js`

```js
module.exports = {
    entry: ['src/app.vue'],//入口
    exclude: [],//排除的文件
    disableAutoTranslate: true,//自动转换
    extractOnly: false,//是否只提取
    ignoreComponents: [],//忽略的组件
    ignoreMethods: [],//忽略的方法
    ignoreAttrs: ['style'],//忽略的树形，例如 vue绑定style="font-family:'微软雅黑'",这种正文是不能提取的
    supportedLocales: ['zh-cn', 'en-us'],//支持的语料(可忽略)
    importCode: "import { intl } from 'tci18n-intl';",
    i18nMethod: '$t',
    localeConf: { type: 'file', folder: 'locales' },
    vueVersion: 'vue3',//vue版本
    publishConfig: { projectId: 'xxxx', uploader: '测试', isDebug: true },//发布相关配置
};

```

2、语料提取

```js
app-i18n transform
```
`transform`之后，项目中就会生成一些语料文件，如下：
```js
const langs = {
  "zh-cn": {
    "你好啊#!!!#src/app.vue_1": "你好啊",
    "你在干啥#!!!#src/app.vue_1": "你在干啥"
  },
}

globalThis.__tci18n_langs__ = langs

const getLocale = () => {
  const langs = [
    'zh-cn',
    'zh-tw',
    'zh-hk',
    'en-hk',
    'en-gb',
    'en-us',
    'ko-kr',
    'ja-jp',
    'fr-fr',
    'th-th',
    'ge-de',
    'ma-ms',
    'ar-ar',
    'it-it',
    'es-es',
    'po-pt',
    'bl-mj',
    'ru-ru'
  ];
  const navigatorLang = {
    'zh-CN': 'zh-cn',
    'zh-TW': 'zh-tw',
    'zh-HK': 'zh-hk',
    'en': 'en-us',
    'en-US': 'en-us',
    'en-GB': 'en-gb',
    'ko': 'ko-kr',
    'ko-KR': 'ko-kr',
    'ja': 'ja-jp',
    'ja-JP': 'ja-jp',
    'fr': 'fr-fr',
    'fr-BE': 'fr-fr',
    'fr-CA': 'fr-fr',
    'fr-LU': 'fr-fr',
    'th': 'th-th',
  };
  const locale = localStorage.getItem('tci18nLocale') || navigatorLang[navigator.language] || 'zh-cn';
  return langs.find((lang) => ~location.href.indexOf(lang)) || locale;
}

globalThis.__tci18n_locale__ = getLocale();
```

那么这一步改如何实现呢？接下来我们来一起看看。




### 平台项目管理

### 语料管理（发布、修改）

### 架构

### 总结流程


### 问题
1、parse5 单标记
2、语料重复，需要加上行号标记
3、window和mac上面换行符需要转换一下 /