<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="前端技术相关的文章，包含不限于vue，react，webpack，nodejs，算法等等">
    
    <link rel="preload" href="/Study-Notes/assets/css/0.styles.a507757d.css" as="style"><link rel="preload" href="/Study-Notes/assets/js/app.8fe94d09.js" as="script"><link rel="preload" href="/Study-Notes/assets/js/2.a5eecbd5.js" as="script"><link rel="preload" href="/Study-Notes/assets/js/9.0066262c.js" as="script"><link rel="preload" href="/Study-Notes/assets/js/12.bb1ebd4b.js" as="script"><link rel="prefetch" href="/Study-Notes/assets/js/10.6454f97e.js"><link rel="prefetch" href="/Study-Notes/assets/js/11.b1417eb2.js"><link rel="prefetch" href="/Study-Notes/assets/js/13.1e88689a.js"><link rel="prefetch" href="/Study-Notes/assets/js/14.b2c10304.js"><link rel="prefetch" href="/Study-Notes/assets/js/15.18fe2232.js"><link rel="prefetch" href="/Study-Notes/assets/js/16.d0194a52.js"><link rel="prefetch" href="/Study-Notes/assets/js/17.cc9fb53a.js"><link rel="prefetch" href="/Study-Notes/assets/js/18.ff4af688.js"><link rel="prefetch" href="/Study-Notes/assets/js/19.48d1bcfd.js"><link rel="prefetch" href="/Study-Notes/assets/js/20.3248e0f2.js"><link rel="prefetch" href="/Study-Notes/assets/js/21.8d4aabb4.js"><link rel="prefetch" href="/Study-Notes/assets/js/22.585aeb72.js"><link rel="prefetch" href="/Study-Notes/assets/js/23.c12a955e.js"><link rel="prefetch" href="/Study-Notes/assets/js/24.9dcada00.js"><link rel="prefetch" href="/Study-Notes/assets/js/25.3230bfb6.js"><link rel="prefetch" href="/Study-Notes/assets/js/26.db84daab.js"><link rel="prefetch" href="/Study-Notes/assets/js/27.defaf7af.js"><link rel="prefetch" href="/Study-Notes/assets/js/28.84648c33.js"><link rel="prefetch" href="/Study-Notes/assets/js/29.42aec3fe.js"><link rel="prefetch" href="/Study-Notes/assets/js/3.2f2f00fb.js"><link rel="prefetch" href="/Study-Notes/assets/js/30.22589c71.js"><link rel="prefetch" href="/Study-Notes/assets/js/31.11e99417.js"><link rel="prefetch" href="/Study-Notes/assets/js/32.e75c36b7.js"><link rel="prefetch" href="/Study-Notes/assets/js/33.0ba13b52.js"><link rel="prefetch" href="/Study-Notes/assets/js/34.2248d636.js"><link rel="prefetch" href="/Study-Notes/assets/js/35.2a12c760.js"><link rel="prefetch" href="/Study-Notes/assets/js/36.357b5f40.js"><link rel="prefetch" href="/Study-Notes/assets/js/37.ad574aef.js"><link rel="prefetch" href="/Study-Notes/assets/js/38.bbee820e.js"><link rel="prefetch" href="/Study-Notes/assets/js/39.9fa301ad.js"><link rel="prefetch" href="/Study-Notes/assets/js/4.22a0137d.js"><link rel="prefetch" href="/Study-Notes/assets/js/40.6a1b67e3.js"><link rel="prefetch" href="/Study-Notes/assets/js/41.49311c69.js"><link rel="prefetch" href="/Study-Notes/assets/js/42.45abae62.js"><link rel="prefetch" href="/Study-Notes/assets/js/43.c1a83a20.js"><link rel="prefetch" href="/Study-Notes/assets/js/5.69b1b6f7.js"><link rel="prefetch" href="/Study-Notes/assets/js/6.090f4592.js"><link rel="prefetch" href="/Study-Notes/assets/js/7.0e3a508b.js"><link rel="prefetch" href="/Study-Notes/assets/js/8.c878dc76.js">
    <link rel="stylesheet" href="/Study-Notes/assets/css/0.styles.a507757d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Study-Notes/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Study-Notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/Study-Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Study-Notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/Study-Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Study-Notes/" aria-current="page" class="sidebar-link">主页</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/JavaScript/小顶堆.html" class="sidebar-link">小顶堆</a></li><li><a href="/Study-Notes/JavaScript/位运算.html" class="sidebar-link">位运算</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>React Fiber</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/React/React-Fiber/React理念.html" class="sidebar-link">React理念</a></li><li><a href="/Study-Notes/React/React-Fiber/ReactFiber架构.html" class="sidebar-link">Fiber架构</a></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>React Fiber Render</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/beginWork.html" class="sidebar-link">beginWork阶段</a></li><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/completeWork.html" class="sidebar-link">completeWork阶段</a></li><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/commit.html" class="sidebar-link">commit阶段</a></li><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/domdiff.html" class="sidebar-link">completeWork-diff阶段</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>Concurrent Mode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/React/Concurrent-Mode/React中的事件优先级调度.html" class="sidebar-link">React事件优先级调度</a></li><li><a href="/Study-Notes/React/Concurrent-Mode/scheduler.html" class="sidebar-link">scheduler具体实现</a></li><li><a href="/Study-Notes/React/Concurrent-Mode/lane.html" class="sidebar-link">lane模型</a></li></ul></section></li><li><a href="/Study-Notes/React/React17.html" class="sidebar-link">React17</a></li><li><a href="/Study-Notes/React/React18.html" class="sidebar-link">React18</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/Vue/Vue3+Typescript实现Form组件.html" class="sidebar-link">Vue3+Typescript实现Form组件</a></li><li><a href="/Study-Notes/Vue/搭建vue3和ts组件库开发环境.html" class="sidebar-link">搭建vue3和ts组件库开发环境</a></li><li><a href="/Study-Notes/Vue/Vite2配置项目开发环境.html" class="sidebar-link">Vite2配置项目开发环境</a></li><li><a href="/Study-Notes/Vue/基于Element-plus实现虚拟下拉组件.html" class="sidebar-link">基于Element-plus实现虚拟下拉组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端生态</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/前端生态/eslint.html" class="sidebar-link">eslint</a></li><li><a href="/Study-Notes/前端生态/flutter实践.html" class="sidebar-link">flutter实践</a></li><li><a href="/Study-Notes/前端生态/flutter消息推送.html" class="active sidebar-link">flutter消息推送</a></li><li><a href="/Study-Notes/前端生态/antd5架构分析.html" class="sidebar-link">antd5研究</a></li><li><a href="/Study-Notes/前端生态/element-plus架构分析.html" class="sidebar-link">element-plus样式+打包分析</a></li><li><a href="/Study-Notes/前端生态/ts类型打包.html" class="sidebar-link">ts类型打包</a></li><li><a href="/Study-Notes/前端生态/vscode扩展工具.html" class="sidebar-link">vscode扩展工具实现</a></li><li><a href="/Study-Notes/前端生态/svelte.html" class="sidebar-link">svelte框架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>go</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/go/mac如何安装grpc.html" class="sidebar-link">mac安装grpc</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>最近由于公司内部需求，之前用<code>flutter</code>开发了一款<code>app应用</code>，本次需要做消息推送的功能，所谓消息推送功能，就是<code>app</code>端能够接收到 平台的推送信息，然后在手机上面提示出来，或者可以在<code>app</code>图标右上角显示一个未读的消息数量，类似于如下图这种功能：</p> <img src="/Study-Notes/assets/img/one.939dd4b7.png" alt="center" height="150"> <img src="/Study-Notes/assets/img/two.23bd9f74.jpg" alt="center" height="150"> <p>本次我就以接入小米的<code>推送sdk</code>为例来进行讲解，要想完成小米的<code>sdk</code>接入并一个完整的推送流程需要完成以下几个步骤：</p> <ul><li>1、注册<a href="https://dev.mi.com/platform" target="_blank" rel="noopener noreferrer">小米开发平台<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>账号</li> <li>2、上架 <code>app</code></li> <li>3、<code>Flutter</code>端接入小米推送<code>sdk</code></li> <li>4、<code>Flutter</code>端实现与sdk通信，处理逻辑</li> <li>4、<code>Flutter</code>端将 获取到的<code>regId</code>传递给后端服务，用于后续后端服务发送推送消息</li> <li>5、服务端保存app应用端传递过来的 <code>regId</code>，并且接入小米推送服务，给指定<code>regId</code>的应用或者全部应用发送消息</li></ul> <p>下面我们说说如何在<code>flutter</code>端接入小米推送sdk，并且获取到推送消息:</p> <p>我们可以在此处查看相关的<a href="https://dev.mi.com/distribute/doc/details?pId=1544" target="_blank" rel="noopener noreferrer">接入步骤<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h4 id="下载mipush-android客户端sdk软件包"><a href="#下载mipush-android客户端sdk软件包" class="header-anchor">#</a> 下载MiPush Android客户端SDK软件包</h4> <p><code>MiPush Android客户端SDK</code>从<code>5.0.1</code>版本开始，提供<code>AAR</code>包接入方式，其支持的最低<code>Android SDK</code>版本为<code>19</code>,</p> <p><a href="https://admin.xmpush.xiaomi.com/zh_CN/mipush/downpage" target="_blank" rel="noopener noreferrer">sdk下载地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>;</p> <p>下载下来之后可以先放在一个文件夹中：</p> <img src="data:image/png;base64,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" alt="center" height="150"> <h4 id="配置-build-gradle"><a href="#配置-build-gradle" class="header-anchor">#</a> 配置 <code>build.gradle</code></h4> <p>在安卓开发中，<code>build.gradle</code> 文件是一个用于配置和构建 <code>Android</code> 项目的重要文件。它是 <code>Gradle</code> 构建系统的配置文件，用于定义项目的构建设置和依赖关系。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//android 块中的 repositories 部分，通过配置 flatDir 仓库，指定了一个本地目录 'libs'。这意味着在该目录下的库文件（如 .aar 文件）可以被项目引用。</span>
android<span class="token punctuation">{</span>
    repositories <span class="token punctuation">{</span>
        flatDir <span class="token punctuation">{</span>
            dirs <span class="token string">'libs'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// implementation 关键字引用sdk </span>
dependencies <span class="token punctuation">{</span>
    <span class="token function">implementation</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token string">'MiPush_SDK_Client_xxx'</span><span class="token punctuation">,</span> <span class="token literal-property property">ext</span><span class="token operator">:</span> <span class="token string">'aar'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="引入推送代码"><a href="#引入推送代码" class="header-anchor">#</a> 引入推送代码</h4> <p>相关常量文件 <code>XiaomiBaseConstants.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">xxxx</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaomiBaseConstants</span> <span class="token punctuation">{</span>

    <span class="token comment">//日志tag</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG<span class="token operator">=</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">//小米后台的App_ID</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> APP_ID<span class="token operator">=</span><span class="token string">&quot;APP_ID&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">//小米后台的App_KEY</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> APP_KEY<span class="token operator">=</span><span class="token string">&quot;APP_KEY&quot;</span><span class="token punctuation">;</span>


    <span class="token comment">//Flutter 和Android  互相通信的通道</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> PUSH_MSG_METHOD_CHANEL<span class="token operator">=</span><span class="token string">&quot;com.push.xiaomi.msg.method&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> PUSH_MSG_EVENT_CHANEL<span class="token operator">=</span><span class="token string">&quot;com.push.xiaomi.msg.event&quot;</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>注册推送服务</p> <p>通过调用<code>MiPushClient.registerPush</code>来注册小米推送服务。注册成功后，您可以在自定义的<code>onCommandResult和onReceiveRegisterResult</code>中收到注册结果，其中的regId即是当前设备上当前app的唯一标示。您可以将regId上传到自己的服务器，方便向其发消息。</p> <p>为了提高push的注册率，您可以在 <code>Application的onCreate中注册push</code>。您也可以根据需要，在其他地方注册<code>push</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">xxx</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">ActivityManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">ActivityManager</span><span class="token punctuation">.</span><span class="token class-name">RunningAppProcessInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Application</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Handler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Process</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">TextUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Toast</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>channel<span class="token punctuation">.</span>commonutils<span class="token punctuation">.</span>logger<span class="token punctuation">.</span></span><span class="token class-name">LoggerInterface</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">MiPushClient</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaomiMessagePushApplication</span> <span class="token keyword">extends</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token comment">// user your appid the key.</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> APP_ID <span class="token operator">=</span> <span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>APP_ID<span class="token punctuation">;</span>
    <span class="token comment">// user your appid the key.</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> APP_KEY <span class="token operator">=</span> <span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>APP_KEY<span class="token punctuation">;</span>

    <span class="token comment">// 此TAG在adb logcat中检索自己所需要的信息， 只需在命令行终端输入 adb logcat | grep</span>
    <span class="token comment">// com.tongcheng.tcqf</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DemoHandler</span> sHandler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MainActivity</span> sMainActivity <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 注册push服务，注册成功后会向XiaomiMessagePush发送广播</span>
        <span class="token comment">// 可以从XiaomiMessagePush的onCommandResult方法中MiPushCommandMessage对象参数中获取注册信息</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isMainProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//此处需要判断是不是小米</span>
            <span class="token class-name">MiPushClient</span><span class="token punctuation">.</span><span class="token function">registerPush</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> APP_ID<span class="token punctuation">,</span> APP_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">LoggerInterface</span> newLogger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggerInterface</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTag</span><span class="token punctuation">(</span><span class="token class-name">String</span> tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// ignore</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> content<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token function">setLogger</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> newLogger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sHandler <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            sHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DemoHandler</span><span class="token punctuation">(</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//判断是否在主线程</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isMainProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ActivityManager</span> am <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ActivityManager</span><span class="token punctuation">)</span> <span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>ACTIVITY_SERVICE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RunningAppProcessInfo</span><span class="token punctuation">&gt;</span></span> processInfos <span class="token operator">=</span> am<span class="token punctuation">.</span><span class="token function">getRunningAppProcesses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> mainProcessName <span class="token operator">=</span> <span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> myPid <span class="token operator">=</span> <span class="token class-name">Process</span><span class="token punctuation">.</span><span class="token function">myPid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">RunningAppProcessInfo</span> info <span class="token operator">:</span> processInfos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>info<span class="token punctuation">.</span>pid <span class="token operator">==</span> myPid <span class="token operator">&amp;&amp;</span> mainProcessName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>processName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">DemoHandler</span> <span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> sHandler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setMainActivity</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span> activity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//保存主活动的上下文</span>
        sMainActivity <span class="token operator">=</span> activity<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//继承handler，用于处理消息</span>
    <span class="token comment">//在安卓中Handler 主要用于消息传递和处理</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">DemoHandler</span> <span class="token keyword">extends</span> <span class="token class-name">Handler</span> <span class="token punctuation">{</span>

        <span class="token keyword">private</span> <span class="token class-name">Context</span> context<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">DemoHandler</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//重写 handleMessage方法</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> msg<span class="token punctuation">.</span>obj<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>sMainActivity <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> sMainActivity<span class="token punctuation">.</span>eventSink <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//调用主活动的 eventChannel向flutter端发送消息</span>
                sMainActivity<span class="token punctuation">.</span>eventSink<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> s<span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_LONG<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>推送相关代码，定义一个类接收推送消息，<code>XiaomiMessagePush.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">xxxx</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">SuppressLint</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">TextUtils</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">SharedPreferences</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">ErrorCode</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">MiPushClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">MiPushCommandMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">MiPushMessage</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">PushMessageReceiver</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>text<span class="token punctuation">.</span></span><span class="token class-name">SimpleDateFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 1、PushMessageReceiver 是个抽象类，该类继承了 BroadcastReceiver。&lt;br/&gt;
 * 2、需要将自定义的 XiaomiMessagePush 注册在 AndroidManifest.xml 文件中：
 * &lt;pre&gt;
 * {@code
 *  &lt;receiver
 *      android:name=&quot;com.xiaomi.mipushdemo.XiaomiMessagePush&quot;
 *      android:exported=&quot;true&quot;&gt;
 *      &lt;intent-filter&gt;
 *          &lt;action android:name=&quot;com.xiaomi.mipush.RECEIVE_MESSAGE&quot; /&gt;
 *      &lt;/intent-filter&gt;
 *      &lt;intent-filter&gt;
 *          &lt;action android:name=&quot;com.xiaomi.mipush.MESSAGE_ARRIVED&quot; /&gt;
 *      &lt;/intent-filter&gt;
 *      &lt;intent-filter&gt;
 *          &lt;action android:name=&quot;com.xiaomi.mipush.ERROR&quot; /&gt;
 *      &lt;/intent-filter&gt;
 *  &lt;/receiver&gt;
 *  }&lt;/pre&gt;
 * 3、XiaomiMessagePush 的 onReceivePassThroughMessage 方法用来接收服务器向客户端发送的透传消息。&lt;br/&gt;
 * 4、XiaomiMessagePush 的 onNotificationMessageClicked 方法用来接收服务器向客户端发送的通知消息，
 * 这个回调方法会在用户手动点击通知后触发。&lt;br/&gt;
 * 5、XiaomiMessagePush 的 onNotificationMessageArrived 方法用来接收服务器向客户端发送的通知消息，
 * 这个回调方法是在通知消息到达客户端时触发。另外应用在前台时不弹出通知的通知消息到达客户端也会触发这个回调函数。&lt;br/&gt;
 * 6、XiaomiMessagePush 的 onCommandResult 方法用来接收客户端向服务器发送命令后的响应结果。&lt;br/&gt;
 * 7、XiaomiMessagePush 的 onReceiveRegisterResult 方法用来接收客户端向服务器发送注册命令后的响应结果。&lt;br/&gt;
 * 8、以上这些方法运行在非 UI 线程中。
 *
 * @author mayixiang
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">XiaomiMessagePush</span> <span class="token keyword">extends</span> <span class="token class-name">PushMessageReceiver</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> mRegId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mTopic<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mAlias<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mAccount<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mStartTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mEndTime<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceivePassThroughMessage</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">MiPushMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onReceivePassThroughMessage</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span>
                <span class="token string">&quot;onReceivePassThroughMessage is called. &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>recv_passthrough_message<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mTopic <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mAlias <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span>obj <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//发送数据</span>
        <span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNotificationMessageClicked</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">MiPushMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span>
                <span class="token string">&quot;onNotificationMessageClicked is called. &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>click_notification_message<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mTopic <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mAlias <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">isNotified</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            msg<span class="token punctuation">.</span>obj <span class="token operator">=</span> log<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
         <span class="token comment">//发送数据</span>
        <span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNotificationMessageArrived</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">MiPushMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onNotificationMessageArrived</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span>
                <span class="token string">&quot;onNotificationMessageArrived is called. &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>arrive_notification_message<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mTopic <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getTopic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mAlias <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span>obj <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token comment">//发送数据</span>
        <span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCommandResult</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">MiPushCommandMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span>
                <span class="token string">&quot;onCommandResult is called. &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> command <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> arguments <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getCommandArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> cmdArg1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>arguments <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> arguments<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> cmdArg2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>arguments <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">?</span> arguments<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_REGISTER<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRegId <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>register_success<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>register_fail<span class="token punctuation">)</span> <span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_SET_ALIAS<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mAlias <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>set_alias_success<span class="token punctuation">,</span> mAlias<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>set_alias_fail<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_UNSET_ALIAS<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mAlias <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>unset_alias_success<span class="token punctuation">,</span> mAlias<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>unset_alias_fail<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_SET_ACCOUNT<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mAccount <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>set_account_success<span class="token punctuation">,</span> mAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>set_account_fail<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_UNSET_ACCOUNT<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mAccount <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>unset_account_success<span class="token punctuation">,</span> mAccount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>unset_account_fail<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_SUBSCRIBE_TOPIC<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mTopic <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>subscribe_topic_success<span class="token punctuation">,</span> mTopic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>subscribe_topic_fail<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_UNSUBSCRIBE_TOPIC<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mTopic <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>unsubscribe_topic_success<span class="token punctuation">,</span> mTopic<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>unsubscribe_topic_fail<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_SET_ACCEPT_TIME<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mStartTime <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                mEndTime <span class="token operator">=</span> cmdArg2<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>set_accept_time_success<span class="token punctuation">,</span> mStartTime<span class="token punctuation">,</span> mEndTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>set_accept_time_fail<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span>obj <span class="token operator">=</span> log<span class="token punctuation">;</span>
        <span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceiveRegisterResult</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">MiPushCommandMessage</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span>
                <span class="token string">&quot;onReceiveRegisterResult is called. &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> command <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> arguments <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getCommandArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> cmdArg1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>arguments <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> arguments<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> log<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MiPushClient</span><span class="token punctuation">.</span>COMMAND_REGISTER<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span><span class="token function">getResultCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">ErrorCode</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRegId <span class="token operator">=</span> cmdArg1<span class="token punctuation">;</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>register_success<span class="token punctuation">)</span> <span class="token operator">+</span> cmdArg1<span class="token punctuation">;</span>
                <span class="token comment">//保存RegisId</span>
                <span class="token function">saveRegisterId</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>mRegId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                log <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>register_fail<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            log <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Message</span> msg <span class="token operator">=</span> <span class="token class-name">Message</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        msg<span class="token punctuation">.</span>obj <span class="token operator">=</span> log<span class="token punctuation">;</span>
        <span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span><span class="token function">getHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@SuppressLint</span><span class="token punctuation">(</span><span class="token string">&quot;SimpleDateFormat&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getSimpleDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">&quot;MM-dd hh:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

        <span class="token comment">//保存参数 保存regId</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveRegisterId</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span><span class="token class-name">String</span> regId<span class="token punctuation">)</span><span class="token punctuation">{</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token operator">==</span>context<span class="token operator">||</span>regId<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>
         <span class="token comment">//用于存储数据</span>
        <span class="token class-name">SharedPreferences</span> preferences <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>DATA_Reg</span><span class="token punctuation">,</span><span class="token class-name">Context</span><span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取一个可编辑的 Editor 对象</span>
        <span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor<span class="token operator">=</span> preferences<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将注册推送标识 regId 存储到 SharedPreferences 中，使用名为 BaseConstants.RegIdTag 的键</span>
        editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>RegIdTag</span><span class="token punctuation">,</span>regId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//提交编辑操作，将数据保存到 SharedPreferences 中。</span>
        editor<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre></div><p>接下来需要在你的<code>MainActivity.java</code>文件中修改相关代码，需要初始化相关的<code>eventChannel</code>和<code>methodChannel</code>，这样才能和<code>flutter</code>端通信；</p> <ul><li><code>eventChannel</code> 用于在 <code>Flutter</code> 和安卓原生之间进行事件的单向通信。通过 <code>EventChannel</code>，安卓原生代码可以向 <code>Flutter</code> 发送事件，而 <code>Flutter</code> 可以通过监听事件通道接收这些事件</li> <li><code>methodChannel</code> 用于在 <code>Flutter</code> 和安卓原生之间进行双向通信。通过 <code>MethodChannel</code>,<code>Flutter</code> 可以调用安卓原生代码的方法，并获取返回结果。同时，安卓原生代码也可以通过 <code>MethodChannel</code> 向 <code>Flutter</code> 发送消息。</li></ul> <p><code>MainActivity.java</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">xxx</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Activity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Intent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AlertDialog</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">.</span><span class="token class-name">OnClickListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">DialogInterface</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">NonNull</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">androidx<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Nullable</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Toast</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">SharedPreferences</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Handler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Build</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>tc_flutter_webview<span class="token punctuation">.</span></span><span class="token class-name">ActivityResultListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>tc_flutter_webview<span class="token punctuation">.</span></span><span class="token class-name">TcFlutterWebviewHelp</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>tc_flutter_webview<span class="token punctuation">.</span></span><span class="token class-name">TcPermissionsResultListener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>tc_flutter_webview<span class="token punctuation">.</span></span><span class="token class-name">TcWebViewDelegate</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">EventChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">MethodChannel</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>plugin<span class="token punctuation">.</span>common<span class="token punctuation">.</span></span><span class="token class-name">MethodCall</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">EditText</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">CopyOnWriteArrayList</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>xiaomi<span class="token punctuation">.</span>mipush<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span></span><span class="token class-name">MiPushClient</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>embedding<span class="token punctuation">.</span>android<span class="token punctuation">.</span></span><span class="token class-name">FlutterActivity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>flutter<span class="token punctuation">.</span>embedding<span class="token punctuation">.</span>android<span class="token punctuation">.</span></span><span class="token class-name">FlutterView</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">FlutterActivity</span> <span class="token keyword">implements</span> <span class="token class-name">TcWebViewDelegate</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token class-name">EventChannel<span class="token punctuation">.</span>EventSink</span> eventSink<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取设备信息</span>
        <span class="token function">_getDeviceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取消息逻辑</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getPushReceiveMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SharedPreferences</span> preferences <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>DATA_Push</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> data <span class="token operator">=</span> preferences<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>PushTag</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> preferences<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//清理数据</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            editor<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>PushTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            editor<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>



    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">String</span> eventChannelName<span class="token punctuation">,</span><span class="token class-name">String</span> methodChannelName<span class="token punctuation">,</span><span class="token class-name">String</span> <span class="token class-name">DATA_Reg</span><span class="token punctuation">,</span><span class="token class-name">String</span> <span class="token class-name">RegIdTag</span><span class="token punctuation">,</span><span class="token class-name">String</span> <span class="token class-name">DATA_Push</span><span class="token punctuation">,</span><span class="token class-name">String</span> <span class="token class-name">PushTag</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//初始化EventChannel，用于通过 eventSink 向flutter端发送消息，flutter端需要通过receiveBroadcastStream来接收</span>
        <span class="token keyword">new</span> <span class="token class-name">EventChannel</span><span class="token punctuation">(</span><span class="token function">getFlutterEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDartExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBinaryMessenger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> eventChannelName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setStreamHandler</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">EventChannel<span class="token punctuation">.</span>StreamHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//onListen 方法会在 Flutter 端开始监听事件通道时执行。具体地说，当你在 Flutter 代码中调用 //  EventChannel 实例的 receiveBroadcastStream() 方法来监听事件通道时，onListen 方法会被触发</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onListen</span><span class="token punctuation">(</span><span class="token class-name">Object</span> arguments<span class="token punctuation">,</span> <span class="token class-name">EventChannel<span class="token punctuation">.</span>EventSink</span> events<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// 初始化</span>
                        eventSink <span class="token operator">=</span> events<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCancel</span><span class="token punctuation">(</span><span class="token class-name">Object</span> arguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        

        <span class="token comment">//注册方法通道MethodChannel</span>
        <span class="token keyword">new</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">(</span>
                <span class="token function">getFlutterEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDartExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBinaryMessenger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> methodChannelName
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMethodCallHandler</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">MethodChannel<span class="token punctuation">.</span>MethodCallHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//监听方法调用</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onMethodCall</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">MethodCall</span> call<span class="token punctuation">,</span> <span class="token annotation punctuation">@NonNull</span> <span class="token class-name">MethodChannel<span class="token punctuation">.</span>Result</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span>call<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;getReciveData&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token function">getPushReceiveMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>call<span class="token punctuation">.</span>method<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">&quot;getXiaoMiRegId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token class-name">String</span> regId <span class="token operator">=</span> <span class="token function">getRegId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>regId<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>regId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                                result<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">&quot;没有获取到RegId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            result<span class="token punctuation">.</span><span class="token function">notImplemented</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//存贮 从被杀死的应用点击通知，传进来的参数</span>
         <span class="token function">saveIntentData</span><span class="token punctuation">(</span><span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">_getDeviceInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//获取设备信息</span>
        <span class="token class-name">String</span> manufacturer <span class="token operator">=</span> <span class="token class-name">Build</span><span class="token punctuation">.</span>MANUFACTURER<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>manufacturer<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">&quot;XIAOMI&quot;</span><span class="token operator">:</span>
                <span class="token comment">// 处理小米的逻辑</span>
                <span class="token function">initChannel</span><span class="token punctuation">(</span><span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>PUSH_MSG_EVENT_CHANEL<span class="token punctuation">,</span><span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>PUSH_MSG_METHOD_CHANEL<span class="token punctuation">,</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>DATA_Reg</span><span class="token punctuation">,</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>RegIdTag</span><span class="token punctuation">,</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>DATA_Push</span><span class="token punctuation">,</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>PushTag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&quot;OPPO&quot;</span><span class="token operator">:</span>
                <span class="token comment">// 处理OPPO的逻辑</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">&quot;VIVO&quot;</span><span class="token operator">:</span>
                 <span class="token comment">// 处理VIVO的逻辑</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//存储消息的逻辑</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">saveIntentData</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> intent <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span><span class="token function">getExtras</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>Extras</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> content <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>Extras</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;save receive data from push, data = &quot;</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SharedPreferences</span> preferences <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>DATA_Push</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">SharedPreferences<span class="token punctuation">.</span>Editor</span> editor <span class="token operator">=</span> preferences<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            editor<span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>PushTag</span><span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
            editor<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;存储消息错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
    <span class="token comment">//获取注册Id</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getRegId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">SharedPreferences</span> preferences <span class="token operator">=</span> <span class="token function">getSharedPreferences</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>DATA_Reg</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> data <span class="token operator">=</span> preferences<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>RegIdTag</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;getReciveData&quot;</span><span class="token operator">+</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onNewIntent</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onNewIntent</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;onNewIntent&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> intent<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//应用处于前台时，直接通过eventChanel 通知flutter</span>

        <span class="token comment">//获取intentData</span>
        <span class="token function">getIntentData</span><span class="token punctuation">(</span>intent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取intentData</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">getIntentData</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> intent <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span><span class="token function">getExtras</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>Extras</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token class-name">String</span> content <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token class-name">BaseConstants<span class="token punctuation">.</span>Extras</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;save receive data from push, data = &quot;</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">pushMsgEvent</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token class-name">XiaomiBaseConstants</span><span class="token punctuation">.</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;intent is null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

   <span class="token comment">//发送消息至flutter</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pushMsgEvent</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">postDelayed</span><span class="token punctuation">(</span>
                <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>eventSink <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">//发送消息</span>
                            eventSink<span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//注销</span>
        <span class="token class-name">XiaomiMessagePushApplication</span><span class="token punctuation">.</span><span class="token function">setMainActivity</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="配置-androidmanifest"><a href="#配置-androidmanifest" class="header-anchor">#</a> 配置 <code>AndroidManifest</code></h4> <p>接下来我们需要配置<code>AndroidManifest.xml</code></p> <div class="language-xml extra-class"><pre class="language-xml"><code>   <span class="token comment">&lt;!-- xiao mi service  --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.push.service.XMPushService<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>process</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>:pushservice<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!--注：此service必须在3.0.1版本以后（包括3.0.1版本）加入--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.push.service.XMJobService<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>permission</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.permission.BIND_JOB_SERVICE<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>process</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>:pushservice<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.mipush.sdk.PushMessageHandler<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token comment">&lt;!--注：此service必须在2.2.5版本以后（包括2.2.5版本）加入--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>service</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.mipush.sdk.MessageHandleService<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>enabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span>
            <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.push.service.receivers.NetworkStatusReceiver<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.net.conn.CONNECTIVITY_CHANGE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>category</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>android.intent.category.DEFAULT<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- //声明一个接收小米推送消息的广播接收器 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>receiver</span>
          <span class="token attr-name"><span class="token namespace">android:</span>exported</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.tongcheng.tcqf.XiaomiMessagePush<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.mipush.RECEIVE_MESSAGE<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.mipush.MESSAGE_ARRIVED<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>action</span> <span class="token attr-name"><span class="token namespace">android:</span>name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>com.xiaomi.mipush.ERROR<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>intent-filter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>receiver</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="flutter端接受消息"><a href="#flutter端接受消息" class="header-anchor">#</a> <code>flutter</code>端接受消息</h4> <div class="language-dart extra-class"><pre class="language-dart"><code><span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'dart:io'</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:myPackage/http/app_service.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:myPackage/utils/app_badger_util.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:flutter/services.dart'</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string-literal"><span class="token string">'package:device_info_plus/device_info_plus.dart'</span></span><span class="token punctuation">;</span>

<span class="token comment">//小米</span>
<span class="token keyword">class</span> <span class="token class-name">Xiaomi_Push_Event_Channel</span> <span class="token punctuation">{</span>
  <span class="token class-name">String</span> <span class="token class-name">Xiaomi_PUSH_MSG_METHOD_CHANEL</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;com.push.xiaomi.msg.method&quot;</span></span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> <span class="token class-name">Xiaomi_PUSH_MSG_EVENT_CHANEL</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;com.push.xiaomi.msg.event&quot;</span></span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> <span class="token class-name">Xiaomi_RegId_Event</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;getXiaoMiRegId&quot;</span></span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> <span class="token class-name">Xiaomi_ReceiveData_Event</span> <span class="token operator">=</span> <span class="token string-literal"><span class="token string">&quot;getReciveData&quot;</span></span><span class="token punctuation">;</span>

  late <span class="token class-name">MethodChannel</span> methodChannel<span class="token punctuation">;</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token keyword">void</span><span class="token punctuation">&gt;</span></span> <span class="token function">initChanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    methodChannel <span class="token operator">=</span> <span class="token class-name">MethodChannel</span><span class="token punctuation">(</span><span class="token class-name">Xiaomi_PUSH_MSG_METHOD_CHANEL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">EventChannel</span> <span class="token class-name">XiaoMiEventChannel</span> <span class="token operator">=</span>
        <span class="token class-name">EventChannel</span><span class="token punctuation">(</span><span class="token class-name">Xiaomi_PUSH_MSG_EVENT_CHANEL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//注册监听</span>
    <span class="token class-name">XiaoMiEventChannel</span><span class="token punctuation">.</span><span class="token function">receiveBroadcastStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">dynamic</span> msgData<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;XiaoMiDataChannel ----&gt;&quot;</span></span> <span class="token operator">+</span> msgData<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//跳转自己的页面逻辑</span>
      <span class="token class-name">App_Message_Badger</span><span class="token punctuation">.</span><span class="token function">setNewMessageBadgeCount</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'new'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// doSomeThing();</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> onError<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">&quot;XiaoMiDataChannel----&gt;&quot;</span></span> <span class="token operator">+</span> error<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getXiaoMiRegId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment">//方法名也和Android定义的一至</span>
    <span class="token class-name">String</span> regId <span class="token operator">=</span> <span class="token keyword">await</span> methodChannel<span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span><span class="token class-name">Xiaomi_RegId_Event</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'regId===</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">regId</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>regId<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> regId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getReciveData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token comment">//方法名也和Android定义的一至</span>
    <span class="token class-name">String</span> receiveData <span class="token operator">=</span>
        <span class="token keyword">await</span> methodChannel<span class="token punctuation">.</span><span class="token function">invokeMethod</span><span class="token punctuation">(</span><span class="token class-name">Xiaomi_ReceiveData_Event</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'reciveData===</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">receiveData</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>receiveData<span class="token punctuation">.</span>isEmpty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> receiveData<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Push_Event_channel</span> <span class="token punctuation">{</span>
  <span class="token class-name">AppService</span> appService <span class="token operator">=</span> <span class="token class-name">AppService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Push_Event_channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> manufacture <span class="token operator">=</span> <span class="token string-literal"><span class="token string">''</span></span><span class="token punctuation">;</span>
    <span class="token class-name">DeviceInfoPlugin</span> deviceInfo <span class="token operator">=</span> <span class="token class-name">DeviceInfoPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Platform</span><span class="token punctuation">.</span>isIOS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      manufacture <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'APPLE'</span></span><span class="token punctuation">;</span>
      <span class="token comment">//ios相关代码</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token class-name">AndroidDeviceInfo</span> androidInfo <span class="token operator">=</span> <span class="token keyword">await</span> deviceInfo<span class="token punctuation">.</span>androidInfo<span class="token punctuation">;</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span>androidInfo<span class="token punctuation">.</span>manufacturer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">'HUAWEI'</span></span><span class="token punctuation">:</span>
          manufacture <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'HW'</span></span><span class="token punctuation">;</span>
          <span class="token class-name">Xiaomi_Push_Event_Channel</span> xiaomi_channel <span class="token operator">=</span>
              <span class="token class-name">Xiaomi_Push_Event_Channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">await</span> xiaomi_channel<span class="token punctuation">.</span><span class="token function">initChanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">String</span> regId <span class="token operator">=</span> <span class="token keyword">await</span> xiaomi_channel<span class="token punctuation">.</span><span class="token function">getXiaoMiRegId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'获取到的华为==》小米推送id：</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">regId</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// _registerInfoToService(regId, manufacture);</span>
          <span class="token comment">// print('获取到的华为==》小米推送id：${regId}');</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">'XIAOMI'</span></span><span class="token punctuation">:</span>
          manufacture <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'MI'</span></span><span class="token punctuation">;</span>
          <span class="token class-name">Xiaomi_Push_Event_Channel</span> xiaomi_channel <span class="token operator">=</span>
              <span class="token class-name">Xiaomi_Push_Event_Channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">await</span> xiaomi_channel<span class="token punctuation">.</span><span class="token function">initChanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">String</span> regId <span class="token operator">=</span> <span class="token keyword">await</span> xiaomi_channel<span class="token punctuation">.</span><span class="token function">getXiaoMiRegId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'获取到的小米推送id：</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">regId</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">&quot;OPPO&quot;</span></span><span class="token punctuation">:</span>
          manufacture <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'OPPO'</span></span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string-literal"><span class="token string">&quot;VIVO&quot;</span></span><span class="token punctuation">:</span>
          manufacture <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'VIVO'</span></span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'安卓设备:</span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">androidInfo</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> manufacture<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token comment">//向服务端传递注册信息</span>
  <span class="token function">_registerInfoToService</span><span class="token punctuation">(</span><span class="token class-name">String</span> regId<span class="token punctuation">,</span> <span class="token class-name">String</span> manufacture<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string-literal"><span class="token string">&quot;mobileType&quot;</span></span><span class="token punctuation">:</span> manufacture<span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">&quot;regId&quot;</span></span><span class="token punctuation">:</span> regId<span class="token punctuation">}</span><span class="token punctuation">;</span>
    appService<span class="token punctuation">.</span><span class="token function">registerAppAndDeviceInfo</span><span class="token punctuation">(</span>params<span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'app注册成功 </span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">data</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接入成功后，我们就可以在小米的开发者后台中来测试，可以向指定的<code>regId</code>发送推送消息</p> <img src="/Study-Notes/assets/img/push.94deb5c4.png" alt="center" height="250"></div> <footer class="page-edit"><!----> <!----></footer> <div><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Study-Notes/前端生态/flutter实践.html" class="prev">
        flutter实践
      </a></span> <span class="next"><a href="/Study-Notes/前端生态/antd5架构分析.html">
        antd5研究
      </a>
      →
    </span></p></div> <div class="icp-footer"><p>Copyright© 2022-2024 _妄想何方</p> <a href="https://beian.miit.gov.cn/" target="_blank">蜀ICP备2022010321号-1</a></div></div> </main></div><div class="global-ui"></div></div>
    <script src="/Study-Notes/assets/js/app.8fe94d09.js" defer></script><script src="/Study-Notes/assets/js/2.a5eecbd5.js" defer></script><script src="/Study-Notes/assets/js/9.0066262c.js" defer></script><script src="/Study-Notes/assets/js/12.bb1ebd4b.js" defer></script>
  </body>
</html>
