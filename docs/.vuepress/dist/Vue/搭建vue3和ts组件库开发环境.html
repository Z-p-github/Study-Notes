<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="前端技术相关的文章，包含不限于vue，react，webpack，nodejs，算法等等">
    
    <link rel="preload" href="/Study-Notes/assets/css/0.styles.f25af5be.css" as="style"><link rel="preload" href="/Study-Notes/assets/js/app.3e6d690c.js" as="script"><link rel="preload" href="/Study-Notes/assets/js/2.a6634917.js" as="script"><link rel="preload" href="/Study-Notes/assets/js/33.f79801e3.js" as="script"><link rel="preload" href="/Study-Notes/assets/js/11.8af1e3cd.js" as="script"><link rel="prefetch" href="/Study-Notes/assets/js/10.688b02e5.js"><link rel="prefetch" href="/Study-Notes/assets/js/12.ed1e11ae.js"><link rel="prefetch" href="/Study-Notes/assets/js/13.e0a441de.js"><link rel="prefetch" href="/Study-Notes/assets/js/14.9e318840.js"><link rel="prefetch" href="/Study-Notes/assets/js/15.2da35c86.js"><link rel="prefetch" href="/Study-Notes/assets/js/16.edfc734e.js"><link rel="prefetch" href="/Study-Notes/assets/js/17.e62516cb.js"><link rel="prefetch" href="/Study-Notes/assets/js/18.fcbe9711.js"><link rel="prefetch" href="/Study-Notes/assets/js/19.848ea8b0.js"><link rel="prefetch" href="/Study-Notes/assets/js/20.84e2c5ca.js"><link rel="prefetch" href="/Study-Notes/assets/js/21.e8929a39.js"><link rel="prefetch" href="/Study-Notes/assets/js/22.b5ec8bbb.js"><link rel="prefetch" href="/Study-Notes/assets/js/23.9f77473d.js"><link rel="prefetch" href="/Study-Notes/assets/js/24.b73b4835.js"><link rel="prefetch" href="/Study-Notes/assets/js/25.d3f53bc9.js"><link rel="prefetch" href="/Study-Notes/assets/js/26.0edb0ed1.js"><link rel="prefetch" href="/Study-Notes/assets/js/27.d1241423.js"><link rel="prefetch" href="/Study-Notes/assets/js/28.4c683c95.js"><link rel="prefetch" href="/Study-Notes/assets/js/29.4a50b3d3.js"><link rel="prefetch" href="/Study-Notes/assets/js/3.298d34ff.js"><link rel="prefetch" href="/Study-Notes/assets/js/30.39627cc1.js"><link rel="prefetch" href="/Study-Notes/assets/js/31.16a780c8.js"><link rel="prefetch" href="/Study-Notes/assets/js/32.2a86efb9.js"><link rel="prefetch" href="/Study-Notes/assets/js/34.968a05eb.js"><link rel="prefetch" href="/Study-Notes/assets/js/35.69337fd1.js"><link rel="prefetch" href="/Study-Notes/assets/js/36.ec349609.js"><link rel="prefetch" href="/Study-Notes/assets/js/37.519aff5d.js"><link rel="prefetch" href="/Study-Notes/assets/js/38.6406e133.js"><link rel="prefetch" href="/Study-Notes/assets/js/39.e7043c95.js"><link rel="prefetch" href="/Study-Notes/assets/js/4.1aa99c85.js"><link rel="prefetch" href="/Study-Notes/assets/js/40.d9d172d5.js"><link rel="prefetch" href="/Study-Notes/assets/js/41.fc3c4287.js"><link rel="prefetch" href="/Study-Notes/assets/js/42.fd672b5e.js"><link rel="prefetch" href="/Study-Notes/assets/js/43.9fb62012.js"><link rel="prefetch" href="/Study-Notes/assets/js/5.5b093e25.js"><link rel="prefetch" href="/Study-Notes/assets/js/6.1b04e60d.js"><link rel="prefetch" href="/Study-Notes/assets/js/7.3721a9de.js"><link rel="prefetch" href="/Study-Notes/assets/js/8.fe0c5169.js"><link rel="prefetch" href="/Study-Notes/assets/js/9.60827e68.js">
    <link rel="stylesheet" href="/Study-Notes/assets/css/0.styles.f25af5be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/Study-Notes/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/Study-Notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/Study-Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/Study-Notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/Study-Notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/Study-Notes/" aria-current="page" class="sidebar-link">主页</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/JavaScript/小顶堆.html" class="sidebar-link">小顶堆</a></li><li><a href="/Study-Notes/JavaScript/位运算.html" class="sidebar-link">位运算</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>React Fiber</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/React/React-Fiber/React理念.html" class="sidebar-link">React理念</a></li><li><a href="/Study-Notes/React/React-Fiber/ReactFiber架构.html" class="sidebar-link">Fiber架构</a></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>React Fiber Render</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/beginWork.html" class="sidebar-link">beginWork阶段</a></li><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/completeWork.html" class="sidebar-link">completeWork阶段</a></li><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/commit.html" class="sidebar-link">commit阶段</a></li><li><a href="/Study-Notes/React/React-Fiber/Fiber-dom-diff/domdiff.html" class="sidebar-link">completeWork-diff阶段</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>Concurrent Mode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/React/Concurrent-Mode/React中的事件优先级调度.html" class="sidebar-link">React事件优先级调度</a></li><li><a href="/Study-Notes/React/Concurrent-Mode/scheduler.html" class="sidebar-link">scheduler具体实现</a></li><li><a href="/Study-Notes/React/Concurrent-Mode/lane.html" class="sidebar-link">lane模型</a></li></ul></section></li><li><a href="/Study-Notes/React/React17.html" class="sidebar-link">React17</a></li><li><a href="/Study-Notes/React/React18.html" class="sidebar-link">React18</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/Vue/Vue3+Typescript实现Form组件.html" class="sidebar-link">Vue3+Typescript实现Form组件</a></li><li><a href="/Study-Notes/Vue/搭建vue3和ts组件库开发环境.html" class="active sidebar-link">搭建vue3和ts组件库开发环境</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Study-Notes/Vue/搭建vue3和ts组件库开发环境.html#什么是-monorepo" class="sidebar-link">什么是 Monorepo</a></li><li class="sidebar-sub-header"><a href="/Study-Notes/Vue/搭建vue3和ts组件库开发环境.html#开始搭建" class="sidebar-link">开始搭建</a></li><li class="sidebar-sub-header"><a href="/Study-Notes/Vue/搭建vue3和ts组件库开发环境.html#搭建组件库文档" class="sidebar-link">搭建组件库文档</a></li></ul></li><li><a href="/Study-Notes/Vue/Vite2配置项目开发环境.html" class="sidebar-link">Vite2配置项目开发环境</a></li><li><a href="/Study-Notes/Vue/基于Element-plus实现虚拟下拉组件.html" class="sidebar-link">基于Element-plus实现虚拟下拉组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端生态</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/前端生态/eslint.html" class="sidebar-link">eslint</a></li><li><a href="/Study-Notes/前端生态/flutter实践.html" class="sidebar-link">flutter实践</a></li><li><a href="/Study-Notes/前端生态/flutter消息推送.html" class="sidebar-link">flutter消息推送</a></li><li><a href="/Study-Notes/前端生态/antd5架构分析.html" class="sidebar-link">antd5研究</a></li><li><a href="/Study-Notes/前端生态/element-plus架构分析.html" class="sidebar-link">element-plus样式+打包分析</a></li><li><a href="/Study-Notes/前端生态/ts类型打包.html" class="sidebar-link">ts类型打包</a></li><li><a href="/Study-Notes/前端生态/vscode扩展工具.html" class="sidebar-link">vscode扩展工具实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>go</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Study-Notes/go/mac如何安装grpc.html" class="sidebar-link">mac安装grpc</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Vue3 的源码是采用的 <code>Monorepo</code> 的方式进行管理的，这样就可以把不同功能的代码放到不同的包中去单独进行管理</p> <p>例如：</p> <ul><li>compiler-xxx 存储和编译器相关的代码</li> <li>reactivity 响应式相关代码</li> <li>runtime-xxx 运行时相关代码</li></ul> <h2 id="什么是-monorepo"><a href="#什么是-monorepo" class="header-anchor">#</a> 什么是 Monorepo</h2> <p><code>Monorepo</code> 是管理项目代码的一个方式，中文：单体仓库 (单个仓库)，就是单个项目仓库 (repository)，其中包含多个开发项目 project (模块 module，或包 package)。虽然这些 project 也许是相关联的，但它们通常在逻辑上相互独立，并被不同的团队负责编写，运行。</p> <p>优点：</p> <ul><li>一个仓库可维护多个模块，不用到处找仓库</li> <li>方便版本管理和依赖管理，模块之间的引用，调用都非常方便</li> <li>透明度：所有人都能看到所有人写的代码，这一特点能够更好的协作和跨团队贡献 (collaboration and cross-team contributions)，另一个团队中的开发人员可以修复代码中你甚至不知道存在的 bug。</li> <li>简化依赖管理：共享依赖是轻而易举的。几乎不需要用到包管理器，因为所有 module 都保存在在同一个代码仓库中。</li> <li>Single 的真正原因：所有依赖仅有一个版本，意味着没有版本冲突和 Dependency hell (相依性地狱、依赖地狱)。
一致性：当你将所有代码库集中在一个地方时，执行代码质量标准和统一风格会更容易。</li> <li>共享时间线：当 API 或共享的库中有重大变更 (breaking changes) 时就会立刻暴露出来，迫使不同的团队提前沟通并联合起来。每个人都致力于跟上变化。</li> <li>Atomic Commits：Atomic Commits 使大规模重构更容易。开发人员可以在一次 commit 中更新多个包或项目。</li></ul> <p>缺点：</p> <p>随着 monorepos 越来越庞大，我们在版本控制工具、构建系统和 CI pipelines 方面会面临设计极限</p> <ul><li>糟糕的性能：monorepos 很难扩大规模。诸如 git blame 之类的命令可能会花费非常长的时间，IDE 开始卡顿，生产力受到影响，而且在每次提交后的测试阶段变得苦不堪言。</li> <li>污染主线分支 main/master：一个烂的 master branch 会影响所有在 monorepo 工作的人。这可被视为导致灾难，或者是保持测试 tests clean 和 up to date 的诱因。</li> <li>学习曲线：如果项目仓库中有跨越许多紧密耦合的 project，那么新开发人员的学习曲线将会更加陡峭。</li> <li>大量数据：monorepos 每天会处理大量的数据和 commit。</li> <li>文件权限管理：管理文件权限更具挑战性，因为像 Git 或 Mercurial 这样的系统没有内置的权限管理机制。
代码审查：通知 (notifications) 会变得非常嘈杂。例如，GitHub 的通知功能，当一连串的 pull requests 和 code reviews 时并不友好。</li></ul> <p>vue3 中使用 <code>pnpm workspace</code> 来实现的 <code>monorepo</code> (pnpm 是快速、节省磁盘空间的包管理器，主要采用符号链接的方式管理模块)</p> <h2 id="开始搭建"><a href="#开始搭建" class="header-anchor">#</a> 开始搭建</h2> <h3 id="全局安装-pnpm"><a href="#全局安装-pnpm" class="header-anchor">#</a> 全局安装 <code>pnpm</code></h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install pnpm <span class="token operator">-</span>g <span class="token comment">//全局安装</span>
</code></pre></div><h3 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h3> <div class="language-js extra-class"><pre class="language-js"><code>pnpm init
</code></pre></div><h3 id="创建-npmrc-文件"><a href="#创建-npmrc-文件" class="header-anchor">#</a> 创建 <code>.npmrc</code> 文件</h3> <p>默认情况下，<code>pnpm</code> 创建一个半严格的 <code>node_modules</code>，这意味着依赖项可以访问未声明的依赖项，但 <code>node_modules</code> 之外的模块不行。 通过这种布局，生态系统中的大多数的包都可以正常工作。 但是，如果某些工具仅在提升的依赖项位于根目录的 <code>node_modules</code> 时才有效，您可以将其设置为 true 来为您提升它们，其实就是提升所有依赖到根 node_modules 目录下</p> <div class="language-js extra-class"><pre class="language-js"><code>shamefullly<span class="token operator">-</span>hoist <span class="token operator">=</span> <span class="token boolean">true</span>
</code></pre></div><h3 id="安装-vue3-和-typescript"><a href="#安装-vue3-和-typescript" class="header-anchor">#</a> 安装 vue3 和 typescript</h3> <div class="language-js extra-class"><pre class="language-js"><code>npm install vue@next typescript <span class="token operator">--</span>save
</code></pre></div><h3 id="生成-ts-配置文件"><a href="#生成-ts-配置文件" class="header-anchor">#</a> 生成 ts 配置文件</h3> <div class="language-js extra-class"><pre class="language-js"><code>npx tsc <span class="token operator">--</span>init
</code></pre></div><h3 id="添加-ts-配置"><a href="#添加-ts-配置" class="header-anchor">#</a> 添加 ts 配置</h3> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 打包模块类型ESNext</span>
    <span class="token property">&quot;declaration&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 默认不要声明文件</span>
    <span class="token property">&quot;noImplicitAny&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 支持类型不标注可以默认any</span>
    <span class="token property">&quot;removeComments&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 删除注释</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 按照node模块来解析</span>
    <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 支持es6,commonjs模块</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span><span class="token punctuation">,</span> <span class="token comment">// jsx 不转</span>
    <span class="token property">&quot;noLib&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不处理类库</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;es6&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 遵循es6版本</span>
    <span class="token property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 编译时用的库</span>
      <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;DOM&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowSyntheticDefaultImports&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 允许没有导出的模块中导入</span>
    <span class="token property">&quot;experimentalDecorators&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 装饰器语法</span>
    <span class="token property">&quot;forceConsistentCasingInFileNames&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 强制区分大小写</span>
    <span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 解析json模块</span>
    <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否启动严格模式</span>
    <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 跳过类库检测</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;exclude&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 排除掉哪些类库</span>
    <span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;**/__tests__&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;dist/**&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="在根目录下面创建-pnpm-workspace-yaml-文件"><a href="#在根目录下面创建-pnpm-workspace-yaml-文件" class="header-anchor">#</a> 在根目录下面创建 <code>pnpm-workspace.yaml</code> 文件</h3> <p><code>pnpm-workspace.yaml</code> 定义了 <a href="https://pnpm.io/zh/workspaces" target="_blank" rel="noopener noreferrer">工作空间<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的根目录，并能够使您从工作空间中包含 / 排除目录 。 默认情况下，包含所有子目录。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">packages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> play <span class="token comment"># 存放我们组件测试的时候的代码</span>
  <span class="token punctuation">-</span> docs <span class="token comment"># 存放我们组件文档的</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;packages/**&quot;</span>
</code></pre></div><h3 id="创建子-package-json"><a href="#创建子-package-json" class="header-anchor">#</a> 创建子 <code>package.json</code></h3> <p>在<code>play</code>文件夹下面 初始化一个 <code>package.json</code> 文件，添加 <code>private</code> 属性，那 npm 将拒绝发布这个包， 这是防止私人存储库意外发布的一种方法。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@vue3/play&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;private&quot;</span><span class="token operator">:</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;main&quot;</span><span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vue-tsc --noEmit &amp;&amp; vite build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;preview&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite preview&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@vicons/ionicons5&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.12.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.2.25&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;keywords&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;author&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;license&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ISC&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;devDependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@vitejs/plugin-vue&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;@vitejs/plugin-vue-jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^2.0.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;typescript&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.7.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vite&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^3.0.9&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;vue-tsc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^0.40.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>安装依赖：</p> <div class="language-js extra-class"><pre class="language-js"><code>pnpm i @vitejs<span class="token operator">/</span>plugin<span class="token operator">-</span>vue @vitejs<span class="token operator">/</span>plugin<span class="token operator">-</span>vue<span class="token operator">-</span>jsx typescript vite vue<span class="token operator">-</span>tsc <span class="token operator">-</span><span class="token constant">D</span>
</code></pre></div><p>因为 <code>play</code> 目录是我们用来测试写的组件的功能的，所以配置一个 <code>vite</code> 打包，会提升我们的效率</p> <p>创建 <code>vite.config.js</code> 文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&quot;@vitejs/plugin-vue&quot;</span><span class="token punctuation">;</span> <span class="token comment">//vite的vue插件</span>
<span class="token keyword">import</span> DefineOptions <span class="token keyword">from</span> <span class="token string">&quot;unplugin-vue-define-options/vite&quot;</span><span class="token punctuation">;</span> <span class="token comment">//可以在vue3中定义组件的name属性</span>
<span class="token keyword">import</span> vueJsx <span class="token keyword">from</span> <span class="token string">&quot;@vitejs/plugin-vue-jsx&quot;</span><span class="token punctuation">;</span> <span class="token comment">//支持vue的tsx写法</span>
<span class="token comment">// https://vitejs.dev/config/</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vueJsx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">DefineOptions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接着在 <code>play</code> 文件夹中创建一个 <code>index.html</code> 文件用来存放打包后的 js 代码</p> <p>修改内容如下</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/src/main.ts<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="play-文件夹初始化-ts-配置文件"><a href="#play-文件夹初始化-ts-配置文件" class="header-anchor">#</a> play 文件夹初始化 ts 配置文件</h3> <p>在 <code>play</code> 文件夹中初始化一个 ts 配置文件</p> <div class="language-js extra-class"><pre class="language-js"><code>npm tsx <span class="token operator">--</span>init
</code></pre></div><p>写入配置：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;useDefineForClassFields&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;preserve&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;sourceMap&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;isolatedModules&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/**/*.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;src/**/*.d.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;src/**/*.tsx&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;src/**/*.vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;references&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token property">&quot;path&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./tsconfig.node.json&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里的配置文件为什么会有一个<code>references</code> 属性呢</p> <p>这是 <code>TypeScript 3.0</code> 新增的 <a href="https://www.typescriptlang.org/docs/handbook/project-references.html" target="_blank" rel="noopener noreferrer">项目引用（Project References）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 功能，它允许用户为项目的不同部分使用不同的 TypeScript 配置</p> <p>我们需要创建一个 <code>tsconfig.node.json</code> 文件，<code>tsconfig.node.json</code> 是专门用于 <code>vite.config.ts</code> 的 <code>TypeScript</code> 配置文件。</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;composite&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 对于引用项目必须设置该属性</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;esnext&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;vite.config.ts&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>tsconfig.node.json</code> 文件说明</p> <ul><li><code>tsconfig.node.json</code> 是专门用于 <code>vite.config.ts</code> 的 <code>TypeScript</code> 配置文件。</li> <li><code>tsconfig.json</code>文件通过 <code>references</code> 字段引入 <code>tsconfig.node.json</code> 中的配置。</li> <li>使用 <code>references</code> 字段引入的配置文件需要设置 <code>composite: true</code> 字段，并用 <code>include</code> 或 <code>files</code> 等等属性指明配置覆盖的文件范围。</li></ul> <h3 id="在根目录创建-shims-vue-d-ts-文件"><a href="#在根目录创建-shims-vue-d-ts-文件" class="header-anchor">#</a> 在根目录创建 shims-vue.d.ts 文件</h3> <p>该文件的作用是主要为项目内所有的 vue 文件做模块声明，毕竟 ts 默认只识别 .d.ts、.ts、.tsx 后缀的文件</p> <div class="language-js extra-class"><pre class="language-js"><code>declare module <span class="token string">'*.vue'</span> <span class="token punctuation">{</span>
    <span class="token keyword">import</span> type <span class="token punctuation">{</span> DefineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
    <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any, @typescript-eslint/ban-types</span>
    <span class="token keyword">const</span> <span class="token literal-property property">component</span><span class="token operator">:</span> DefineComponent<span class="token operator">&lt;</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> any<span class="token operator">&gt;</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> component
  <span class="token punctuation">}</span>

</code></pre></div><h3 id="配置开发启动命令"><a href="#配置开发启动命令" class="header-anchor">#</a> 配置开发启动命令</h3> <p>在根目录下面的 <code>package.json</code> 文件中 添加一个 <code>dev</code> 命令</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pnpm -C play dev&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p><code>pnpm -C</code> 的意思是指定一个 工作目录，这里是指定 <code>play</code>目录，然后去执行该目录下面的 <code>npm run dev</code> 命令</p> <h3 id="安装依赖"><a href="#安装依赖" class="header-anchor">#</a> 安装依赖</h3> <p>1、在根目录中去安装其他子包</p> <p>当我们要在其中一个包中使用另外一个包中的东西的时候，可以使用 <code>pnpm install xxx -w</code> 的方式去安装</p> <p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code>pnpm install @vue3<span class="token operator">/</span>components <span class="token operator">-</span>w
</code></pre></div><p>这个时候就会在包的依赖中产生一个指向工作目录的一个依赖项</p> <div class="language-json extra-class"><pre class="language-json"><code>  <span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;@vue3/components&quot;</span><span class="token operator">:</span> <span class="token string">&quot;workspace:^1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre></div><p><code>workspace</code> 表明这是一个工作目录中的包，后面紧跟的是这个包的版本号</p> <p>2、在子包中去安装另外一个子包</p> <div class="language-js extra-class"><pre class="language-js"><code>pnpm install 依赖子包名字@workspace <span class="token operator">--</span>filter 目标子包名字
</code></pre></div><p>例如：</p> <div class="language-js extra-class"><pre class="language-js"><code>pnpm install @vue3<span class="token operator">/</span>shared@workspace <span class="token operator">--</span>filter @vue3<span class="token operator">/</span>components
</code></pre></div><p>这个命令就会在 <code>@vue3/components</code> 这个模块中 去安装 <code>@vue3/shared</code> 这个依赖</p> <h2 id="搭建组件库文档"><a href="#搭建组件库文档" class="header-anchor">#</a> 搭建组件库文档</h2> <p>我们也可以在项目的根目录下创建一个 <code>doc</code> 的文件夹，里面写上每个组件的具体用法，可以借助 <code>vitepress</code> 这个工具库去实现文档的编写</p> <p>然后可以在根目录的<code>package.json</code>文件中配置一个命令去启动 <code>doc</code>文件中的 <code>vitepress dev .</code> 命令</p> <div class="language-json extra-class"><pre class="language-json"><code> <span class="token property">&quot;doc:dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;pnpm -C docs dev&quot;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Study-Notes/Vue/Vue3+Typescript实现Form组件.html" class="prev">
        Vue3+Typescript实现Form组件
      </a></span> <span class="next"><a href="/Study-Notes/Vue/Vite2配置项目开发环境.html">
        Vite2配置项目开发环境
      </a>
      →
    </span></p></div> <div class="icp-footer"><p>Copyright© 2022-2023 _妄想何方</p> <a href="https://beian.miit.gov.cn/" target="_blank">蜀ICP备2022010321号-1</a></div></div> </main></div><div class="global-ui"></div></div>
    <script src="/Study-Notes/assets/js/app.3e6d690c.js" defer></script><script src="/Study-Notes/assets/js/2.a6634917.js" defer></script><script src="/Study-Notes/assets/js/33.f79801e3.js" defer></script><script src="/Study-Notes/assets/js/11.8af1e3cd.js" defer></script>
  </body>
</html>
