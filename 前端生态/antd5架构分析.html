<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>antd5 ä»‹ç» | å­¦ä¹ ç¬”è®°</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="å‰ç«¯æŠ€æœ¯ç›¸å…³çš„æ–‡ç« ï¼ŒåŒ…å«ä¸é™äºvueï¼Œreactï¼Œwebpackï¼Œnodejsï¼Œç®—æ³•ç­‰ç­‰">
    
    <link rel="preload" href="/assets/css/0.styles.1bd58bef.css" as="style"><link rel="preload" href="/assets/js/app.a5e2a326.js" as="script"><link rel="preload" href="/assets/js/2.a6634917.js" as="script"><link rel="preload" href="/assets/js/7.5b3397e2.js" as="script"><link rel="preload" href="/assets/js/11.8af1e3cd.js" as="script"><link rel="prefetch" href="/assets/js/10.d3f689f8.js"><link rel="prefetch" href="/assets/js/12.ed1e11ae.js"><link rel="prefetch" href="/assets/js/13.e0a441de.js"><link rel="prefetch" href="/assets/js/14.9e318840.js"><link rel="prefetch" href="/assets/js/15.d841da4f.js"><link rel="prefetch" href="/assets/js/16.34930d07.js"><link rel="prefetch" href="/assets/js/17.07cd49aa.js"><link rel="prefetch" href="/assets/js/18.39517720.js"><link rel="prefetch" href="/assets/js/19.1f1689c7.js"><link rel="prefetch" href="/assets/js/20.84a7ddf3.js"><link rel="prefetch" href="/assets/js/21.d47f1b28.js"><link rel="prefetch" href="/assets/js/22.3f16cfa0.js"><link rel="prefetch" href="/assets/js/23.f86859e1.js"><link rel="prefetch" href="/assets/js/24.b73b4835.js"><link rel="prefetch" href="/assets/js/25.d3f53bc9.js"><link rel="prefetch" href="/assets/js/26.ee307239.js"><link rel="prefetch" href="/assets/js/27.eaad36cd.js"><link rel="prefetch" href="/assets/js/28.2ea9696e.js"><link rel="prefetch" href="/assets/js/29.0f3fa806.js"><link rel="prefetch" href="/assets/js/3.c79fccf9.js"><link rel="prefetch" href="/assets/js/30.9a0696b4.js"><link rel="prefetch" href="/assets/js/31.89a9820d.js"><link rel="prefetch" href="/assets/js/32.dba916d1.js"><link rel="prefetch" href="/assets/js/33.4c1838f9.js"><link rel="prefetch" href="/assets/js/34.968a05eb.js"><link rel="prefetch" href="/assets/js/35.88ee813d.js"><link rel="prefetch" href="/assets/js/36.ec349609.js"><link rel="prefetch" href="/assets/js/37.7f17ec10.js"><link rel="prefetch" href="/assets/js/38.1844a26b.js"><link rel="prefetch" href="/assets/js/39.3f1bd3ec.js"><link rel="prefetch" href="/assets/js/4.baf3274c.js"><link rel="prefetch" href="/assets/js/40.e03e4557.js"><link rel="prefetch" href="/assets/js/41.a69c6022.js"><link rel="prefetch" href="/assets/js/42.705f89ae.js"><link rel="prefetch" href="/assets/js/43.9fb62012.js"><link rel="prefetch" href="/assets/js/5.f40b1275.js"><link rel="prefetch" href="/assets/js/6.4eaec7b1.js"><link rel="prefetch" href="/assets/js/8.7c035891.js"><link rel="prefetch" href="/assets/js/9.0f0a6fdc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1bd58bef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">å­¦ä¹ ç¬”è®°</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/doc-front-end" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/doc-front-end" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">ä¸»é¡µ</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript/å°é¡¶å †.html" class="sidebar-link">å°é¡¶å †</a></li><li><a href="/JavaScript/ä½è¿ç®—.html" class="sidebar-link">ä½è¿ç®—</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>React Fiber</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/React-Fiber/Reactç†å¿µ.html" class="sidebar-link">Reactç†å¿µ</a></li><li><a href="/React/React-Fiber/ReactFiberæ¶æ„.html" class="sidebar-link">Fiberæ¶æ„</a></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>React Fiber Render</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/React-Fiber/Fiber-dom-diff/beginWork.html" class="sidebar-link">beginWorké˜¶æ®µ</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/completeWork.html" class="sidebar-link">completeWorké˜¶æ®µ</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/commit.html" class="sidebar-link">commité˜¶æ®µ</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/domdiff.html" class="sidebar-link">completeWork-diffé˜¶æ®µ</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>Concurrent Mode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/Concurrent-Mode/Reactä¸­çš„äº‹ä»¶ä¼˜å…ˆçº§è°ƒåº¦.html" class="sidebar-link">Reactäº‹ä»¶ä¼˜å…ˆçº§è°ƒåº¦</a></li><li><a href="/React/Concurrent-Mode/scheduler.html" class="sidebar-link">schedulerå…·ä½“å®ç°</a></li><li><a href="/React/Concurrent-Mode/lane.html" class="sidebar-link">laneæ¨¡å‹</a></li></ul></section></li><li><a href="/React/React17.html" class="sidebar-link">React17</a></li><li><a href="/React/React18.html" class="sidebar-link">React18</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Vue/Vue3+Typescriptå®ç°Formç»„ä»¶.html" class="sidebar-link">Vue3+Typescriptå®ç°Formç»„ä»¶</a></li><li><a href="/Vue/æ­å»ºvue3å’Œtsç»„ä»¶åº“å¼€å‘ç¯å¢ƒ.html" class="sidebar-link">æ­å»ºvue3å’Œtsç»„ä»¶åº“å¼€å‘ç¯å¢ƒ</a></li><li><a href="/Vue/Vite2é…ç½®é¡¹ç›®å¼€å‘ç¯å¢ƒ.html" class="sidebar-link">Vite2é…ç½®é¡¹ç›®å¼€å‘ç¯å¢ƒ</a></li><li><a href="/Vue/åŸºäºElement-pluså®ç°è™šæ‹Ÿä¸‹æ‹‰ç»„ä»¶.html" class="sidebar-link">åŸºäºElement-pluså®ç°è™šæ‹Ÿä¸‹æ‹‰ç»„ä»¶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>å‰ç«¯ç”Ÿæ€</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/å‰ç«¯ç”Ÿæ€/eslint.html" class="sidebar-link">eslint</a></li><li><a href="/å‰ç«¯ç”Ÿæ€/flutterå®è·µ.html" class="sidebar-link">flutterå®è·µ</a></li><li><a href="/å‰ç«¯ç”Ÿæ€/flutteræ¶ˆæ¯æ¨é€.html" class="sidebar-link">flutteræ¶ˆæ¯æ¨é€</a></li><li><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html" class="active sidebar-link">antd5ç ”ç©¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#antd5-ä»‹ç»" class="sidebar-link">antd5 ä»‹ç»</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#ç›®å½•ç»“æ„" class="sidebar-link">ç›®å½•ç»“æ„</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#ç»„ä»¶ç¼–å†™" class="sidebar-link">ç»„ä»¶ç¼–å†™</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#ä¸»é¢˜æ ·å¼è®¾è®¡" class="sidebar-link">ä¸»é¢˜æ ·å¼è®¾è®¡</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#ç»„ä»¶åº“æ–‡æ¡£è®¾è®¡" class="sidebar-link">ç»„ä»¶åº“æ–‡æ¡£è®¾è®¡</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#ç»„ä»¶åº“æ‰“åŒ…" class="sidebar-link">ç»„ä»¶åº“æ‰“åŒ…</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#ç»„ä»¶åº“å•å…ƒæµ‹è¯•" class="sidebar-link">ç»„ä»¶åº“å•å…ƒæµ‹è¯•</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#ts-node" class="sidebar-link">ts-node</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#pre-publish-çš„ä¸€äº›æ£€æŸ¥" class="sidebar-link">pre-publish çš„ä¸€äº›æ£€æŸ¥</a></li><li class="sidebar-sub-header"><a href="/å‰ç«¯ç”Ÿæ€/antd5æ¶æ„åˆ†æ.html#æŒ‰éœ€åŠ è½½" class="sidebar-link">æŒ‰éœ€åŠ è½½</a></li></ul></li><li><a href="/å‰ç«¯ç”Ÿæ€/element-plusæ¶æ„åˆ†æ.html" class="sidebar-link">element-plusæ ·å¼+æ‰“åŒ…åˆ†æ</a></li><li><a href="/å‰ç«¯ç”Ÿæ€/tsç±»å‹æ‰“åŒ….html" class="sidebar-link">tsç±»å‹æ‰“åŒ…</a></li><li><a href="/å‰ç«¯ç”Ÿæ€/vscodeæ‰©å±•å·¥å…·.html" class="sidebar-link">vscodeæ‰©å±•å·¥å…·å®ç°</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>go</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/go/macå¦‚ä½•å®‰è£…grpc.html" class="sidebar-link">macå®‰è£…grpc</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="antd5-ä»‹ç»"><a href="#antd5-ä»‹ç»" class="header-anchor">#</a> antd5 ä»‹ç»</h2> <p>Ant Design of React æ˜¯é˜¿é‡Œæ¨å‡ºçš„ä¸€æ¬¾å¼€ç®±å³ç”¨çš„é«˜è´¨é‡ç»„ä»¶åº“ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¹³æ—¶çš„å¿«é€Ÿå¼€å‘ï¼Œå®ƒæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</p> <ul><li>ğŸŒˆ æç‚¼è‡ªä¼ä¸šçº§ä¸­åå°äº§å“çš„äº¤äº’è¯­è¨€å’Œè§†è§‰é£æ ¼ã€‚</li> <li>ğŸ“¦ å¼€ç®±å³ç”¨çš„é«˜è´¨é‡ React ç»„ä»¶ã€‚</li> <li>ğŸ›¡ ä½¿ç”¨ TypeScript å¼€å‘ï¼Œæä¾›å®Œæ•´çš„ç±»å‹å®šä¹‰æ–‡ä»¶ã€‚</li> <li>âš™ï¸ å…¨é“¾è·¯å¼€å‘å’Œè®¾è®¡å·¥å…·ä½“ç³»ã€‚</li> <li>ğŸŒ æ•°åä¸ªå›½é™…åŒ–è¯­è¨€æ”¯æŒã€‚</li> <li>ğŸ¨ æ·±å…¥æ¯ä¸ªç»†èŠ‚çš„ä¸»é¢˜å®šåˆ¶èƒ½åŠ›ã€‚</li></ul> <p><code>antd5</code> æ•´ä¸ªæ¡†æ¶æ–‡æ¡£æ¶æ„æ˜¯ç”¨<a href="https://d.umijs.org/guide" target="_blank" rel="noopener noreferrer">dump<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ¥åšçš„ï¼Œ ä»Šå¤©æˆ‘ä»¬ä¸»è¦é’ˆå¯¹å…¶ä¸­çš„å‡ ä¸ªç‚¹æ¥å­¦ä¹ å’Œåˆ†æä¸€ä¸‹é¡¹ç›®çš„æ¶æ„å®ç°</p> <h2 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="header-anchor">#</a> ç›®å½•ç»“æ„</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>
antd

â”œâ”€â”€ locale è¯­è¨€æ–‡ä»¶
â”œâ”€â”€ doc ä¸€äº›åšå®¢æ–‡ç« æ–‡ç« ä¹‹ç±»çš„
â”œâ”€â”€ components
     â””â”€â”€ ç»„ä»¶
          â”œâ”€â”€ <span class="token builtin class-name">test</span> å•å…ƒæµ‹è¯•æ–‡ä»¶
          â”œâ”€â”€ demo ä¸€äº›demoæ–‡ä»¶ï¼Œä¸»è¦ç”¨åœ¨ç»„ä»¶åº“æ–‡æ¡£é‡Œé¢ï¼Œä¼šé€šè¿‡ antdå†…ç½®çš„ codeæ ‡ç­¾æ’å…¥è¿›æ¥
          â”œâ”€â”€ .mdæ–‡æ¡£ ç»„ä»¶çš„æ–‡æ¡£
          â”œâ”€â”€ style  ç»„ä»¶çš„æ ·å¼æ–‡ä»¶ cssinjs
          â””â”€â”€ index.tsx å…¥å£æ–‡ä»¶
          â””â”€â”€ main.dart
â”œâ”€â”€ script ä¸€äº›è„šæœ¬å‘½ä»¤æ–‡ä»¶
â”œâ”€â”€ typings ä¸€äº›ç±»å‹å£°æ˜æ–‡ä»¶
â””â”€â”€ tests å•å…ƒæµ‹è¯•æ–‡ä»¶
</code></pre></div><h2 id="ç»„ä»¶ç¼–å†™"><a href="#ç»„ä»¶ç¼–å†™" class="header-anchor">#</a> ç»„ä»¶ç¼–å†™</h2> <p>æˆ‘ä»¬ä»¥ <code>Button</code>ç»„ä»¶ä¸ºä¾‹æ¥åˆ†æä¸€ä¸‹ <code>antd</code>çš„ç»„ä»¶ç¼–å†™æ–¹å¼å’Œè§„èŒƒ</p> <p>1ã€åœ¨ <code>index.ts</code> æ–‡ä»¶ä¸­æˆ‘ä»¬éœ€è¦å¯¼å‡ºæ¯ä¸€ä¸ªç»„ä»¶çš„ç±»å‹å’Œæ”¹ç»„ä»¶
ä¾‹å¦‚ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'./button'</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> SizeType <span class="token keyword">as</span> ButtonSize <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../config-provider/SizeContext'</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ButtonProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./button'</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> ButtonGroupProps <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./button-group'</span>

<span class="token keyword">export</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token string">'./buttonHelpers'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Button
</code></pre></div><p>2ã€ç„¶åæˆ‘ä»¬å»çœ‹çœ‹ <code>Button.tsx</code>ä¸­çš„ä¸€äº›åŠŸèƒ½å®ç°</p> <p>åœ¨æ¯ä¸€ä¸ªç»„ä»¶æ–‡ä»¶çš„å‰é¢ä¼šå®šä¹‰ç»„ä»¶ä¸­çš„ä¸€äº›ç±»å‹ï¼Œæ¯”å¦‚ï¼š</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">//æ‘˜è‡ª Button.tsx</span>
<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">BaseButtonProps</span> <span class="token punctuation">{</span>
  type<span class="token operator">?</span><span class="token operator">:</span> ButtonType
  icon<span class="token operator">?</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode
  shape<span class="token operator">?</span><span class="token operator">:</span> ButtonShape
  size<span class="token operator">?</span><span class="token operator">:</span> SizeType
  disabled<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  loading<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span> <span class="token operator">|</span> <span class="token punctuation">{</span> delay<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span>
  prefixCls<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  className<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  rootClassName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
  ghost<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  danger<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  block<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span>
  children<span class="token operator">?</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">NativeButtonProps</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  htmlType<span class="token operator">?</span><span class="token operator">:</span> ButtonHTMLType
  onClick<span class="token operator">?</span><span class="token operator">:</span> React<span class="token punctuation">.</span>MouseEventHandler<span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">&gt;</span>
<span class="token punctuation">}</span> <span class="token operator">&amp;</span> BaseButtonProps <span class="token operator">&amp;</span>
  Omit<span class="token operator">&lt;</span>React<span class="token punctuation">.</span>ButtonHTMLAttributes<span class="token operator">&lt;</span>HTMLButtonElement<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token string">'type'</span> <span class="token operator">|</span> <span class="token string">'onClick'</span><span class="token operator">&gt;</span>

<span class="token comment">//å¯¼å‡ºbuttonçš„propsç±»å‹</span>
<span class="token keyword">export</span> <span class="token keyword">type</span> <span class="token class-name">ButtonProps</span> <span class="token operator">=</span> Partial<span class="token operator">&lt;</span>AnchorButtonProps <span class="token operator">&amp;</span> NativeButtonProps<span class="token operator">&gt;</span>
</code></pre></div><p>å®šä¹‰ç»„ä»¶çš„æ ·å¼ç±»åï¼š
åœ¨ antd ç»„ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ªç»„ä»¶ä¼šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•<code>defaultGetPrefixCls</code>æ¥å®šä¹‰è‡ªå·±ç»„ä»¶ç±»åçš„å‰ç¼€</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">//context.ts æ–‡ä»¶</span>
<span class="token keyword">const</span> <span class="token function-variable function">defaultGetPrefixCls</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  suffixCls<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  customizePrefixCls<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>customizePrefixCls<span class="token punctuation">)</span> <span class="token keyword">return</span> customizePrefixCls

  <span class="token keyword">return</span> suffixCls <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ant-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>suffixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">'ant'</span>
<span class="token punctuation">}</span>

<span class="token comment">//åœ¨button.tsxä¸­ å®šä¹‰ç±»åå‰ç¼€ï¼Œæ­¤å¤„ç»™çš„å‰ç¼€æ˜¯ btnï¼Œæ‰€ä»¥ç»“åˆä¸Šé¢çš„å‡½æ•° Buttonç»„ä»¶çš„æ ·å¼ç±»åå‰ç¼€å°±æ˜¯ ant-btn</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> getPrefixCls <span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>ConfigContext<span class="token punctuation">)</span>
<span class="token keyword">const</span> prefixCls <span class="token operator">=</span> <span class="token function">getPrefixCls</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">,</span> customizePrefixCls<span class="token punctuation">)</span>
</code></pre></div><p><code>antd</code> ä½¿ç”¨ <code>classnames</code>åº“æ¥ä¸€æ¬¡æ€§ç»™ç»„ä»¶ç»‘å®šå¤šä¸ªç±»ï¼Œ <code>classnames</code>åº“ç›¸æ¯”äºæˆ‘ä»¬ä¹‹å‰çš„é‚£ç§ç»™ç»„ä»¶ç»‘å®šå¤šä¸ª class çš„å†™æ³•ä¼šæ›´åŠ çš„ç®€å•å’Œä¾¿åˆ©ï¼Œä¾‹å¦‚ï¼š</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token function">classnames</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token string-property property">'class1'</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">'class2'</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">)</span><span class="token operator">&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'foo bar'</span>
<span class="token function">classNames</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'foo bar'</span>
<span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">'foo-bar'</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'foo-bar'</span>
<span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string-property property">'foo-bar'</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; ''</span>
<span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'foo bar'</span>
<span class="token function">classNames</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">bar</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'foo bar'</span>
</code></pre></div><p>æœ€åç»„ä»¶åœ¨æ¸²æŸ“çš„æ—¶å€™ä¼šå»èµ°ä¸€ä¸ª <code>wrapSSr</code>çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ç”±<code>useStyle</code>ç”Ÿæˆ</p> <div class="language-ts extra-class"><pre class="language-ts"><code>  <span class="token keyword">const</span> <span class="token punctuation">[</span>wrapSSR<span class="token punctuation">,</span> hashId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useStyle</span><span class="token punctuation">(</span>prefixCls<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">...</span>
  <span class="token keyword">return</span> <span class="token function">wrapSSR</span><span class="token punctuation">(</span>buttonNode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>é¦–å…ˆåœ¨ç»„ä»¶å†…çš„<code>useStyle</code>ä¼ å…¥äº†<code>warpSSRå’ŒhashID</code>ï¼Œæ‰§è¡Œ<code>genComponentStyleHook</code>ï¼Œæœ€ç»ˆè¿”å›<code>useStyleRegister</code>è¿™ä¸ªå‡½æ•°å¹¶ä¼ å…¥<code>styleFn</code>ï¼Œæ ¸å¿ƒæ‰§è¡Œ<code>useGlobalCache</code>å‡½æ•°ï¼Œ<code>styleFn</code>æ‰§è¡Œæ—¶ç»„ä»¶æœ¬èº«çš„æ ·å¼å’Œè¢«åˆå¹¶çš„<code>token</code>å°±è¢«åŠ è½½åˆ°ä¸€ä¸ª<code>StyleObj</code>å¯¹è±¡ä¸Šäº†,æœ€åæ¸²æŸ“å‡ºæ¥</p> <p>åœ¨ <code>wrapSSR</code> æ–¹æ³•ä¸­ï¼Œ</p> <h2 id="ä¸»é¢˜æ ·å¼è®¾è®¡"><a href="#ä¸»é¢˜æ ·å¼è®¾è®¡" class="header-anchor">#</a> ä¸»é¢˜æ ·å¼è®¾è®¡</h2> <p>é¦–å…ˆï¼Œå½“æˆ‘ä»¬æƒ³è¦è®¾ç½®æˆ–è€…ä¿®æ”¹<code>antd</code>çš„é»˜è®¤ä¸»é¢˜çš„æ—¶å€™ï¼ŒæŒ‰ç…§å®˜æ–¹çš„å†™æ³•ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬æƒ³è¦è¦†ç›–é»˜è®¤ä¸»é¢˜çš„å¤–å±‚åŒ…ä¸€ä¸ª <code>ConfigProvider</code>,ä¾‹å¦‚ï¼š</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Button <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ConfigProvider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'antd'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> theme <span class="token operator">=</span> <span class="token punctuation">{</span>
    token<span class="token operator">:</span> <span class="token punctuation">{</span>
      colorPrimary<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span>
      colorError<span class="token operator">:</span> <span class="token string">'#ff4d4f'</span><span class="token punctuation">,</span>
      colorWarning<span class="token operator">:</span> <span class="token string">'#ffc245'</span><span class="token punctuation">,</span>
      colorSuccess<span class="token operator">:</span> <span class="token string">'#00c48c'</span><span class="token punctuation">,</span>
      colorText<span class="token operator">:</span> <span class="token string">'#3c4761'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token comment">/* ä¼ å…¥themeå±æ€§ï¼Œè¦†ç›–é»˜è®¤ä¸»é¢˜ */</span><span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">ConfigProvider</span></span> <span class="token attr-name">theme</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>theme<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">ç‚¹å‡»</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">ConfigProvider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é‚£ä¹ˆåœ¨ antd ç»„ä»¶å†…éƒ¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ª <code>ConfigProvider</code>æ¥ä¿®æ”¹é»˜è®¤æ ·å¼ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·å»çœ‹çœ‹ï¼š</p> <p>æˆ‘ä»¬è¿˜æ˜¯ä»¥<code>Button</code> ç»„ä»¶ä¸ºä¾‹</p> <p>1ã€é¦–å…ˆåœ¨<code>button</code>ç»„ä»¶ä¸­ä¼šå»è·å–ä¸Šä¸‹æ–‡ä¸­çš„å±æ€§</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token comment">// ä½¿ç”¨ getPrefixCls ç”Ÿæˆä¸€ä¸ªå‰ç¼€classç±»å ï¼Œæ¯”å¦‚ ant-btn</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> getPrefixCls <span class="token punctuation">}</span> <span class="token operator">=</span> React<span class="token punctuation">.</span><span class="token function">useContext</span><span class="token punctuation">(</span>ConfigContext<span class="token punctuation">)</span>
<span class="token keyword">const</span> prefixCls <span class="token operator">=</span> <span class="token function">getPrefixCls</span><span class="token punctuation">(</span><span class="token string">'btn'</span><span class="token punctuation">,</span> customizePrefixCls<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'prefixCls:'</span><span class="token punctuation">,</span> prefixCls<span class="token punctuation">)</span> <span class="token comment">//ant-btn</span>
</code></pre></div><img src="/assets/img/prefix.c2ee9481.png" alt="center"> <p>2ã€ç„¶å å›ä» <code>useStyle</code> ä¸­è·å– <code>wrapSSR</code> æ–¹æ³• å’Œ ä¸€ä¸ª <code>hashId</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>wrapSSR<span class="token punctuation">,</span> hashId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useStyle</span><span class="token punctuation">(</span>prefixCls<span class="token punctuation">)</span>
</code></pre></div><p><code>useStyle</code> å°±ç­‰äºä¸‹é¢çš„ç›´æ¥æ‰§è¡Œå‡½æ•°<code>genComponentStyleHook</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">genComponentStyleHook</span><span class="token punctuation">(</span><span class="token string">'Button'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> controlTmpOutline<span class="token punctuation">,</span> paddingContentHorizontal <span class="token punctuation">}</span> <span class="token operator">=</span> token
  <span class="token comment">//buttonToken ä¸­å°±åŒ…å«äº†ä¸€äº›æ ·å¼å˜é‡ï¼Œæ¯”å¦‚ colorï¼ŒfontSizeç­‰</span>
  <span class="token keyword">const</span> buttonToken <span class="token operator">=</span> <span class="token generic-function"><span class="token function">mergeToken</span><span class="token generic class-name"><span class="token operator">&lt;</span>ButtonToken<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    colorOutlineDefault<span class="token operator">:</span> controlTmpOutline<span class="token punctuation">,</span>
    buttonPaddingHorizontal<span class="token operator">:</span> paddingContentHorizontal<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span>
    <span class="token comment">// å¾€tokenä¸­åˆå¹¶æ–°çš„csså˜é‡</span>
    <span class="token comment">// Shared  å…±äº«çš„å˜é‡ ï¼Œæ¯”å¦‚   outline: 'none', position: 'relative',</span>
    <span class="token function">genSharedButtonStyle</span><span class="token punctuation">(</span>buttonToken<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Size å°ºå¯¸ç›¸å…³çš„csså˜é‡ æ¯”å¦‚padding</span>
    <span class="token function">genSizeSmallButtonStyle</span><span class="token punctuation">(</span>buttonToken<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">genSizeBaseButtonStyle</span><span class="token punctuation">(</span>buttonToken<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">genSizeLargeButtonStyle</span><span class="token punctuation">(</span>buttonToken<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Block</span>
    <span class="token comment">// è®¾ç½®å—å…ƒç´ æ ·å¼ width:100%</span>
    <span class="token function">genBlockButtonStyle</span><span class="token punctuation">(</span>buttonToken<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Group (type, ghost, danger, disabled, loading)</span>
    <span class="token comment">// è®¾ç½®ä¸åŒtypeçš„buttonçš„é¢œè‰²ï¼Œ [`${componentCls}-default`]: genDefaultButtonStyle(token),</span>
    <span class="token function">genTypeButtonStyle</span><span class="token punctuation">(</span>buttonToken<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Button Group</span>
    <span class="token comment">// æŒ‰é’®ç»„ç›¸å…³æ ·å¼</span>
    <span class="token function">genGroupStyle</span><span class="token punctuation">(</span>buttonToken<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// Space Compact</span>
    <span class="token function">genCompactItemStyle</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token punctuation">{</span> focus<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">genCompactItemVerticalStyle</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><img src="/assets/img/token.7ff69dbb.png" alt="center"> <img src="/assets/img/tokenInfo.0deabf4d.png" alt="center"> <p>3ã€åœ¨ <code>genComponentStyleHook</code> æ–¹æ³•ä¸­ è°ƒç”¨äº† <code>@ant-design/cssinjs</code> ä¸­çš„ <code>useStyleRegister</code> æ–¹æ³•ï¼Œç”¨äºç”Ÿæˆ <code>wrapSSR, hashId</code> è¿™ä¸¤ä¸ªä¸œè¥¿</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token generic-function"><span class="token function">genComponentStyleHook</span><span class="token generic class-name"><span class="token operator">&lt;</span>
  ComponentName <span class="token keyword">extends</span> OverrideComponent
<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
  component<span class="token operator">:</span> ComponentName<span class="token punctuation">,</span> <span class="token comment">//ç»„ä»¶åå­—</span>
  <span class="token function-variable function">styleFn</span><span class="token operator">:</span> <span class="token punctuation">(</span>
    token<span class="token operator">:</span> FullToken<span class="token operator">&lt;</span>ComponentName<span class="token operator">&gt;</span><span class="token punctuation">,</span>
    info<span class="token operator">:</span> StyleInfo<span class="token operator">&lt;</span>ComponentName<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span> <span class="token operator">=&gt;</span> CSSInterpolation<span class="token punctuation">,</span>
  getDefaultToken<span class="token operator">?</span><span class="token operator">:</span>
    <span class="token operator">|</span> OverrideTokenWithoutDerivative<span class="token punctuation">[</span>ComponentName<span class="token punctuation">]</span>
    <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>token<span class="token operator">:</span> GlobalToken<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> OverrideTokenWithoutDerivative<span class="token punctuation">[</span>ComponentName<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>prefixCls<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> UseComponentStyleResult <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>theme<span class="token punctuation">,</span> token<span class="token punctuation">,</span> hashId<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> getPrefixCls<span class="token punctuation">,</span> iconPrefixCls <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>ConfigContext<span class="token punctuation">)</span>
    <span class="token keyword">const</span> rootPrefixCls <span class="token operator">=</span> <span class="token function">getPrefixCls</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Generate style for all a tags in antd component.</span>
    <span class="token function">useStyleRegister</span><span class="token punctuation">(</span>
      <span class="token punctuation">{</span> theme<span class="token punctuation">,</span> token<span class="token punctuation">,</span> hashId<span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Shared'</span><span class="token punctuation">,</span> rootPrefixCls<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// Link</span>
          <span class="token string-property property">'&amp;'</span><span class="token operator">:</span> <span class="token function">genLinkStyle</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// æ­¤å¤„è¿”å›äº† wrapSSR, hashId</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>
      <span class="token function">useStyleRegister</span><span class="token punctuation">(</span>
        <span class="token punctuation">{</span> theme<span class="token punctuation">,</span> token<span class="token punctuation">,</span> hashId<span class="token punctuation">,</span> path<span class="token operator">:</span> <span class="token punctuation">[</span>component<span class="token punctuation">,</span> prefixCls<span class="token punctuation">,</span> iconPrefixCls<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// ...çœç•¥</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      hashId<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬å…¶å®å¯ä»¥çœ‹åˆ° <code>genComponentStyleHook</code> è¿™ä¸ªå‡½æ•°é‡Œé¢ä¸»è¦å°±æ˜¯è°ƒç”¨äº† <code>@ant-design/cssinjs</code> ä¸­çš„ <code>useStyleRegister</code> æ–¹æ³•ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ä¸­éƒ½åšäº†ä»€ä¹ˆå¤„ç†</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Register a style to the global style sheet.
 */</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">useStyleRegister</span><span class="token punctuation">(</span><span class="token parameter">info<span class="token punctuation">,</span> styleFn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...çœç•¥</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> styleNode
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ssrInline <span class="token operator">||</span> isMergedClientSide <span class="token operator">||</span> <span class="token operator">!</span>defaultCache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      styleNode <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>Empty<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> _ref4
      styleNode <span class="token operator">=</span> <span class="token comment">/*#__PURE__*/</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
        <span class="token string">'style'</span><span class="token punctuation">,</span>
        <span class="token function">_extends</span><span class="token punctuation">(</span>
          <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">(</span><span class="token punctuation">(</span>_ref4 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">_defineProperty</span><span class="token punctuation">(</span>_ref4<span class="token punctuation">,</span> <span class="token constant">ATTR_TOKEN</span><span class="token punctuation">,</span> cachedTokenKey<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">_defineProperty</span><span class="token punctuation">(</span>_ref4<span class="token punctuation">,</span> <span class="token constant">ATTR_MARK</span><span class="token punctuation">,</span> cachedStyleId<span class="token punctuation">)</span><span class="token punctuation">,</span>
          _ref4<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">dangerouslySetInnerHTML</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">__html</span><span class="token operator">:</span> cachedStyleStr<span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token comment">/*#__PURE__*/</span> React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>
      React<span class="token punctuation">.</span>Fragment<span class="token punctuation">,</span>
      <span class="token keyword">null</span><span class="token punctuation">,</span>
      styleNode<span class="token punctuation">,</span>
      node
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æˆ‘ä»¬å…¶å®å¯ä»¥çœ‹åˆ°<code>useStyleRegister</code> çš„å¤§è‡´é€»è¾‘å°±æ˜¯</p> <ul><li>æ³¨å†Œä¸€ä¸ª<code>style</code>æ ‡ç­¾æ’å…¥åˆ°<code>header</code>ä¸­ï¼Œå¹¶å°†å¤„ç†å¥½äº†æ ·å¼å­—ç¬¦ä¸² æ’å…¥åˆ°ç”Ÿæˆçš„<code>style</code>æ ‡ç­¾ä¸­å»</li> <li>æœ€åä¼šä½¿ç”¨<code>React.createElement</code> å»æ¸²æŸ“æˆ‘ä»¬ <code>wrapSSR</code> æ–¹æ³•ä¸­ä¼ å…¥çš„ <code>node</code> èŠ‚ç‚¹ï¼Œæ­¤å¤„æŒ‡çš„å°±æ˜¯ <code>button</code> æŒ‰é’®</li></ul> <p>æœ€å <code>antd</code>ä¸­ä¼šä½¿ç”¨ <code>classnames</code>ç»„åˆå¤šä¸ª <code>class</code> ç±»å ï¼Œå¹¶ä¼ é€’ç»™ <code>button</code> ç»„ä»¶</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">const</span> classes <span class="token operator">=</span> <span class="token function">classNames</span><span class="token punctuation">(</span>
  prefixCls<span class="token punctuation">,</span>
  hashId<span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>shape<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> shape <span class="token operator">!==</span> <span class="token string">'default'</span> <span class="token operator">&amp;&amp;</span> shape<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">type</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> type<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sizeCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> sizeCls<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-icon-only</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token operator">!</span>children <span class="token operator">&amp;&amp;</span> children <span class="token operator">!==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token operator">!</span>iconType<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-background-ghost</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> ghost <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isUnBorderedButtonType</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-loading</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> innerLoading<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-two-chinese-chars</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span>
      hasTwoCNChar <span class="token operator">&amp;&amp;</span> autoInsertSpace <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>innerLoading<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-block</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> block<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-dangerous</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>danger<span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-rtl</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> direction <span class="token operator">===</span> <span class="token string">'rtl'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefixCls<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-disabled</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> hrefAndDisabled<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  compactItemClassnames<span class="token punctuation">,</span>
  className<span class="token punctuation">,</span>
  rootClassName
<span class="token punctuation">)</span>

<span class="token keyword">let</span> buttonNode <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>button
    <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">(</span>rest <span class="token keyword">as</span> NativeButtonProps<span class="token punctuation">)</span><span class="token punctuation">}</span>
    type<span class="token operator">=</span><span class="token punctuation">{</span>htmlType<span class="token punctuation">}</span>
    className<span class="token operator">=</span><span class="token punctuation">{</span>classes<span class="token punctuation">}</span> <span class="token comment">// ç±»åé›†åˆ</span>
    onClick<span class="token operator">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span>
    disabled<span class="token operator">=</span><span class="token punctuation">{</span>mergedDisabled<span class="token punctuation">}</span>
    ref<span class="token operator">=</span><span class="token punctuation">{</span>buttonRef<span class="token punctuation">}</span>
  <span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>iconNode<span class="token punctuation">}</span>
    <span class="token punctuation">{</span>kids<span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token punctuation">)</span>

<span class="token comment">//wrapSSRç”± useStyleRegister æ–¹æ³•è¿”å›</span>
<span class="token keyword">return</span> <span class="token function">wrapSSR</span><span class="token punctuation">(</span>buttonNode<span class="token punctuation">)</span>
</code></pre></div><p>æ€»ç»“ï¼š</p> <p>é¦–å…ˆåœ¨ç»„ä»¶å†…çš„ <code>useStyle</code> ä¼ å…¥äº† <code>warpSSR</code> å’Œ <code>hashID</code> ï¼Œæ‰§è¡Œ <code>genComponentStyleHook</code> ï¼Œæœ€ç»ˆè¿”å› <code>useStyleRegister</code> è¿™ä¸ªå‡½æ•°å¹¶ä¼ å…¥ <code>styleFnï¼ŒuseStyleRegister</code> æœ€åä¼šè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šå»æ¸²æŸ“æˆ‘ä»¬åŒ…è£¹çš„ç»„ä»¶ï¼Œæ¯”å¦‚ <code>buttonï¼Œ</code>è€Œä¸”è¿˜ä¼šå°†ä¸€äº›æ ·å¼é€šè¿‡åˆ›å»º
<code>style</code> æ ‡ç­¾çš„æ–¹å¼æ’å…¥åˆ° <code>header</code> ä¸­ã€‚åœ¨<code>@ant-design/cssinjs</code>å†…éƒ¨å’Œ Â·antdÂ· ä¸­æœ‰ä¸€å¥—è‡ªå·±çš„åŸºæœ¬ä¸»é¢˜ï¼Œå®šä¹‰äº†ä¸€äº›åŸºæœ¬çš„æ ·å¼å˜é‡ï¼Œæ¯ä¸€ä¸ªç»„ä»¶é€šè¿‡ <code>configProvider</code> å¯ä»¥æ‹¿åˆ°å…·ä½“çš„å±æ€§æ ·å¼ï¼Œä»è€Œè¦†ç›–è®¾ç½®æ¯ä¸€ä¸ªç»„ä»¶çš„æ ·å¼</p> <h2 id="ç»„ä»¶åº“æ–‡æ¡£è®¾è®¡"><a href="#ç»„ä»¶åº“æ–‡æ¡£è®¾è®¡" class="header-anchor">#</a> ç»„ä»¶åº“æ–‡æ¡£è®¾è®¡</h2> <p><code>antd5</code> æ•´ä¸ªæ¡†æ¶æ–‡æ¡£æ¶æ„æ˜¯ç”¨<a href="https://d.umijs.org/guide" target="_blank" rel="noopener noreferrer">dump<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>æ¥åšçš„ï¼Œé¡¹ç›®ä¸­å¦‚æœä½ æƒ³åœ¨ <code>markdown</code>æ–‡æ¡£é‡Œé¢å¼•å…¥<code>react</code>ç»„ä»¶çš„è¯ï¼Œåªéœ€è¦å¦‚ä¸‹æ‰€ç¤ºï¼š</p> <div class="language-md extra-class"><pre class="language-md"><code><span class="token comment">&lt;!-- æ ‡è¯†è¿™ä¸ªexampleä¸‹é¢çš„å°±æ˜¯ä»£ç  --&gt;</span>

<span class="token title important"><span class="token punctuation">##</span> Examples</span>

<span class="token comment">&lt;!-- prettier-ignore --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./demo/basic.tsx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Basic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./demo/on-change.tsx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Callback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./demo/target.tsx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Container to scroll.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./demo/debug.tsx<span class="token punctuation">&quot;</span></span> <span class="token attr-name">debug</span><span class="token punctuation">&gt;</span></span>debug<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>æ­¤å¤„çš„å¤„ç†åº”è¯¥æ˜¯ <code>dump</code> å†…éƒ¨å®ç°äº†ä¸€ä¸ª <code>markdown</code> çš„æ’ä»¶ ,è¯¥æ’ä»¶ä¼šå»è§£æ <code>markdown</code>ï¼Œå¦‚æœå‘ç°æœ‰ <code>## Examples</code> çš„æ ‡è¯†å°±å›å»è§£æå®ƒä¸‹é¢çš„ä»£ç  ï¼ŒæŠŠä»–é›†æˆåˆ°ä¸€ä¸ªè‡ªå·±å†…éƒ¨å®ç°çš„ <code>react</code> ç¯å¢ƒä¸­ å»æ¸²æŸ“</p> <p>æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±äº†è§£ä¸€ä¸‹ <code>dump</code> çš„å†…éƒ¨å®ç°</p> <h2 id="ç»„ä»¶åº“æ‰“åŒ…"><a href="#ç»„ä»¶åº“æ‰“åŒ…" class="header-anchor">#</a> ç»„ä»¶åº“æ‰“åŒ…</h2> <p>åœ¨<code>antd</code>çš„<code>package.json</code>æ–‡ä»¶ä¸­ï¼Œæœ‰è¿™ä¹ˆä¸€æ®µæ‰“åŒ…å‘½ä»¤</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run compile &amp;&amp; cross-env  NODE_OPTIONS='--max-old-space-size=4096' npm run dist&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;clean&quot;</span><span class="token operator">:</span> <span class="token string">&quot;antd-tools run clean &amp;&amp; rm -rf es lib coverage dist report.html&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;compile&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run clean &amp;&amp; antd-tools run compile&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;dist&quot;</span><span class="token operator">:</span> <span class="token string">&quot;antd-tools run dist&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å½“æˆ‘ä»¬æ‰§è¡Œ <code>npm run build</code>å‘½ä»¤çš„æ—¶å€™ï¼Œä»–ä¼šå…ˆå»æ‰§è¡Œ <code>npm run compile</code>å‘½ä»¤å°†ç»„ä»¶åº“ç¼–è¯‘åˆ°<code>libå’Œes</code>ç›®å½•ä¸‹é¢ï¼Œç„¶åé€šè¿‡ <code>cross-env NODE_OPTIONS='--max-old-space-size=4096'</code>æŒ‡ä»¤å¯ä»¥è®¾ç½®è¿è¡Œåé¢çš„ <code>npm run dist</code>å‘½ä»¤çš„æ—¶å€™ï¼Œç³»ç»Ÿç»™ node åˆ†é…çš„å†…å­˜å¤§å°ï¼Œå› ä¸ºé»˜è®¤ node åœ¨ä¸€äº› 64 ä½è®¡ç®—æœºä¸­è¿è¡Œçš„æ—¶å€™ï¼Œé»˜è®¤åˆ†é…çš„å†…å­˜ä½¿ç”¨æœ€å¤§ä¸ä¼šè¶…è¿‡ <code>2G</code></p> <p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹æ¯ä¸€ä¸ª<code>npm run compile</code> å’Œ <code>npm run dist</code>å‘½ä»¤éƒ½æ˜¯å¹²äº†ä»€ä¹ˆ</p> <p><code>npm run compile</code>:
æ‰§è¡Œè¿™ä¸ªå‘½ä»¤çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…ˆæ‰§è¡Œ<code>npm run clean</code>è¿™ä¸ªå‘½ä»¤åˆ é™¤äº†ä¸€äº›å†å²çš„æ‰“åŒ…æ–‡ä»¶ä¹‹ç±»çš„ï¼Œç„¶åä¸»è¦æ‰§è¡Œçš„æ˜¯ <code>antd-tools run compile</code> è¿™ä¸ªå‘½ä»¤ ï¼Œ<code>antd-tools</code>æ˜¯ <code>@ant-design</code> åº“ä¸­çš„ä¸€ä¸ªå·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™å„¿çœ‹åˆ°
<img src="/assets/img/antd-tools.c0e31ec0.png" alt="center"></p> <p>é¦–å…ˆï¼Œä»–ä¼šå»æ‰§è¡Œ<code>node_modules\@ant-design\tools\lib\cli\index.js</code> ç›®å½•ä¸‹é¢çš„æ–‡ä»¶ï¼Œæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token hashbang comment">#!/usr/bin/env node</span>

<span class="token string">'use strict'</span>

<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> gulp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'gulp'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> argv <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'minimist'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> cloneArgs <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>argv <span class="token punctuation">}</span>
<span class="token keyword">delete</span> cloneArgs<span class="token punctuation">.</span>_

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
  chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">'Execute:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span>argv<span class="token punctuation">.</span>_<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'-'</span><span class="token punctuation">,</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cloneArgs<span class="token punctuation">)</span>
<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'  - Args:'</span><span class="token punctuation">,</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>cloneArgs<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../gulpfile'</span><span class="token punctuation">)</span>

<span class="token comment">// Start glup task</span>
<span class="token keyword">function</span> <span class="token function">runTask</span><span class="token punctuation">(</span><span class="token parameter">toRun</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> metadata <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">task</span><span class="token operator">:</span> toRun <span class="token punctuation">}</span>
  <span class="token comment">// Gulp &gt;= 4.0.0 (doesn't support events)</span>
  <span class="token keyword">const</span> taskInstance <span class="token operator">=</span> gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>toRun<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>taskInstance <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gulp<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'task_not_found'</span><span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
    <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> start <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">hrtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  gulp<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'task_start'</span><span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//æ‰§è¡Œtaskä»»åŠ¡</span>
    <span class="token function">taskInstance</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>gulp<span class="token punctuation">)</span>
    metadata<span class="token punctuation">.</span>hrDuration <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">hrtime</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span>
    <span class="token comment">//è§¦å‘ä»»åŠ¡</span>
    gulp<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'task_stop'</span><span class="token punctuation">,</span> metadata<span class="token punctuation">)</span>
    gulp<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'stop'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    err<span class="token punctuation">.</span>hrDuration <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">hrtime</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span>
    err<span class="token punctuation">.</span>task <span class="token operator">=</span> metadata<span class="token punctuation">.</span>task
    gulp<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'task_err'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//æ‰§è¡Œæ–¹æ³•,è·å–åˆ°å‘½ä»¤å‚æ•°ï¼Œæ¯”å¦‚ npm run compile çš„ compile</span>
<span class="token function">runTask</span><span class="token punctuation">(</span>argv<span class="token punctuation">.</span>_<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>å½“æ‰§è¡Œåˆ° <code>compile</code>å‘½ä»¤çš„æ—¶å€™ï¼Œä¸»è¦ä¼šå»æ‰§è¡Œ <code>gulpfile</code>ä¸­çš„ <code>compile</code> ä»»åŠ¡,å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//ä½¿ç”¨babelè½¬åŒ–js</span>
<span class="token keyword">function</span> <span class="token function">babelify</span><span class="token punctuation">(</span><span class="token parameter">js<span class="token punctuation">,</span> modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> babelConfig <span class="token operator">=</span> <span class="token function">getBabelCommonConfig</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span> <span class="token comment">//è·å–åˆ°babelé…ç½®</span>
  <span class="token keyword">delete</span> babelConfig<span class="token punctuation">.</span>cacheDirectory
  <span class="token keyword">if</span> <span class="token punctuation">(</span>modules <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//è‡ªå®šä¹‰äº†ä¸€ä¸ªbabelæ’ä»¶ï¼Œç”¨äºæ›¿ä»£å°†é¡¹ç›®ä¸­å¼•ç”¨libä¸‹é¢çš„è·¯å¾„è½¬åŒ–ä¸ºesçš„æ¨¡å—è·¯å¾„</span>
    babelConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>replaceLib<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> stream <span class="token operator">=</span> js<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">babel</span><span class="token punctuation">(</span>babelConfig<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">//è¾“å‡ºåˆ°åˆ¶å®šç›®å½•</span>
  <span class="token keyword">return</span> stream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span>modules <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">?</span> esDir <span class="token operator">:</span> libDir<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">compile</span><span class="token operator">:</span> <span class="token punctuation">{</span> transformTSFile<span class="token punctuation">,</span> transformFile <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  rimraf<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>modules <span class="token operator">!==</span> <span class="token boolean">false</span> <span class="token operator">?</span> libDir <span class="token operator">:</span> esDir<span class="token punctuation">)</span> <span class="token comment">//moduleå¦‚æœæ˜¯trueçš„è¯ï¼Œå°±åˆ é™¤libæ–‡ä»¶å¤¹ï¼Œå¦åˆ™åˆ é™¤esæ–‡ä»¶å¤¹</span>

  <span class="token comment">//å°†componentsç›®å½•ä¸‹é¢çš„æ‰€æœ‰å­ç›®å½•ä¸­çš„ png å’Œ svg æ–‡ä»¶æ‹·è´åˆ°libæˆ–è€…es</span>
  <span class="token keyword">const</span> assets <span class="token operator">=</span> gulp
    <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'components/**/*.@(png|svg)'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span>modules <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">?</span> esDir <span class="token operator">:</span> libDir<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> error <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token comment">// =============================== FILE ===============================</span>
  <span class="token keyword">let</span> transformFileStream

  <span class="token keyword">if</span> <span class="token punctuation">(</span>transformFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transformFileStream <span class="token operator">=</span> gulp
      <span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'components/**/*.tsx'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
        through2<span class="token punctuation">.</span><span class="token function">obj</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> nextFile <span class="token operator">=</span> <span class="token function">transformFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">||</span> file
          nextFile <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>nextFile<span class="token punctuation">)</span> <span class="token operator">?</span> nextFile <span class="token operator">:</span> <span class="token punctuation">[</span>nextFile<span class="token punctuation">]</span>
          nextFile<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span>modules <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">?</span> esDir <span class="token operator">:</span> libDir<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ================================ TS ================================</span>
  <span class="token comment">//æ–‡ä»¶åŒ¹é…è§„åˆ™</span>
  <span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'components/**/*.tsx'</span><span class="token punctuation">,</span>
    <span class="token string">'components/**/*.ts'</span><span class="token punctuation">,</span>
    <span class="token string">'typings/**/*.d.ts'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/**/__tests__/**'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/**/demo/**'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/**/design/**'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>

  <span class="token comment">// allow jsx file in components/xxx/</span>
  <span class="token comment">//æ˜¯å¤Ÿå…è®¸jsæ–‡ä»¶ï¼Œå…è®¸çš„è¯å°±å¾€æ•°ç»„å‰é¢åŠ ä¸Šå¯¹jsxæ–‡ä»¶çš„åŒ¹é…è§„åˆ™</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>tsConfig<span class="token punctuation">.</span>allowJs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    source<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span><span class="token string">'components/**/*.jsx'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Strip content if needed</span>
  <span class="token comment">// gulp.src() æ–¹æ³•æ ¹æ®æ–‡ä»¶åŒ¹é…è§„åˆ™è·å–æºæ–‡ä»¶çš„è¯»å–æµï¼ˆsource streamï¼‰</span>
  <span class="token comment">// é€šè¿‡è·å–æºæ–‡ä»¶çš„è¯»å–æµï¼Œåç»­çš„æ„å»ºä»»åŠ¡å¯ä»¥ä½¿ç”¨è¿™ä¸ªæµæ¥è¯»å–å’Œå¤„ç†æºæ–‡ä»¶ï¼Œç”Ÿæˆæœ€ç»ˆçš„æ„å»ºäº§ç‰©ã€‚</span>
  <span class="token keyword">let</span> sourceStream <span class="token operator">=</span> gulp<span class="token punctuation">.</span><span class="token function">src</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>modules <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//å¦‚æœç¼–è¯‘esï¼Œ ä½¿ç”¨ stripCode æ’ä»¶æ¥åˆ é™¤æºä»£ç ä¸­çš„ç‰¹å®šæ³¨é‡Šæ®µè½ã€‚</span>
    <span class="token comment">//åˆ é™¤ start_comment å’Œ end_comment ä¹‹é—´çš„æ‰€æœ‰ä»£ç </span>
    sourceStream <span class="token operator">=</span> sourceStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      <span class="token function">stripCode</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">start_comment</span><span class="token operator">:</span> <span class="token string">'@remove-on-es-build-begin'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">end_comment</span><span class="token operator">:</span> <span class="token string">'@remove-on-es-build-end'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>transformTSFile<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sourceStream <span class="token operator">=</span> sourceStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
      through2<span class="token punctuation">.</span><span class="token function">obj</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">file<span class="token punctuation">,</span> encoding<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> nextFile <span class="token operator">=</span> <span class="token function">transformTSFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span> <span class="token operator">||</span> file
        nextFile <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>nextFile<span class="token punctuation">)</span> <span class="token operator">?</span> nextFile <span class="token operator">:</span> <span class="token punctuation">[</span>nextFile<span class="token punctuation">]</span>
        nextFile<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">f</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//ä½¿ç”¨tsæ’ä»¶ç¼–è¯‘æ–‡ä»¶ä¸­çš„tsä»£ç ï¼Œç”Ÿæˆå¯¹åº”çš„ç±»å‹ç”³æ˜æ–‡ä»¶ .d.tsç»“å°¾</span>
  <span class="token keyword">const</span> tsResult <span class="token operator">=</span> sourceStream<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>
    <span class="token function">ts</span><span class="token punctuation">(</span>tsConfig<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function">error</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tsDefaultReporter<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        error <span class="token operator">=</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token literal-property property">finish</span><span class="token operator">:</span> tsDefaultReporter<span class="token punctuation">.</span>finish<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>argv<span class="token punctuation">[</span><span class="token string">'ignore-error'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  tsResult<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> check<span class="token punctuation">)</span>
  tsResult<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> check<span class="token punctuation">)</span>
  <span class="token keyword">const</span> tsFilesStream <span class="token operator">=</span> <span class="token function">babelify</span><span class="token punctuation">(</span>tsResult<span class="token punctuation">.</span>js<span class="token punctuation">,</span> modules<span class="token punctuation">)</span>
  <span class="token comment">//è¾“å‡ºåˆ°æŒ‡å®šç›®å½•</span>
  <span class="token keyword">const</span> tsd <span class="token operator">=</span> tsResult<span class="token punctuation">.</span>dts<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>gulp<span class="token punctuation">.</span><span class="token function">dest</span><span class="token punctuation">(</span>modules <span class="token operator">===</span> <span class="token boolean">false</span> <span class="token operator">?</span> esDir <span class="token operator">:</span> libDir<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment">//åˆå¹¶å¤šä¸ªæ–‡ä»¶æ“ä½œæµ</span>
  <span class="token keyword">return</span> <span class="token function">merge2</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>tsFilesStream<span class="token punctuation">,</span> tsd<span class="token punctuation">,</span> assets<span class="token punctuation">,</span> transformFileStream<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s<span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'compile-with-es'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Parallel] Compile to es...'</span><span class="token punctuation">)</span>
  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> done<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'compile-with-lib'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Parallel] Compile to js...'</span><span class="token punctuation">)</span>
  <span class="token function">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'finish'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">generateLocale</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span><span class="token string">'compile-finalize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Additional process of compile finalize</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">compile</span><span class="token operator">:</span> <span class="token punctuation">{</span> finalize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>finalize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Compile] Finalization...'</span><span class="token punctuation">)</span>
    <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>
  <span class="token string">'compile'</span><span class="token punctuation">,</span>
  gulp<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span>
    gulp<span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token string">'compile-with-es'</span><span class="token punctuation">,</span> <span class="token string">'compile-with-lib'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'compile-finalize'</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p>æ³¨æ„ç‚¹ï¼š</p> <p>1ã€å…¶ä¸­æœ‰ä¸€ä¸ª <code>getBabelCommonConfig</code> æ–¹æ³•å»è·å–<code>babel</code>é…ç½®ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è¿™ä¸ªæ–‡ä»¶çš„é…ç½®æ˜¯ä»€ä¹ˆä»¥åŠæ€ä¹ˆé…ç½®çš„ï¼Œå…·ä½“å†…å®¹å¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>
  resolve<span class="token punctuation">,</span>
  isThereHaveBrowserslistConfig<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/projectHelper'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> plugins <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span>
      <span class="token comment">//ç”¨äºå°†TypeScriptä»£ç è½¬æ¢ä¸ºJavaScriptä»£ç </span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/plugin-transform-typescript'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">isTSX</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>
      <span class="token comment">//æä¾›äº†ä¸€ç§åœ¨ç¼–è¯‘ES6+ä»£ç æ—¶ä½¿ç”¨babel-runtimeæ¥é¿å…é‡å¤æ³¨å…¥å¸®åŠ©ç¨‹åºçš„æ–¹å¼ã€‚</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/plugin-transform-runtime'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">/**è¯‘å™¨å°†ç”Ÿæˆ ES6 æ¨¡å—çš„ä»£ç ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨ import/export è¯­æ³•æ¥å¯¼å…¥/å¯¼å‡ºæ¨¡å—ã€‚
         * å¦‚æœ useESModules è¢«è®¾ç½®ä¸º falseï¼Œåˆ™ç¼–è¯‘å™¨å°†ç”Ÿæˆ CommonJS æ¨¡å—çš„ä»£ç ï¼Œ
         * è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä½¿ç”¨ require/module.exports
         * è¯­æ³•æ¥å¯¼å…¥/å¯¼å‡ºæ¨¡å—ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒBabel 7+ ä¼šå°† useESModules è®¾ç½®ä¸º falseï¼Œ */</span>
        <span class="token literal-property property">useESModules</span><span class="token operator">:</span> modules <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">version</span><span class="token operator">:</span>
          <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/package.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>dependencies<span class="token punctuation">[</span>
            <span class="token string">'@babel/runtime'</span>
          <span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'^7.10.4'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//è¯¥æ’ä»¶ç”¨äºå°†ES6+ä¸­çš„æ‰©å±•è¿ç®—ç¬¦ï¼ˆspread operatorï¼‰è½¬æ¢ä¸ºES5ä»£ç ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ä¸æ”¯æŒè¯¥è¯­æ³•çš„æ—§ç‰ˆæµè§ˆå™¨ä¸­è¿è¡Œã€‚</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/plugin-transform-spread'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//è¯¥æ’ä»¶ç”¨äºå°†ES6+ä¸­çš„ç±»å±æ€§ï¼ˆclass propertiesï¼‰è½¬æ¢ä¸ºES5ä»£ç ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ä¸æ”¯æŒè¯¥è¯­æ³•çš„æ—§ç‰ˆæµè§ˆå™¨ä¸­è¿è¡Œã€‚</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//è¯¥æ’ä»¶ç”¨äºå°†ES6+ä¸­çš„ç±»ï¼ˆclassï¼‰è½¬æ¢ä¸ºES5ä»£ç ï¼Œä»¥ä¾¿å®ƒä»¬å¯ä»¥åœ¨ä¸æ”¯æŒè¯¥è¯­æ³•çš„æ—§ç‰ˆæµè§ˆå™¨ä¸­è¿è¡Œã€‚</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/plugin-transform-classes'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//æ’ä»¶ç”¨äºåœ¨å¼€å‘ç¯å¢ƒä¸­æ·»åŠ è­¦å‘Šä¿¡æ¯ï¼Œä»¥å¸®åŠ©å¼€å‘äººå‘˜æ›´å¥½åœ°è°ƒè¯•ä»£ç ã€‚å®ƒä¼šåœ¨æ§åˆ¶å°ä¸­è¾“å‡ºç±»ä¼¼äºâ€œWarning: Some warning messageâ€çš„æ¶ˆæ¯</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-transform-dev-warning'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
  <span class="token comment">//åŒ…å«äº† Babel è½¬æ¢æ‰€éœ€çš„ preset å’Œ pluginsã€‚å…¶ä¸­ï¼Œ</span>
  <span class="token comment">// @babel/preset-react ç”¨äºè½¬æ¢ React ä»£ç ï¼Œ</span>
  <span class="token comment">// @babel/preset-env ç”¨äºè½¬æ¢ ES6+ ä»£ç ï¼Œ</span>
  <span class="token comment">// æ ¹æ® modules å‚æ•°åˆ¤æ–­æ˜¯å¦å¯ç”¨æ¨¡å—è½¬æ¢ï¼Œ</span>
  <span class="token comment">// targets é€‰é¡¹æŒ‡å®šäº† Babel è½¬æ¢çš„ç›®æ ‡æµè§ˆå™¨æˆ–è€… Node.js ç‰ˆæœ¬ï¼Œè¿™é‡Œå¦‚æœå­˜åœ¨</span>
  <span class="token comment">//  .browserslistrc æ–‡ä»¶åˆ™ä¸è¿›è¡ŒæŒ‡å®šã€‚è¿”å›çš„å¯¹è±¡ä¸­è¿˜åŒ…å«äº†ä¹‹å‰å®šä¹‰çš„ plugins æ•°ç»„ã€‚</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/preset-react'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          modules<span class="token punctuation">,</span>
          <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token function">isThereHaveBrowserslistConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token operator">?</span> <span class="token keyword">undefined</span>
            <span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                  <span class="token string">'last 2 versions'</span><span class="token punctuation">,</span>
                  <span class="token string">'Firefox ESR'</span><span class="token punctuation">,</span>
                  <span class="token string">'&gt; 1%'</span><span class="token punctuation">,</span>
                  <span class="token string">'ie &gt;= 11'</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    plugins<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2ã€åœ¨é¡¹ç›®ä¸­ï¼Œè¿˜å®šä¹‰å®ç°äº†ä¸€ä¸ª <code>babel</code>æ’ä»¶ <code>replaceLib</code> ,è¯¥æ’ä»¶ä¸»è¦çš„ä½œç”¨å°±æ˜¯æ›¿æ¢ä»£ç ä¸­çš„ä¸€äº›å†…å®¹ï¼Œå¦‚ä¸‹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">'use strict'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> dirname <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> getProjectPath <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./utils/projectHelper'</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">replacePath</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source <span class="token operator">&amp;&amp;</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\/lib\/</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//ç¼–è¯‘esè§„åˆ™æ—¶ï¼Œå¦‚æœä»£ç çš„importè¯­å¥é‡Œé¢æœ‰å¼•å…¥æŸä¸ªåŒ…çš„libæ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆä¿®æ”¹libä¸ºes</span>
    <span class="token keyword">const</span> esModule <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'/lib/'</span><span class="token punctuation">,</span> <span class="token string">'/es/'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> esPath <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token function">getProjectPath</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> esModule<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>esPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value <span class="token operator">=</span> esModule
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//æ›¿æ¢iconçš„å¼•ç”¨è·¯å¾„</span>
  <span class="token comment">// @ant-design/icons/xxx =&gt; @ant-design/icons/es/icons/xxx</span>
  <span class="token keyword">const</span> antdIconMatcher <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">@ant-design\/icons\/([^/]*)$</span><span class="token regex-delimiter">/</span></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source <span class="token operator">&amp;&amp;</span> antdIconMatcher<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> esModule <span class="token operator">=</span> path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>
      antdIconMatcher<span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> iconName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@ant-design/icons/es/icons/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>iconName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
    <span class="token keyword">const</span> esPath <span class="token operator">=</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token function">getProjectPath</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> esModule<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>esPath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">.</span>node<span class="token punctuation">.</span>source<span class="token punctuation">.</span>value <span class="token operator">=</span> esModule
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">replaceLib</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//åŒ¹é…å¯¼å…¥astèŠ‚ç‚¹</span>
      <span class="token literal-property property">ImportDeclaration</span><span class="token operator">:</span> replacePath<span class="token punctuation">,</span>
      <span class="token comment">//åŒ¹é…å¯¼å‡ºastèŠ‚ç‚¹</span>
      <span class="token literal-property property">ExportNamedDeclaration</span><span class="token operator">:</span> replacePath<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> replaceLib
</code></pre></div><p><code>compile</code>å‘½ä»¤æœ€åè¿˜æœ‰ä¸€æ­¥ <code>compile-finalize</code>ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡åªæ˜¯å¯¹é¡¹ç›®ä¸­çš„ä¸€äº›ç‰¹å®šæ–‡ä»¶è¿›è¡Œäº†ä¸€ä¸ªå¤åˆ¶æ“ä½œï¼Œå°†<code>components</code>ä¸‹é¢çš„ä¸€äº›æ–‡ä»¶ç§»åŠ¨åˆ°äº†<code>eså’Œlib</code>ç›®å½•ä¸‹é¢ï¼Œæ­¤å¤„å°±ä¸å¤šåšè§£é‡Šäº†ï¼Œ</p> <p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹ <code>npm run build</code>å‘½ä»¤çš„ååŠéƒ¨åˆ†ï¼Œ<code>npm run dist</code>çš„å®ç°ï¼š</p> <p><strong>ç–‘é—®</strong>.
æ­¤å¤„æŠ›å‡ºä¸€ä¸ªç–‘é—®ï¼Œå…¶å®ç»å†è¿‡äº†<code>compile</code>é˜¶æ®µï¼Œç»„ä»¶å·²ç»èƒ½å¤Ÿä½¿ç”¨å¹¶ä¸”æ”¯æŒ es6 å’Œ commonjs è§„èŒƒçš„å¼•å…¥ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦ä¸€ä¸ª dist æ‰“åŒ…çš„ min æ–‡ä»¶å‘¢ï¼Ÿ</p> <p><strong>è§£ç­”</strong>.</p> <ul><li>Ant Design ç”Ÿæˆçš„ es å’Œ lib ç›®å½•åˆ†åˆ«åŒ…å«äº† ES Module å’Œ CommonJS Module æ ¼å¼çš„ä»£ç ï¼Œç”¨äºä¸åŒçš„æ¨¡å—åŠ è½½å™¨å’Œæ‰“åŒ…å·¥å…·ã€‚es ç›®å½•ä¸­çš„ä»£ç å¯ä»¥è¢« Webpack ç­‰æ‰“åŒ…å·¥å…·ç›´æ¥å¼•å…¥ï¼Œè€Œ lib ç›®å½•ä¸­çš„ä»£ç åˆ™é€‚ç”¨äº Node.js å’Œä¸€äº›å…¶ä»–çš„æ‰“åŒ…å·¥å…·ã€‚è€Œ dist ç›®å½•åˆ™æ˜¯ä¸“é—¨ä¸ºæµè§ˆå™¨ç«¯æ‰“åŒ…å‡†å¤‡çš„ï¼Œå…¶ä¸­çš„ä»£ç å·²ç»ç»è¿‡äº†å‹ç¼©å’Œä¼˜åŒ–ï¼Œå¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ã€‚ä½¿ç”¨ Ant Design çš„ç”¨æˆ·å¯ä»¥ç›´æ¥å¼•å…¥ dist ç›®å½•ä¸­çš„æ–‡ä»¶ï¼Œè€Œæ— éœ€å…³å¿ƒå…·ä½“çš„æ¨¡å—åŠ è½½æ–¹å¼å’Œæ‰“åŒ…å·¥å…·ã€‚</li></ul> <p><code>npm run dist</code>:
<code>antd</code>åœ¨ç”Ÿæˆ<code>dist</code>åŒ…çš„è¿‡ç¨‹ä¸»è¦ä½¿ç”¨äº†<code>webpack</code>çš„æ‰“åŒ…ï¼Œæ‰§è¡Œ<code>npm run dist</code>çš„æ—¶å€™ï¼Œæœ€ä¸­ä¼šå»æ‰§è¡Œ ä¸€ä¸ª åä¸º <code>dist</code>çš„ gulp ä»»åŠ¡ï¼Œåœ¨ dist ä»»åŠ¡ä¸­ï¼Œå†å»è°ƒç”¨ dist å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code>gulp<span class="token punctuation">.</span><span class="token function">task</span><span class="token punctuation">(</span>
  <span class="token string">'dist'</span><span class="token punctuation">,</span>
  gulp<span class="token punctuation">.</span><span class="token function">series</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">dist</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div><p><code>distæ–¹æ³•</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dist</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//é¦–å…ˆåˆ é™¤distæ–‡ä»¶ç›®å½•</span>
  rimraf<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token function">getProjectPath</span><span class="token punctuation">(</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">RUN_ENV</span> <span class="token operator">=</span> <span class="token string">'PRODUCTION'</span> <span class="token comment">//è®¾ç½®ç¯å¢ƒå˜é‡ä¸ºç”Ÿäº§</span>
  <span class="token keyword">const</span> webpackConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token function">getProjectPath</span><span class="token punctuation">(</span><span class="token string">'webpack.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//åŠ è½½webpacké…ç½®æ–‡ä»¶</span>
  <span class="token comment">//æ‰§è¡Œæ‰“åŒ…</span>
  <span class="token function">webpack</span><span class="token punctuation">(</span>webpackConfig<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> stats</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>stack <span class="token operator">||</span> err<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>details<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> info <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">dist</span><span class="token operator">:</span> <span class="token punctuation">{</span> finalize <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> bail <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//å¦‚æœæ„å»ºçš„è¿‡ç¨‹ä¸­æœ‰é”™è¯¯</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasErrors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">;</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>errors <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// https://github.com/ant-design/ant-design/pull/31662</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>bail<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//å¦‚æœæ„å»ºçš„è¿‡ç¨‹ä¸­æœ‰è­¦å‘Š</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>stats<span class="token punctuation">.</span><span class="token function">hasWarnings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>info<span class="token punctuation">.</span>warnings<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//æ‰“å°æ„å»ºä¹‹åçš„äº§ç‰©ä¿¡æ¯</span>
    <span class="token keyword">const</span> buildInfo <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">colors</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">children</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkModules</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>buildInfo<span class="token punctuation">)</span>

    <span class="token comment">// Additional process of dist finalizeï¼Œä¸€äº›æ–‡ä»¶çš„ç§»åŠ¨</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>finalize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'[Dist] Finalization...'</span><span class="token punctuation">)</span>
      <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//ç»“æŸ</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç„¶åæˆ‘ä»¬æ¥çœ‹çœ‹ <code>antd</code> çš„ <code>webpack</code>è¯¦ç»†é…ç½®ï¼Œè¿™é‡Œæˆ‘ç²˜è´´äº†å¤§è‡´çš„é…ç½®é¡¹</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//åŠ è½½ä¸€äº›babelé…ç½®</span>
<span class="token keyword">const</span> babelConfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./getBabelCommonConfig'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>modules <span class="token operator">||</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token comment">// babel import for components æŒ‰éœ€åŠ è½½</span>
babelConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-import'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryName</span><span class="token operator">:</span> pkg<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
    <span class="token literal-property property">libraryDirectory</span><span class="token operator">:</span> <span class="token string">'components'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// Other package  æŒ‰éœ€å¼•å…¥css</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>name <span class="token operator">!==</span> <span class="token string">'antd'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  babelConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-import'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">style</span><span class="token operator">:</span> <span class="token string">'css'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">libraryDirectory</span><span class="token operator">:</span> <span class="token string">'es'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">libraryName</span><span class="token operator">:</span> <span class="token string">'antd'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">'other-package-babel-plugin-import'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">//åŠ å…¥äº†è‡ªå®šä¹‰çš„babelæ’ä»¶ï¼Œç”¨æ¥æ›¿æ¢ä»£ç ä¸­çš„ä¸€äº›è¯­æ³•</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>modules <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  babelConfig<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'./replaceLib'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">devtool</span><span class="token operator">:</span> <span class="token string">'source-map'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token string">'D:\\gitee\\antd5-react-doc\\dist\\'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">library</span><span class="token operator">:</span> <span class="token string">'antd'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">libraryTarget</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span> <span class="token comment">//umdçš„æ‰“åŒ…æ¨¡å¼</span>
    <span class="token literal-property property">globalObject</span><span class="token operator">:</span> <span class="token string">'this'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">'.web.tsx'</span><span class="token punctuation">,</span>
      <span class="token string">'.web.ts'</span><span class="token punctuation">,</span>
      <span class="token string">'.web.jsx'</span><span class="token punctuation">,</span>
      <span class="token string">'.web.js'</span><span class="token punctuation">,</span>
      <span class="token string">'.ts'</span><span class="token punctuation">,</span>
      <span class="token string">'.tsx'</span><span class="token punctuation">,</span>
      <span class="token string">'.js'</span><span class="token punctuation">,</span>
      <span class="token string">'.jsx'</span><span class="token punctuation">,</span>
      <span class="token string">'.json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">antd</span><span class="token operator">:</span> <span class="token string">'å½“å‰é¡¹ç›®ç›®å½•'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">child_process</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">cluster</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dgram</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dns</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fs</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">net</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">readline</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">repl</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">tls</span><span class="token operator">:</span> <span class="token string">'empty'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">noParse</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">moment.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//ä¸éœ€è¦è§£æ</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'babel-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> babelConfig<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'babel-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> babelConfig<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'ts-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">transpileOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'css-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'postcss-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token literal-property property">postcssOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'autoprefixer'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
              <span class="token punctuation">}</span><span class="token punctuation">,</span>
              <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// Images</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.svg(\?v=\d+\.\d+\.\d+)?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
          <span class="token literal-property property">minetype</span><span class="token operator">:</span> <span class="token string">'image/svg+xml'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpg|jpeg|gif)(\?v=\d+\.\d+\.\d+)?$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'url-loader'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">limit</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">CaseSensitivePathsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//è¯¥æ’ä»¶ä¼šè‡ªåŠ¨æ£€æŸ¥æ¨¡å—è·¯å¾„çš„å¤§å°å†™æ˜¯å¦æ­£ç¡®,ä¸»è¦ç”¨äºæ£€æµ‹è·¯å¾„çš„å¤§å°å†™ï¼Œåœ¨ Windows æ“ä½œç³»ç»Ÿä¸­ï¼Œæ–‡ä»¶åçš„å¤§å°å†™æ˜¯ä¸åŒºåˆ†çš„</span>
    <span class="token comment">//æ’å…¥å•†æ ‡</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>BannerPlugin</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> v</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>pkg<span class="token punctuation">.</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">

Copyright 2015-present, Alipay, Inc.
All rights reserved.
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// åœ¨ç»ˆç«¯ä¸­æ˜¾ç¤º Webpack æ„å»ºè¿›åº¦æ¡å’Œæ„å»ºçŠ¶æ€</span>
    <span class="token keyword">new</span> <span class="token class-name">WebpackBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'ğŸšš  Ant Design Tools'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'#2f54eb'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//æ¸…ç† Webpack æ„å»ºè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ stats æ–‡ä»¶</span>
    <span class="token keyword">new</span> <span class="token class-name">CleanUpStatsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">//æ»¤ Webpack æ„å»ºè¿‡ç¨‹ä¸­äº§ç”Ÿçš„è­¦å‘Šä¿¡æ¯</span>
    <span class="token keyword">new</span> <span class="token class-name">FilterWarningsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// suppress conflicting order warnings from mini-css-extract-plugin.</span>
      <span class="token comment">// ref: https://github.com/ant-design/ant-design/issues/14895</span>
      <span class="token comment">// see https://github.com/webpack-contrib/mini-css-extract-plugin/issues/250</span>
      <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">mini-css-extract-plugin[^]*Conflicting order between:</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">//performance å±æ€§ç”¨äºæ§åˆ¶æ„å»ºæ€§èƒ½çš„ç›¸å…³è®¾ç½®</span>
  <span class="token comment">/**
   * å½“ hints å±æ€§çš„å€¼ä¸º false æ—¶ï¼ŒWebpack å°†ä¸ä¼šè¾“å‡ºä»»ä½•æ€§èƒ½æç¤ºä¿¡æ¯ã€‚è¿™æ„å‘³ç€ï¼Œ
   * æ— è®ºæ„å»ºè¿‡ç¨‹ä¸­çš„æ–‡ä»¶å¤§å°ã€æ„å»ºæ—¶é—´ç­‰æ˜¯å¦è¶…è¿‡äº†é¢„è®¾çš„é™åˆ¶ï¼ŒWebpack éƒ½å°†ä¸ä¼šå‘å‡ºä»»ä½•è­¦å‘Šæˆ–é”™è¯¯ä¿¡æ¯ï¼Œè€Œæ˜¯ç®€å•åœ°ç»§ç»­è¿›è¡Œæ„å»ºã€‚
   */</span>
  <span class="token literal-property property">performance</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">hints</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//éœ€è¦åœ¨ä»£ç ä¸­å¼•ç”¨ä¸€äº›å¤–éƒ¨ä¾èµ–åº“ï¼Œä¾‹å¦‚å…¨å±€å˜é‡æˆ– CDN èµ„æºï¼Œå‡å°æ‰“åŒ…ä½“ç§¯</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'React'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">commonjs2</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">commonjs</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">amd</span><span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">'react-dom'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'ReactDOM'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">commonjs2</span><span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">commonjs</span><span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">amd</span><span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dayjs</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token string">'dayjs'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">commonjs2</span><span class="token operator">:</span> <span class="token string">'dayjs'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">commonjs</span><span class="token operator">:</span> <span class="token string">'dayjs'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">amd</span><span class="token operator">:</span> <span class="token string">'dayjs'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minimizer</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">UglifyJsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parallel</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">sourceMap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">uglifyOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">warnings</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//å…¥å£</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'antd.min'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./index'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//è¯­è¨€çš„å…¥å£</span>
    <span class="token string-property property">'antd-with-locales.min'</span><span class="token operator">:</span> <span class="token string">'./index-with-locales.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">mode</span><span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é€šè¿‡è¿™äº›æˆ‘ä»¬å°±å¯ä»¥æ‰“åŒ…ç”Ÿæˆ <code>antd.min.js</code></p> <h2 id="ç»„ä»¶åº“å•å…ƒæµ‹è¯•"><a href="#ç»„ä»¶åº“å•å…ƒæµ‹è¯•" class="header-anchor">#</a> ç»„ä»¶åº“å•å…ƒæµ‹è¯•</h2> <p><code>antd5</code>ä¸­çš„å•å…ƒæµ‹è¯•ä¸»è¦ç”¨çš„æ˜¯ <code>jest</code>å·¥å…·ï¼Œ<code>Jest</code> æ˜¯ <code>Facebook</code> å‡ºå“çš„ä¸€ä¸ªæµ‹è¯•æ¡†æ¶ï¼Œç›¸å¯¹å…¶ä»–æµ‹è¯•æ¡†æ¶ï¼Œå…¶ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å°±æ˜¯å†…ç½®äº†å¸¸ç”¨çš„æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚è‡ªå¸¦æ–­è¨€ã€<code>Mock</code> åŠŸèƒ½ã€æµ‹è¯•è¦†ç›–ç‡å·¥å…·ï¼Œå®ç°äº†å¼€ç®±å³ç”¨ï¼Œåœ¨<code>package.json</code>çš„ <code>script</code>å­—æ®µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸€ä¸ªå‘½ä»¤ï¼š</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token property">&quot;script&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --config .jest.js --no-cache&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>jest</code> çš„æµ‹è¯•è„šæœ¬åå½¢å¦‚ <code>*.test.js</code>ï¼Œä¸è®º <code>Jest</code> æ˜¯å…¨å±€è¿è¡Œè¿˜æ˜¯é€šè¿‡ <code>npm run test</code> è¿è¡Œï¼Œå®ƒéƒ½ä¼šæ‰§è¡Œå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„<code>*.test.js æˆ– *.spec.js</code> æ–‡ä»¶ã€å®Œæˆæµ‹è¯•ã€‚</p> <p>ä¸‹é¢æˆ‘ä»¬å»çœ‹çœ‹ <code>.jest.js</code>è¿™ä¸ªé…ç½®æ–‡ä»¶çš„å†…å®¹ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// å®šéœ€è¦ç¼–è¯‘çš„æ¨¡å—åˆ—è¡¨</span>
<span class="token keyword">const</span> compileModules <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">'dnd-core'</span><span class="token punctuation">,</span>
  <span class="token string">'react-sticky-box'</span><span class="token punctuation">,</span>
  <span class="token string">'tween-one'</span><span class="token punctuation">,</span>
  <span class="token string">'@babel'</span><span class="token punctuation">,</span>
  <span class="token string">'@ant-design'</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">const</span> ignoreList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// cnpm use `_` as prefix</span>
<span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">prefix</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  compileModules<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ignoreList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prefix<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>module<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// å¿½ç•¥è½¬æ¢æ¨¡å—çš„æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨</span>
<span class="token comment">// åŒ¹é… node_modules ç›®å½•ä¸‹çš„æ¨¡å—ï¼Œä½†æ˜¯æ’é™¤ ignoreList ä¸­æŒ‡å®šçš„æ¨¡å—</span>
<span class="token keyword">const</span> transformIgnorePatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token comment">// Ignore modules without es dir.</span>
  <span class="token comment">// Update: @babel/runtime should also be transformed</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/node_modules/(?!</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ignoreList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)[^/]+?/(?!(es)/)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">getTestRegex</span><span class="token punctuation">(</span><span class="token parameter">libDir</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'dist'</span><span class="token punctuation">,</span> <span class="token string">'lib'</span><span class="token punctuation">,</span> <span class="token string">'es'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>libDir<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'demo\\.test\\.(j|t)sx?$'</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token string">'.*\\.test\\.(j|t)sx?$'</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">verbose</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// æŒ‡ç¤ºæ˜¯å¦åº”åœ¨è¿è¡ŒæœŸé—´æŠ¥å‘Šæ¯ä¸ªæµ‹è¯•</span>
  <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">'jsdom'</span><span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨ JSDOM è¿è¡Œæµ‹è¯•</span>
  <span class="token literal-property property">setupFiles</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./tests/setup.js'</span><span class="token punctuation">,</span> <span class="token string">'jest-canvas-mock'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æŒ‡å®šåœ¨æ‰§è¡Œæµ‹è¯•ä¹‹å‰éœ€è¦è¿è¡Œçš„æ–‡ä»¶</span>
  <span class="token literal-property property">setupFilesAfterEnv</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'./tests/setupAfterEnv.ts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æŒ‡å®šåœ¨æ‰§è¡Œæµ‹è¯•ä¹‹åéœ€è¦è¿è¡Œçš„æ–‡ä»¶</span>
  <span class="token literal-property property">moduleFileExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'ts'</span><span class="token punctuation">,</span> <span class="token string">'tsx'</span><span class="token punctuation">,</span> <span class="token string">'js'</span><span class="token punctuation">,</span> <span class="token string">'jsx'</span><span class="token punctuation">,</span> <span class="token string">'json'</span><span class="token punctuation">,</span> <span class="token string">'md'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// å…è®¸ Jest è§£æçš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨</span>
  <span class="token literal-property property">modulePathIgnorePatterns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'/_site/'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// æŒ‡å®š Jest å¿½ç•¥çš„æ¨¡å—è·¯å¾„ï¼Œè¿™é‡ŒåŒ…æ‹¬ /_site/</span>
  <span class="token comment">// æŒ‡å®šæ¨¡å—åç§°çš„æ˜ å°„å…³ç³»ï¼Œç”¨äºå°†æŒ‡å®šçš„æ¨¡å—åç§°è½¬æ¢ä¸ºå¦ä¸€ä¸ªæ¨¡å—åç§°ã€‚</span>
  <span class="token literal-property property">moduleNameMapper</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'/\\.(css|less)$/'</span><span class="token operator">:</span> <span class="token string">'identity-obj-proxy'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'^antd$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/components/index'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'^antd/es/(.*)$'</span><span class="token operator">:</span> <span class="token string">'&lt;rootDir&gt;/components/$1'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// å¿½ç•¥ç‰¹å®šæµ‹è¯•æ–‡ä»¶çš„æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨</span>
  <span class="token literal-property property">testPathIgnorePatterns</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'/node_modules/'</span><span class="token punctuation">,</span>
    <span class="token string">'dekko'</span><span class="token punctuation">,</span>
    <span class="token string">'node'</span><span class="token punctuation">,</span>
    <span class="token string">'image.test.js'</span><span class="token punctuation">,</span>
    <span class="token string">'image.test.ts'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// æŒ‡å®šè½¬æ¢å™¨ï¼ˆpreprocessorï¼‰çš„æ˜ å°„å…³ç³»ï¼Œç”¨äºå°†æŒ‡å®šç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º JavaScript ä»£ç </span>
  <span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'\\.tsx?$'</span><span class="token operator">:</span> <span class="token string">'./node_modules/@ant-design/tools/lib/jest/codePreprocessor'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'\\.(m?)js$'</span><span class="token operator">:</span> <span class="token string">'./node_modules/@ant-design/tools/lib/jest/codePreprocessor'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'\\.md$'</span><span class="token operator">:</span> <span class="token string">'./node_modules/@ant-design/tools/lib/jest/demoPreprocessor'</span><span class="token punctuation">,</span>
    <span class="token string-property property">'\\.(jpg|png|gif|svg)$'</span><span class="token operator">:</span>
      <span class="token string">'./node_modules/@ant-design/tools/lib/jest/imagePreprocessor'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// æŒ‡å®š Jest åº”è¯¥è¿è¡Œå“ªäº›æµ‹è¯•</span>
  <span class="token literal-property property">testRegex</span><span class="token operator">:</span> <span class="token function">getTestRegex</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">LIB_DIR</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// æŒ‡å®šå“ªäº›æ–‡ä»¶éœ€è¦æ”¶é›†ä»£ç è¦†ç›–ç‡ä¿¡æ¯ã€‚</span>
  <span class="token literal-property property">collectCoverageFrom</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">'components/**/*.{ts,tsx}'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/*/style/index.tsx'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/style/index.tsx'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/*/locale/index.tsx'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/*/__tests__/type.test.tsx'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/**/*/interface.{ts,tsx}'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/*/__tests__/image.test.{ts,tsx}'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/__tests__/node.test.tsx'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/*/demo/*.tsx'</span><span class="token punctuation">,</span>
    <span class="token string">'!components/*/design/**'</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  transformIgnorePatterns<span class="token punctuation">,</span> <span class="token comment">// å¿½ç•¥è½¬æ¢æ¨¡å—çš„æ­£åˆ™è¡¨è¾¾å¼åˆ—è¡¨,è½¬æ¢å™¨è¦å¿½ç•¥çš„è·¯å¾„</span>
  <span class="token comment">// è¯•ç¯å¢ƒä¸­å¯ä½¿ç”¨çš„å…¨å±€å˜é‡</span>
  <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">'ts-jest'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">tsConfig</span><span class="token operator">:</span> <span class="token string">'./tsconfig.test.json'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">testEnvironmentOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'http://localhost'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// bail: true,</span>
  <span class="token literal-property property">maxWorkers</span><span class="token operator">:</span> <span class="token string">'50%'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å»çœ‹çœ‹ <code>antd</code> ä¸­ç»„ä»¶çš„æµ‹è¯•ç”¨ä¾‹æ€ä¹ˆå†™çš„ï¼Œä»¥ <code>Button</code> ç»„ä»¶ä¸ºä¾‹ï¼Œä¸‹é¢æˆ‘åªæ˜¯æˆªå–äº†ä¸€éƒ¨åˆ†çš„<code>Button</code>æµ‹è¯•ç”¨ä¾‹</p> <p>ç›¸å…³å‡½æ•°</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// æŒ‚è½½æµ‹è¯•</span>
<span class="token comment">// eslint-disable-next-line jest/no-export</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">mountTest</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Component</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ComponentType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">mount and unmount</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// https://github.com/ant-design/ant-design/pull/18441</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">component could be updated and unmounted without errors</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// æ­¤å¤„çš„renderæ–¹æ³•ç”± @testing-library/react å·¥å…·æä¾›</span>
      <span class="token comment">// è¿”å›ä¸€ä¸ªæ¸²æŸ“å’Œå¸è½½æ–¹æ³•</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> unmount<span class="token punctuation">,</span> rerender <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">rerender</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">unmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¡¨ç¤ºå‰é¢çš„è¯­å¥ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæœ‰å¼‚å¸¸åˆ™æµ‹è¯•å¤±è´¥ã€‚</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Right-to-Leftï¼Œä»å³å‘å·¦ï¼‰æ–¹å‘ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°æ¸²æŸ“</span>
<span class="token keyword">const</span> <span class="token function-variable function">rtlTest</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Component</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ComponentType<span class="token punctuation">,</span> mockDate <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'rtl render'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'component should be rendered correctly in RTL direction'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mockDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        MockDate<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token function">dayjs</span><span class="token punctuation">(</span><span class="token string">'2000-09-28'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>ConfigProvider direction<span class="token operator">=</span><span class="token string">&quot;rtl&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>Component <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>ConfigProvider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// ç„¶åå°†æ¸²æŸ“ç»“æœçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¸ä¹‹å‰ä¿å­˜çš„å¿«ç…§è¿›è¡Œæ¯”è¾ƒ</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>mockDate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        MockDate<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> resetWarned <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'rc-util/lib/warning'</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">import</span> Button <span class="token keyword">from</span> <span class="token string">'..'</span>
<span class="token keyword">import</span> mountTest <span class="token keyword">from</span> <span class="token string">'../../../tests/shared/mountTest'</span>
<span class="token keyword">import</span> rtlTest <span class="token keyword">from</span> <span class="token string">'../../../tests/shared/rtlTest'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> render <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../../../tests/utils'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Button'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// æŒ‚è½½æµ‹è¯•</span>
  <span class="token function">mountTest</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span>
  <span class="token function">mountTest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Button size<span class="token operator">=</span><span class="token string">&quot;large&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
  <span class="token comment">// Right-to-Leftï¼Œä»å³å‘å·¦ï¼‰æ–¹å‘ä¸‹æ˜¯å¦èƒ½å¤Ÿæ­£ç¡®åœ°æ¸²æŸ“</span>
  <span class="token function">rtlTest</span><span class="token punctuation">(</span>Button<span class="token punctuation">)</span>
  <span class="token function">rtlTest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Button size<span class="token operator">=</span><span class="token string">&quot;large&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
  <span class="token function">rtlTest</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>Button size<span class="token operator">=</span><span class="token string">&quot;small&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>

  <span class="token comment">// å°†æ¸²æŸ“ç»“æœçš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¸ä¹‹å‰ä¿å­˜çš„å¿«ç…§è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœä¸ä¸€è‡´åˆ™æµ‹è¯•å¤±è´¥</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> container <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>Follow<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchSnapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'mount correctly'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// è¡¨ç¤ºå‰é¢çš„è¯­å¥ä¸åº”è¯¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæœ‰å¼‚å¸¸åˆ™æµ‹è¯•å¤±è´¥ã€‚</span>
    <span class="token function">expect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>Follow<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'warns if size is wrong'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resetWarned</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// é‡ç½®è­¦å‘Šä¿¡æ¯çŠ¶æ€</span>
    <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿçš„ console.error å‡½æ•°ï¼Œä»¥ä¾¿åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­æ•è·è­¦å‘Šä¿¡æ¯</span>
    <span class="token keyword">const</span> mockWarn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">spyOn</span><span class="token punctuation">(</span>console<span class="token punctuation">,</span> <span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mockImplementation</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> size <span class="token operator">=</span> <span class="token string">'who am I'</span>
    <span class="token comment">// @ts-expect-error: Type '&quot;who am I&quot;' is not assignable to type 'SizeType'.ts(2322)</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token punctuation">.</span>Group size<span class="token operator">=</span><span class="token punctuation">{</span>size<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
    <span class="token comment">// è¡¨ç¤ºæ£€æŸ¥æ˜¯å¦æ•è·åˆ°äº†è­¦å‘Šä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ¯æ˜¯å¦åŒ…å«ç‰¹å®šçš„å†…å®¹</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>mockWarn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledWith</span><span class="token punctuation">(</span>
      <span class="token string">'Warning: [antd: Button.Group] Invalid prop `size`.'</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// è¿˜åŸæ¨¡æ‹Ÿçš„ console.error å‡½æ•°çš„å®ç°</span>
    mockWarn<span class="token punctuation">.</span><span class="token function">mockRestore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders Chinese characters correctly in HOC'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">Text</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">children</span><span class="token operator">:</span> React<span class="token punctuation">.</span>ReactNode <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>span<span class="token operator">&gt;</span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> container<span class="token punctuation">,</span> rerender <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Text<span class="token operator">&gt;</span>æŒ‰é’®<span class="token operator">&lt;</span><span class="token operator">/</span>Text<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ant-btn'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveClass</span><span class="token punctuation">(</span>
      <span class="token string">'ant-btn-two-chinese-chars'</span>
    <span class="token punctuation">)</span>

    <span class="token function">rerender</span><span class="token punctuation">(</span>
      <span class="token operator">&lt;</span>Button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>Text<span class="token operator">&gt;</span>å¤§æŒ‰é’®<span class="token operator">&lt;</span><span class="token operator">/</span>Text<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">&gt;</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// éªŒè¯æ˜¯å¦æœ‰è¿™ä¸ªclass ç±»</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.ant-btn'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toHaveClass</span><span class="token punctuation">(</span>
      <span class="token string">'ant-btn-two-chinese-chars'</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ts-node"><a href="#ts-node" class="header-anchor">#</a> ts-node</h2> <p><code>ts-node</code> æ˜¯ä¸€ä¸ª<code>Node.js</code>çš„æ‰§è¡Œç¯å¢ƒï¼Œå®ƒå¯ä»¥è®©ä½ åœ¨<code>Node.js</code> ç¯å¢ƒä¸­ç›´æ¥è¿è¡Œ<code>TypeScript</code> ä»£ç ã€‚ å®ƒé€šè¿‡åœ¨è¿è¡Œæ—¶å°†<code>TypeScript</code> è½¬è¯‘ä¸º<code>JavaScript</code>æ¥å®ç°è¿™ä¸€ç‚¹ï¼Œå› æ­¤ä½ ä¸éœ€è¦åœ¨ç¼–å†™<code>TypeScript</code>ä»£ç ä¹‹å‰å…ˆå°†å…¶è½¬è¯‘ä¸º<code>JavaScript</code>ã€‚</p> <h2 id="pre-publish-çš„ä¸€äº›æ£€æŸ¥"><a href="#pre-publish-çš„ä¸€äº›æ£€æŸ¥" class="header-anchor">#</a> pre-publish çš„ä¸€äº›æ£€æŸ¥</h2> <p>åœ¨<code>antd</code>å‘å¸ƒæ–°çš„ç‰ˆæœ¬ä¹‹å‰ï¼Œå†…éƒ¨ä¼šå…ˆæ‰§è¡Œä¸€ä¸ª <code>npm run pre-publish</code>å‘½ä»¤ï¼Œæ”¹å‘½ä»¤ä¼šå¯¹é¡¹ç›®ä¸­çš„ä¸€äº›é…ç½®æˆ–è€…ä»£ç è§„èŒƒåšä¸€ä¸ªæ£€æŸ¥ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;pre-publish&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run test-all -- --skip-build&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test-all&quot;</span><span class="token operator">:</span> <span class="token string">&quot;sh -e ./scripts/test-all.sh&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ‰§è¡Œ <code>pre-publish</code> å‘½ä»¤æœ€åä¼šå»æ‰§è¡Œä¸€ä¸ª <code>shell</code>è„šæœ¬æ–‡ä»¶ï¼Œæ ¹æ®è¿™ä¸ªè„šæœ¬çš„å‘½ä»¤ï¼Œæˆ‘ä»¬æ¥ä¾æ¬¡ç ”ç©¶ä»–çš„å‘½ä»¤æ­¥éª¤</p> <p>é¦–å…ˆï¼šæ‰§è¡Œ<code>check-commit</code> å‘½ä»¤ï¼Œæ£€æŸ¥å„ç§é¢„å‘å¸ƒçš„æ¡ä»¶ï¼ˆç‰ˆæœ¬å·ï¼Œåˆ†æ”¯ï¼Œgit çš„çŠ¶æ€ statusï¼Œè¿œç¨‹ä»“åº“æ˜¯å¦å¯ä»¥è¿æ¥ï¼‰</p> <p>ä¸‹é¢æ˜¯ç›¸å…³è„šæœ¬ï¼š</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* eslint-disable import/no-dynamic-require, no-console */</span>
<span class="token keyword">const</span> chalk <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'chalk'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fetch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'isomorphic-fetch'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> simpleGit <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'simple-git'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> cwd <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> git <span class="token operator">=</span> <span class="token function">simpleGit</span><span class="token punctuation">(</span>cwd<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> version <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>cwd<span class="token punctuation">,</span> <span class="token string">'package.json'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">exitProcess</span><span class="token punctuation">(</span><span class="token parameter">code <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span> <span class="token comment">// Keep an empty line here to make looks good~</span>
  process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> versions <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'http://registry.npmjs.org/antd'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>version <span class="token keyword">in</span> versions<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>
          <span class="token string">'ğŸ˜ˆ Current version already exists. Forget update package.json?'</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token string">' =&gt; Current:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> version<span class="token punctuation">)</span>
      <span class="token function">exitProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'ğŸš¨ Check version failed. Skip...'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkBranch</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> current <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>
    version<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-alpha.'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    version<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-beta.'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    version<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-rc.'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
    version<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'-experimental.'</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">cyan</span><span class="token punctuation">(</span><span class="token string">'ğŸ˜ƒ Alpha version. Skip branch check.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token string">'master'</span> <span class="token operator">&amp;&amp;</span> current <span class="token operator">!==</span> <span class="token string">'4.0-prepare'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">'ğŸ¤” You are not in the master branch!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token function">exitProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkCommit</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> files <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>files<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span><span class="token string">'ğŸ™„ You forgot something to commit.'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    files<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> filePath<span class="token punctuation">,</span> <span class="token literal-property property">working_dir</span><span class="token operator">:</span> mark <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">' -'</span><span class="token punctuation">,</span> chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span>mark<span class="token punctuation">)</span><span class="token punctuation">,</span> filePath<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">exitProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkRemote</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> remote <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> git<span class="token punctuation">.</span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'origin'</span><span class="token punctuation">,</span> <span class="token string">'master'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>remote<span class="token operator">?.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'ant-design/ant-design'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
        chalk<span class="token punctuation">.</span><span class="token function">yellow</span><span class="token punctuation">(</span>
          <span class="token string">'ğŸ˜“ Your remote origin is not ant-design/ant-design, did you fork it?'</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
      <span class="token function">exitProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">red</span><span class="token punctuation">(</span><span class="token string">'ğŸš¨ Check remote failed. Skip...'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">checkAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> status <span class="token operator">=</span> <span class="token keyword">await</span> git<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">await</span> <span class="token function">checkVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">await</span> <span class="token function">checkBranch</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>

  <span class="token keyword">await</span> <span class="token function">checkCommit</span><span class="token punctuation">(</span>status<span class="token punctuation">)</span>

  <span class="token keyword">await</span> <span class="token function">checkRemote</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">checkAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>ç„¶åç¬¬äºŒæ­¥ä¼šå»æ‰§è¡Œï¼š<code>npm run lint</code></p> <p><code>npm run lint</code> å‘½ä»¤ä¼šå°†æ–°çš„ç‰ˆæœ¬å·å†™å…¥åˆ° <code>version.ts</code> ä¸­</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs-extra'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> version <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../package.json'</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>
  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">,</span> <span class="token string">'components'</span><span class="token punctuation">,</span> <span class="token string">'version'</span><span class="token punctuation">,</span> <span class="token string">'version.ts'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">export default '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">';</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token string">'utf8'</span>
<span class="token punctuation">)</span>
</code></pre></div><p>ç„¶åä¼šå»æ‰§è¡Œ <code>tsc --noEmit</code> å‘½ä»¤</p> <p>æ‰§è¡Œ<code>tsc --noEmit</code>, <code>TSC</code> ä¼šè¯»å–é…ç½®æ–‡ä»¶è·å–å‚æ•°å€¼ï¼Œ<code>--noEmit</code>çš„ä½œç”¨æ˜¯åªè¿›è¡Œæ£€æŸ¥ï¼Œä¸è¿›è¡Œç¼–è¯‘è¾“å‡ºã€‚å¦‚æœæˆ‘ä»¬çš„ä»£ç æ— é”™ï¼Œä¼šç›´æ¥é€€å‡ºï¼Œå¦åˆ™æŠ¥é”™</p> <p>æœ€åä¼šå»æ‰§è¡Œ <code>npm run test</code> å‘½ä»¤</p> <p>å°±æ˜¯ä¼šè·‘ä¸€éé¡¹ç›®é‡Œé¢çš„å•å…ƒæµ‹è¯•ï¼Œåªæœ‰æ‰€æœ‰çš„å•å…ƒæµ‹è¯•éƒ½é€šè¿‡äº†ï¼Œæ‰èƒ½è¾¾åˆ°å‘å¸ƒçš„æ ‡å‡†</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest --config .jest.js --no-cache&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;test-node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm run version &amp;&amp; jest --config .jest.node.js --no-cache&quot;</span> <span class="token comment">//æ‰§è¡Œnodeç¯å¢ƒä¸‹çš„å•å…ƒæµ‹è¯•æ–‡ä»¶</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="æŒ‰éœ€åŠ è½½"><a href="#æŒ‰éœ€åŠ è½½" class="header-anchor">#</a> æŒ‰éœ€åŠ è½½</h2></div> <footer class="page-edit"><!----> <!----></footer> <div><div class="page-nav"><p class="inner"><span class="prev">
      â†
      <a href="/å‰ç«¯ç”Ÿæ€/flutteræ¶ˆæ¯æ¨é€.html" class="prev">
        flutteræ¶ˆæ¯æ¨é€
      </a></span> <span class="next"><a href="/å‰ç«¯ç”Ÿæ€/element-plusæ¶æ„åˆ†æ.html">
        element-plusæ ·å¼+æ‰“åŒ…åˆ†æ
      </a>
      â†’
    </span></p></div> <div class="icp-footer"><p>CopyrightÂ© 2022-2023 _å¦„æƒ³ä½•æ–¹</p> <a href="https://beian.miit.gov.cn/" target="_blank">èœ€ICPå¤‡2022010321å·-1</a></div></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a5e2a326.js" defer></script><script src="/assets/js/2.a6634917.js" defer></script><script src="/assets/js/7.5b3397e2.js" defer></script><script src="/assets/js/11.8af1e3cd.js" defer></script>
  </body>
</html>
