<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>抽象语法树(Abstract Syntax Tree) | 学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="前端技术相关的文章，包含不限于vue，react，webpack，nodejs，算法等等">
    
    <link rel="preload" href="/assets/css/0.styles.1bd58bef.css" as="style"><link rel="preload" href="/assets/js/app.a5e2a326.js" as="script"><link rel="preload" href="/assets/js/2.a6634917.js" as="script"><link rel="preload" href="/assets/js/3.c79fccf9.js" as="script"><link rel="preload" href="/assets/js/11.8af1e3cd.js" as="script"><link rel="prefetch" href="/assets/js/10.d3f689f8.js"><link rel="prefetch" href="/assets/js/12.ed1e11ae.js"><link rel="prefetch" href="/assets/js/13.e0a441de.js"><link rel="prefetch" href="/assets/js/14.9e318840.js"><link rel="prefetch" href="/assets/js/15.d841da4f.js"><link rel="prefetch" href="/assets/js/16.34930d07.js"><link rel="prefetch" href="/assets/js/17.07cd49aa.js"><link rel="prefetch" href="/assets/js/18.39517720.js"><link rel="prefetch" href="/assets/js/19.1f1689c7.js"><link rel="prefetch" href="/assets/js/20.84a7ddf3.js"><link rel="prefetch" href="/assets/js/21.d47f1b28.js"><link rel="prefetch" href="/assets/js/22.3f16cfa0.js"><link rel="prefetch" href="/assets/js/23.f86859e1.js"><link rel="prefetch" href="/assets/js/24.b73b4835.js"><link rel="prefetch" href="/assets/js/25.d3f53bc9.js"><link rel="prefetch" href="/assets/js/26.ee307239.js"><link rel="prefetch" href="/assets/js/27.eaad36cd.js"><link rel="prefetch" href="/assets/js/28.2ea9696e.js"><link rel="prefetch" href="/assets/js/29.0f3fa806.js"><link rel="prefetch" href="/assets/js/30.9a0696b4.js"><link rel="prefetch" href="/assets/js/31.89a9820d.js"><link rel="prefetch" href="/assets/js/32.dba916d1.js"><link rel="prefetch" href="/assets/js/33.4c1838f9.js"><link rel="prefetch" href="/assets/js/34.968a05eb.js"><link rel="prefetch" href="/assets/js/35.88ee813d.js"><link rel="prefetch" href="/assets/js/36.ec349609.js"><link rel="prefetch" href="/assets/js/37.7f17ec10.js"><link rel="prefetch" href="/assets/js/38.1844a26b.js"><link rel="prefetch" href="/assets/js/39.3f1bd3ec.js"><link rel="prefetch" href="/assets/js/4.baf3274c.js"><link rel="prefetch" href="/assets/js/40.e03e4557.js"><link rel="prefetch" href="/assets/js/41.a69c6022.js"><link rel="prefetch" href="/assets/js/42.705f89ae.js"><link rel="prefetch" href="/assets/js/43.9fb62012.js"><link rel="prefetch" href="/assets/js/5.f40b1275.js"><link rel="prefetch" href="/assets/js/6.4eaec7b1.js"><link rel="prefetch" href="/assets/js/7.5b3397e2.js"><link rel="prefetch" href="/assets/js/8.7c035891.js"><link rel="prefetch" href="/assets/js/9.0f0a6fdc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1bd58bef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/doc-front-end" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/doc-front-end" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">主页</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript/小顶堆.html" class="sidebar-link">小顶堆</a></li><li><a href="/JavaScript/位运算.html" class="sidebar-link">位运算</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>React Fiber</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/React-Fiber/React理念.html" class="sidebar-link">React理念</a></li><li><a href="/React/React-Fiber/ReactFiber架构.html" class="sidebar-link">Fiber架构</a></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>React Fiber Render</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/React-Fiber/Fiber-dom-diff/beginWork.html" class="sidebar-link">beginWork阶段</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/completeWork.html" class="sidebar-link">completeWork阶段</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/commit.html" class="sidebar-link">commit阶段</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/domdiff.html" class="sidebar-link">completeWork-diff阶段</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>Concurrent Mode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/Concurrent-Mode/React中的事件优先级调度.html" class="sidebar-link">React事件优先级调度</a></li><li><a href="/React/Concurrent-Mode/scheduler.html" class="sidebar-link">scheduler具体实现</a></li><li><a href="/React/Concurrent-Mode/lane.html" class="sidebar-link">lane模型</a></li></ul></section></li><li><a href="/React/React17.html" class="sidebar-link">React17</a></li><li><a href="/React/React18.html" class="sidebar-link">React18</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Vue/Vue3+Typescript实现Form组件.html" class="sidebar-link">Vue3+Typescript实现Form组件</a></li><li><a href="/Vue/搭建vue3和ts组件库开发环境.html" class="sidebar-link">搭建vue3和ts组件库开发环境</a></li><li><a href="/Vue/Vite2配置项目开发环境.html" class="sidebar-link">Vite2配置项目开发环境</a></li><li><a href="/Vue/基于Element-plus实现虚拟下拉组件.html" class="sidebar-link">基于Element-plus实现虚拟下拉组件</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>前端生态</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/前端生态/eslint.html" class="active sidebar-link">eslint</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#抽象语法树-abstract-syntax-tree" class="sidebar-link">抽象语法树(Abstract Syntax Tree)</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#抽象语法树的作用" class="sidebar-link">抽象语法树的作用</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#javascript-parser" class="sidebar-link">Javascript Parser</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#代码转换" class="sidebar-link">代码转换</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#常见的-ast-节点类型" class="sidebar-link">常见的 ast 节点类型</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#babel-插件" class="sidebar-link">babel 插件</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#eslint" class="sidebar-link">Eslint</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#比如我们单独配置插件的规则" class="sidebar-link">比如我们单独配置插件的规则</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#eslint-流程" class="sidebar-link">eslint 流程</a></li><li class="sidebar-sub-header"><a href="/前端生态/eslint.html#插件编写" class="sidebar-link">插件编写</a></li></ul></li><li><a href="/前端生态/flutter实践.html" class="sidebar-link">flutter实践</a></li><li><a href="/前端生态/flutter消息推送.html" class="sidebar-link">flutter消息推送</a></li><li><a href="/前端生态/antd5架构分析.html" class="sidebar-link">antd5研究</a></li><li><a href="/前端生态/element-plus架构分析.html" class="sidebar-link">element-plus样式+打包分析</a></li><li><a href="/前端生态/ts类型打包.html" class="sidebar-link">ts类型打包</a></li><li><a href="/前端生态/vscode扩展工具.html" class="sidebar-link">vscode扩展工具实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>go</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/go/mac如何安装grpc.html" class="sidebar-link">mac安装grpc</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="抽象语法树-abstract-syntax-tree"><a href="#抽象语法树-abstract-syntax-tree" class="header-anchor">#</a> 抽象语法树(Abstract Syntax Tree)</h2> <ul><li>抽象语法树是源代码语法结构的一种抽象标识</li> <li>它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构</li></ul> <img src="/assets/img/ast.56c12282.jpg" alt="singleDiff" height="300"> <h2 id="抽象语法树的作用"><a href="#抽象语法树的作用" class="header-anchor">#</a> 抽象语法树的作用</h2> <ul><li>代码语法的检查，代码风格的检查，代码的格式化，代码错误提示等等</li> <li>优化变更代码，改变代码结构使达到想要的结构</li></ul> <h2 id="javascript-parser"><a href="#javascript-parser" class="header-anchor">#</a> Javascript Parser</h2> <ul><li><code>Javascript Parser</code> 是把 <code>javascript</code>源码转化为抽象语法树的解析器</li> <li><a href="https://astexplorer.net/" target="_blank" rel="noopener noreferrer">astexplorer<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="代码转换"><a href="#代码转换" class="header-anchor">#</a> 代码转换</h2> <ul><li>esprima 将代码转换为 ast 语法树</li> <li>estraverse 深度优先遍历，遍历 ast 抽象语法树</li> <li>escodegen 新的代码生成</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> esprima <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'esprima'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> estraverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'estraverse'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> escodegen <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'escodegen'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function a(){}</span><span class="token template-punctuation string">`</span></span>

<span class="token comment">// 1) 将我们的代码转换成ast语法树</span>
<span class="token keyword">const</span> ast <span class="token operator">=</span> esprima<span class="token punctuation">.</span><span class="token function">parseScript</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

<span class="token comment">// 访问模式 就是遍历节点的时候 会有两个过程 一个是进入一个是离开</span>
estraverse<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">//深度遍历，先进后出</span>
  <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Program -&gt;  FunctionDeclaration -&gt; Identifier</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'enter:'</span> <span class="token operator">+</span> node<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'FunctionDeclaration'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>id<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ast'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Identifier -&gt;  FunctionDeclaration -&gt; Program</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'leave:'</span> <span class="token operator">+</span> node<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//使用escodegen 生成代码</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>escodegen<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// function ast(){}</span>
</code></pre></div><img src="/assets/img/travser.c9c98d9f.png" alt="travser"> <h2 id="常见的-ast-节点类型"><a href="#常见的-ast-节点类型" class="header-anchor">#</a> 常见的 ast 节点类型</h2> <table><thead><tr><th style="text-align:left;">类型原名称</th> <th style="text-align:right;">中文名称</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;">Program</td> <td style="text-align:right;">程序主体</td> <td style="text-align:center;">整段代码的主体</td></tr> <tr><td style="text-align:left;">VariableDeclaration</td> <td style="text-align:right;">变量声明</td> <td style="text-align:center;">声明一个变量，例如 var let const</td></tr> <tr><td style="text-align:left;">FunctionDeclaration</td> <td style="text-align:right;">函数声明</td> <td style="text-align:center;">声明一个函数，例如 function</td></tr> <tr><td style="text-align:left;">ExpressionStatement</td> <td style="text-align:right;">表达式语句</td> <td style="text-align:center;">通常是调用一个函数，例如 console.log()</td></tr> <tr><td style="text-align:left;">BlockStatement</td> <td style="text-align:right;">块语句</td> <td style="text-align:center;">包裹在 {} 块内的代码，例如 if (condition){var a = 1;}</td></tr> <tr><td style="text-align:left;">ReturnStatement</td> <td style="text-align:right;">返回语句</td> <td style="text-align:center;">通常指 return</td></tr> <tr><td style="text-align:left;">Identifier</td> <td style="text-align:right;">标识符</td> <td style="text-align:center;">标识，例如声明变量时 var identi = 5 中的 identi</td></tr> <tr><td style="text-align:left;">CallExpression</td> <td style="text-align:right;">调用表达式</td> <td style="text-align:center;">通常指调用一个函数，例如 console.log()</td></tr> <tr><td style="text-align:left;">BinaryExpression</td> <td style="text-align:right;">二进制表达式</td> <td style="text-align:center;">通常指运算，例如 1+2</td></tr> <tr><td style="text-align:left;">FunctionExpression</td> <td style="text-align:right;">函数表达式</td> <td style="text-align:center;">例如 const func = function () {}</td></tr> <tr><td style="text-align:left;">ArrowFunctionExpression</td> <td style="text-align:right;">箭头函数表达式</td> <td style="text-align:center;">例如 const func = ()=&gt; {}</td></tr> <tr><td style="text-align:left;">ArrowAssignmentExpression</td> <td style="text-align:right;">赋值表达式</td> <td style="text-align:center;">通常指将函数的返回值赋值给变量 FunctionExpression</td></tr></tbody></table> <h2 id="babel-插件"><a href="#babel-插件" class="header-anchor">#</a> babel 插件</h2> <h3 id="转换箭头函数"><a href="#转换箭头函数" class="header-anchor">#</a> 转换箭头函数</h3> <ul><li><a href="https://www.npmjs.com/package/@babel/core" target="_blank" rel="noopener noreferrer">@babel/core Babel<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的编译器，核⼼ API 都在这⾥⾯，⽐如常⻅的 transform、parse,并实现了插件功能</li> <li><a href="https://github.com/babel/babel/tree/master/packages/babel-types" target="_blank" rel="noopener noreferrer">@babel/types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ⽤于 AST 节点的 Lodash 式⼯具库, 它包含了构造、验证以及变换 AST 节点的⽅法，对编写处理 AST 逻辑⾮常有⽤</li> <li><a href="https://www.npmjs.com/package/babel-plugin-transform-es2015-arrow-functions" target="_blank" rel="noopener noreferrer">babel-plugin-transform-es2015-arrow-functions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 转换箭头函数插件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//转换箭头函数例子：</span>

<span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/types'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> arrowFunctions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babel-plugin-transform-es2015-arrow-functions'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const sum = (a,b)=&gt; a+b</span><span class="token template-punctuation string">`</span></span>
<span class="token comment">// 转化代码，通过arrowFunctions插件</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>arrowFunctions<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token comment">// const sum = function (a, b) {return a + b};</span>
</code></pre></div><img src="/assets/img/babel.ffa3c6de.png" alt="babel"> <h3 id="模拟-transformfunction-插件实现-ast-转换"><a href="#模拟-transformfunction-插件实现-ast-转换" class="header-anchor">#</a> 模拟 transformFunction 插件实现 ast 转换</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/types'</span><span class="token punctuation">)</span>
<span class="token comment">//定义节点类型的函数，会在babel中注册一个监听器， 在后面遍历ast语法树的时候，如果节点的类型匹配上了，那么就会去执行相应的处理函数</span>
<span class="token keyword">const</span> transformFunction <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">visitor</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">ArrowFunctionExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// path就是访问的路径   path -&gt; node</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span> node <span class="token punctuation">}</span> <span class="token operator">=</span> path
      node<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'FunctionExpression'</span>

      <span class="token function">hoistFunctionEvn</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
      <span class="token keyword">let</span> body <span class="token operator">=</span> node<span class="token punctuation">.</span>body <span class="token comment">// 老节点中的 a+b;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>types<span class="token punctuation">.</span><span class="token function">isBlockStatement</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>body <span class="token operator">=</span> types<span class="token punctuation">.</span><span class="token function">blockStatement</span><span class="token punctuation">(</span><span class="token punctuation">[</span>types<span class="token punctuation">.</span><span class="token function">returnStatement</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">getThisPath</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  path<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">ThisExpression</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> arr
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">hoistFunctionEvn</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 查找父作用域</span>
  <span class="token keyword">const</span> thisEnv <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">findParent</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">parent</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      <span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>parent<span class="token punctuation">.</span><span class="token function">isArrowFunctionExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span>
      parent<span class="token punctuation">.</span><span class="token function">isProgram</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token keyword">const</span> bingingThis <span class="token operator">=</span> <span class="token string">'_this'</span> <span class="token comment">// var _this = this;</span>
  <span class="token comment">//获取到当前的作用域路径</span>
  <span class="token keyword">const</span> thisPaths <span class="token operator">=</span> <span class="token function">getThisPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>

  <span class="token comment">// 1) 修改当前路径中的this  变为_this</span>
  thisPaths<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// this -&gt; _this</span>
    path<span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>bingingThis<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//在父级作用域中插入this表达式</span>
  thisEnv<span class="token punctuation">.</span>scope<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">id</span><span class="token operator">:</span> types<span class="token punctuation">.</span><span class="token function">identifier</span><span class="token punctuation">(</span>bingingThis<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">init</span><span class="token operator">:</span> types<span class="token punctuation">.</span><span class="token function">thisExpression</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// var _this = this 表达式</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> const sum = ()=&gt; console.log(this)</span><span class="token template-punctuation string">`</span></span> <span class="token comment">// js代码</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>code<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>transformFunction<span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code<span class="token punctuation">)</span>

<span class="token comment">/**
 * 结果：
 * var _this = this;
   const sum = function () {
     return console.log(_this);
   };
 */</span>
</code></pre></div><h2 id="eslint"><a href="#eslint" class="header-anchor">#</a> Eslint</h2> <ul><li>ESLint 是⼀个开源的⼯具 cli，ESLint 采⽤静态分析找到并修复 JavaScript 代码中的问题</li> <li>ESLint 使⽤<a href="https://github.com/eslint/espree" target="_blank" rel="noopener noreferrer">Espree<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>进⾏ JavaScript 解析。</li> <li>ESLint 使⽤ AST 来评估代码中的模式。</li> <li>ESLint 是完全可插拔的，每⼀条规则都是⼀个插件，你可以在运⾏时添加更多。</li></ul> <p>几种解析器的关系：</p> <ul><li>esprima - 经典的解析器 最早的 ast 语法解析库</li> <li>acorn - 造轮⼦媲美 Esprima,代码更少，更轻巧</li> <li>@babel/parser （最早叫做 babylon）基于 acorn 的 ， @babel/core 内部就是基于 @babel/parser</li> <li>espree 最初从 Esprima 中 fork 出来的，现在基于 acorn</li></ul> <h3 id="基本使用"><a href="#基本使用" class="header-anchor">#</a> 基本使用</h3> <div class="language-node extra-class"><pre class="language-text"><code>pnpm init
pnpm i eslint -D # 安装eslint
pnpm create @eslint/config # 初始化eslint的配置⽂件
</code></pre></div><p>配置文件</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 指定环境</span>
    <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可以使用浏览器环境的一些语法  例如 document</span>
    <span class="token literal-property property">es2021</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可以ECMAScript高级语法 例如 Promise</span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可以使用node环境的语法  例如 require</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token string">'eslint:recommended'</span><span class="token punctuation">,</span> <span class="token comment">//继承一些插件和规则 //路径 node_module=&gt;eslint=&gt;conf=&gt;eslint-recommended</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// ⽀持语⾔的选项, ⽀持最新js语法，同时⽀持jsx语法</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token string">'latest'</span><span class="token punctuation">,</span> <span class="token comment">// ⽀持的语法是</span>
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token comment">// ⽀持模块化 例如import</span>
    <span class="token literal-property property">ecmaFeatures</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// eslint规则  off warn error</span>
    <span class="token literal-property property">semi</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'always'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//需要分号结尾</span>
    <span class="token literal-property property">quotes</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token string">'double'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//双引号</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 配置全局变量，比如这个变量是通过script脚本引入进来的</span>
    <span class="token literal-property property">custom</span><span class="token operator">:</span> <span class="token string">'readonly'</span><span class="token punctuation">,</span> <span class="token comment">// readonly 、 writable</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>插件和 extends 的区别</p> <p>如果使用 plugins，那么我们配置了之后，还需要单独在 rules 中配置该插件的规则，而 extends 可以把插件和规则都包含进来</p> <p>可以使用 extends 将插件和规则都引入进来</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token string-property property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
     <span class="token string">&quot;eslint:recommended&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span> <span class="token comment">// 规则引用路径  node_modules\@typescript-eslint\eslint-plugin\dist\index.js</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 集成后 就可以使用别人写好的的规则</span>
</code></pre></div><h2 id="比如我们单独配置插件的规则"><a href="#比如我们单独配置插件的规则" class="header-anchor">#</a> 比如我们单独配置插件的规则</h2> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token string-property property">&quot;rules&quot;</span><span class="token operator">:</span><span class="token punctuation">{</span>
    <span class="token string-property property">&quot;@typescript-eslint/no-inferrable-types&quot;</span><span class="token operator">:</span><span class="token string">&quot;error&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@typescript-eslint'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="eslint-流程"><a href="#eslint-流程" class="header-anchor">#</a> eslint 流程</h2> <p>三部曲：遍历=》使用规则=》修复</p> <p>调试 <code>eslint</code>源码
首先创建一个 <code>JavaScript Debug Terminal</code>模式的 vscode 终端</p> <img src="data:image/png;base64,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" alt="eslint-debug"> <p>然后我们可以使用 <code>npx eslint xx.js</code> 来执行 <code>eslint</code>命令</p> <p>通过<code>node_modules</code> 的<code>bin</code>文件夹下面的命令，我们可以发现 <code>eslint</code>命令其实就是执行的是 <code>node_modules\eslint\bin\eslint.js</code> 这个文件，然后通过打断点就可以进行调试</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//引用cli工具，然后执行</span>
process<span class="token punctuation">.</span>exitCode <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/cli'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>
  process<span class="token punctuation">.</span>argv<span class="token punctuation">,</span> <span class="token comment">//参数</span>
  <span class="token comment">//这个选项告诉 ESLint 从 STDIN 而不是从文件中读取和检测源码。你可以使用该选项向 ESLint 来输入代码。</span>
  process<span class="token punctuation">.</span>argv<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">'--stdin'</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">await</span> <span class="token function">readStdin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token boolean">true</span>
<span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code>    <span class="token keyword">async</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> text<span class="token punctuation">,</span> allowFlatConfig</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">const</span> CLIOptions <span class="token operator">=</span> <span class="token function">createCLIOptions</span><span class="token punctuation">(</span>usingFlatConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/** @type {ParsedCLIOptions} */</span>
        <span class="token keyword">let</span> options<span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            options <span class="token operator">=</span> CLIOptions<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Error parsing CLI options:&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//实例化eslint</span>
         <span class="token keyword">const</span> engine <span class="token operator">=</span>  <span class="token keyword">new</span> <span class="token class-name">ESLint</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">translateOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

         <span class="token keyword">let</span> results<span class="token punctuation">;</span>
         <span class="token comment">//如果是直接校验文本</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>useStdin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            results <span class="token operator">=</span> <span class="token keyword">await</span> engine<span class="token punctuation">.</span><span class="token function">lintText</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">filePath</span><span class="token operator">:</span> options<span class="token punctuation">.</span>stdinFilename<span class="token punctuation">,</span>
                <span class="token literal-property property">warnIgnored</span><span class="token operator">:</span> <span class="token boolean">true</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token comment">//检验文件</span>
            results <span class="token operator">=</span> <span class="token keyword">await</span> engine<span class="token punctuation">.</span><span class="token function">lintFiles</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p><code>options</code></p> <img src="/assets/img/options.2414d2a5.png" alt="options"> <p><code>new Eslint</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/**
 * Main API.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">ESLint</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * Creates a new instance of the main ESLint API.
   * @param {ESLintOptions} options The options for this instance.
   */</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> processedOptions <span class="token operator">=</span> <span class="token function">processOptions</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token comment">// 内部会创建一个  CLIEngine 实例</span>
    <span class="token keyword">const</span> cliEngine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CLIEngine</span><span class="token punctuation">(</span>processedOptions<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">preloadedPlugins</span><span class="token operator">:</span> options<span class="token punctuation">.</span>plugins<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// Initialize private properties. 初始化私有属性</span>
    privateMembersMap<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      cliEngine<span class="token punctuation">,</span>
      <span class="token literal-property property">options</span><span class="token operator">:</span> processedOptions<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>Eslint</code>类核心 api</p> <ul><li>lintFiles 检验⽂件</li> <li>lintText 校验⽂本</li> <li>loadFormatter 加载 formatter</li> <li>calculateConfigForFile 通过⽂件获取配置</li> <li>isPathIgnored 此路径是否是被忽略的</li> <li>static outputFixes 输出修复的⽂件</li> <li>static getErrorResults 获得错误结果</li></ul> <p><code>CLIEngine</code>类核心 Api</p> <ul><li>getRules 获取规则</li> <li>resolveFileGlobPatterns 解析⽂件成 glob 模式</li> <li>executeOnFiles 根据⽂件执⾏逻辑</li> <li>executeOnText 根据⽂本执⾏逻辑</li> <li>getConfigForFile 获取⽂件的配置</li> <li>isPathIgnored 此路径是否是被忽略的</li> <li>getFormatter 获取输出的格式</li> <li>static getErrorResults 获取错误结果</li> <li>static outputFixes 输出修复的结果</li></ul> <p>执行 eslint.lintFiles</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//检验文件</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> engine<span class="token punctuation">.</span><span class="token function">lintFiles</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token comment">//参数是要校验的文件的相对路径</span>
   <span class="token keyword">async</span> <span class="token function">lintFiles</span><span class="token punctuation">(</span><span class="token parameter">patterns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isNonEmptyString</span><span class="token punctuation">(</span>patterns<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isArrayOfNonEmptyString</span><span class="token punctuation">(</span>patterns<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;'patterns' must be a non-empty string or an array of non-empty strings&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> cliEngine <span class="token punctuation">}</span> <span class="token operator">=</span> privateMembersMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">processCLIEngineLintReport</span><span class="token punctuation">(</span>
            cliEngine<span class="token punctuation">,</span>
            cliEngine<span class="token punctuation">.</span><span class="token function">executeOnFiles</span><span class="token punctuation">(</span>patterns<span class="token punctuation">)</span> <span class="token comment">//执行 cliEngine.executeOnFiles （在文件上执行校验）</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>executeOnFiles 方法</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//executeOnFiles</span>

  <span class="token comment">/**
     * Executes the current configuration on an array of file and directory names.
     * @param {string[]} patterns An array of file and directory names.
     * @throws {Error} As may be thrown by `fs.unlinkSync`.
     * @returns {LintReport} The results for all files that were linted.
     */</span>
    <span class="token function">executeOnFiles</span><span class="token punctuation">(</span><span class="token parameter">patterns</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span>
            cacheFilePath<span class="token punctuation">,</span>
            fileEnumerator<span class="token punctuation">,</span>
            lastConfigArrays<span class="token punctuation">,</span>
            lintResultCache<span class="token punctuation">,</span>
            linter<span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                allowInlineConfig<span class="token punctuation">,</span>
                cache<span class="token punctuation">,</span>
                cwd<span class="token punctuation">,</span>
                fix<span class="token punctuation">,</span>
                reportUnusedDisableDirectives
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token operator">=</span> internalSlotsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// Clear the last used config arrays.</span>
        lastConfigArrays<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token comment">// Iterate source code files.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token punctuation">{</span> config<span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> ignored <span class="token punctuation">}</span> <span class="token keyword">of</span> fileEnumerator<span class="token punctuation">.</span><span class="token function">iterateFiles</span><span class="token punctuation">(</span>patterns<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>ignored<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createIgnoreResult</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> cwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">/*
             * Store used configs for:
             * - this method uses to collect used deprecated rules.
             * - `getRules()` method uses to collect all loaded rules.
             * - `--fix-type` option uses to get the loaded rule's meta data.
             */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lastConfigArrays<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                lastConfigArrays<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>


            <span class="token comment">// Do lint.</span>
            <span class="token comment">//会循环对所有的文件执行  verifyText 校验，会使用 fs.readFileSync 把文件的内容读写出来</span>
            <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token function">verifyText</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">text</span><span class="token operator">:</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">&quot;utf8&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                filePath<span class="token punctuation">,</span>
                config<span class="token punctuation">,</span>
                cwd<span class="token punctuation">,</span>
                fix<span class="token punctuation">,</span>
                allowInlineConfig<span class="token punctuation">,</span>
                reportUnusedDisableDirectives<span class="token punctuation">,</span>
                fileEnumerator<span class="token punctuation">,</span>
                linter
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            results<span class="token punctuation">,</span>
            <span class="token operator">...</span><span class="token function">calculateStatsPerRun</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>config 配置项:
<img src="/assets/img/config.95daa7c4.png" alt="config"></p> <p>linter.verifyAndFix</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//主要是的参数就是 文件的内容，和 所有的配置项</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> fixed<span class="token punctuation">,</span> messages<span class="token punctuation">,</span> output <span class="token punctuation">}</span> <span class="token operator">=</span> linter<span class="token punctuation">.</span><span class="token function">verifyAndFix</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> config<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  allowInlineConfig<span class="token punctuation">,</span>
  <span class="token literal-property property">filename</span><span class="token operator">:</span> filePathToVerify<span class="token punctuation">,</span>

  <span class="token comment">/**
   * Check if the linter should adopt a given code block or not.
   * @param {string} blockFilename The virtual filename of a code block.
   * @returns {boolean} `true` if the linter should adopt the code block.
   */</span>
  <span class="token function">filterCodeBlock</span><span class="token punctuation">(</span><span class="token parameter">blockFilename</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fileEnumerator<span class="token punctuation">.</span><span class="token function">isTargetPath</span><span class="token punctuation">(</span>blockFilename<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>verifyAndFix</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">verifyAndFix</span><span class="token punctuation">(</span><span class="token parameter">text<span class="token punctuation">,</span> config<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> messages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            fixedResult<span class="token punctuation">,</span>
            fixed <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            passNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
            currentText <span class="token operator">=</span> text<span class="token punctuation">;</span>
        <span class="token keyword">const</span> debugTextDescription <span class="token operator">=</span> options <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>filename <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>text<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> shouldFix <span class="token operator">=</span> options <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> options<span class="token punctuation">.</span>fix <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span> <span class="token operator">?</span> options<span class="token punctuation">.</span>fix <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token comment">/**
         * This loop continues until one of the following is true:
         *
         * 1. No more fixes have been applied.
         * 2. Ten passes have been made.
         *
         * That means anytime a fix is successfully applied, there will be another pass.
         * Essentially, guaranteeing a minimum of two passes.
         */</span>
        <span class="token comment">//如果你输入了 --fix 参数，说明你需要支持修复，那么shouldFix就是一个true，每次eslint校验的时候，发现错误就会去给你自动修复，最多修复10次</span>
        <span class="token keyword">do</span> <span class="token punctuation">{</span>
            passNumber<span class="token operator">++</span><span class="token punctuation">;</span>

            <span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Linting code for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>debugTextDescription<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (pass </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>passNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//校验文件 ,message就是校验错误的信息，是一个数组，包括了每一个校验失败的规则id和对应规则的错误提示信息</span>
            <span class="token comment">//如果你的文件中语法有错误，那么在后面解析成ast语法树的时候就会报错，这个时候 message = [{fatal:true,error:'...'}]</span>
            messages <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>currentText<span class="token punctuation">,</span> config<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">debug</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Generating fixed text for </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>debugTextDescription<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (pass </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>passNumber<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//如果shouldFix 是true的话就会去走修复逻辑</span>
            fixedResult <span class="token operator">=</span> SourceCodeFixer<span class="token punctuation">.</span><span class="token function">applyFixes</span><span class="token punctuation">(</span>currentText<span class="token punctuation">,</span> messages<span class="token punctuation">,</span> shouldFix<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">/*
             * stop if there are any syntax errors.
             * 'fixedResult.output' is a empty string.
             */</span>
            <span class="token comment">//如果有语法错误，直接跳出</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>messages<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> messages<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fatal<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// keep track if any fixes were ever applied - important for return value</span>
            fixed <span class="token operator">=</span> fixed <span class="token operator">||</span> fixedResult<span class="token punctuation">.</span>fixed<span class="token punctuation">;</span>

            <span class="token comment">// update to use the fixed output instead of the original text</span>
            currentText <span class="token operator">=</span> fixedResult<span class="token punctuation">.</span>output<span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>
            fixedResult<span class="token punctuation">.</span>fixed <span class="token operator">&amp;&amp;</span>
            passNumber <span class="token operator">&lt;</span> <span class="token constant">MAX_AUTOFIX_PASSES</span> <span class="token comment">//  MAX_AUTOFIX_PASSES = 10</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">/*
         * If the last result had fixes, we need to lint again to be sure we have
         * the most up-to-date information.
         */</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fixedResult<span class="token punctuation">.</span>fixed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            fixedResult<span class="token punctuation">.</span>messages <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>currentText<span class="token punctuation">,</span> config<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// ensure the last result properly reflects if fixes were done</span>
        fixedResult<span class="token punctuation">.</span>fixed <span class="token operator">=</span> fixed<span class="token punctuation">;</span>
        fixedResult<span class="token punctuation">.</span>output <span class="token operator">=</span> currentText<span class="token punctuation">;</span>

        <span class="token keyword">return</span> fixedResult<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>verify 方法</p> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token function">verify</span><span class="token punctuation">(</span><span class="token parameter">textOrSourceCode<span class="token punctuation">,</span> config<span class="token punctuation">,</span> filenameOrOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Verify&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> <span class="token punctuation">{</span> configType <span class="token punctuation">}</span> <span class="token operator">=</span> internalSlotsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token keyword">typeof</span> filenameOrOptions <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span>
            <span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token literal-property property">filename</span><span class="token operator">:</span> filenameOrOptions <span class="token punctuation">}</span>
            <span class="token operator">:</span> filenameOrOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> config<span class="token punctuation">.</span>extractConfig <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_distinguishSuppressedMessages</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_verifyWithConfigArray</span><span class="token punctuation">(</span>textOrSourceCode<span class="token punctuation">,</span> config<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
</code></pre></div><p>_verifyWithConfigArray 方法</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">/**
     * Verify a given code with `ConfigArray`.
     * @param {string|SourceCode} textOrSourceCode The source code.
     * @param {ConfigArray} configArray The config array.
     * @param {VerifyOptions&amp;ProcessorOptions} options The options.
     * @returns {(LintMessage|SuppressedLintMessage)[]} The found problems.
     */</span>
    <span class="token function">_verifyWithConfigArray</span><span class="token punctuation">(</span><span class="token parameter">textOrSourceCode<span class="token punctuation">,</span> configArray<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;With ConfigArray: %s&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 存储config 列表，为了后面去拿到plugin和env还有规则</span>
        internalSlotsMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lastConfigArray <span class="token operator">=</span> configArray<span class="token punctuation">;</span>

        <span class="token comment">// 为当前校验文件提取最后的配置文件</span>
        <span class="token keyword">const</span> config <span class="token operator">=</span> configArray<span class="token punctuation">.</span><span class="token function">extractConfig</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">const</span> processor <span class="token operator">=</span>
            config<span class="token punctuation">.</span>processor <span class="token operator">&amp;&amp;</span>
            configArray<span class="token punctuation">.</span>pluginProcessors<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>processor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Verify.如果有processor，会走这个逻辑，processor就是指的除了.js文件以外的文件的校验</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>processor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Apply the processor: %o&quot;</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>processor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">const</span> <span class="token punctuation">{</span> preprocess<span class="token punctuation">,</span> postprocess<span class="token punctuation">,</span> supportsAutofix <span class="token punctuation">}</span> <span class="token operator">=</span> processor<span class="token punctuation">;</span>
            <span class="token keyword">const</span> disableFixes <span class="token operator">=</span> options<span class="token punctuation">.</span>disableFixes <span class="token operator">||</span> <span class="token operator">!</span>supportsAutofix<span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_verifyWithProcessor</span><span class="token punctuation">(</span>
                textOrSourceCode<span class="token punctuation">,</span>
                config<span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token operator">...</span>options<span class="token punctuation">,</span> disableFixes<span class="token punctuation">,</span> postprocess<span class="token punctuation">,</span> preprocess <span class="token punctuation">}</span><span class="token punctuation">,</span>
                configArray
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_verifyWithoutProcessors</span><span class="token punctuation">(</span>textOrSourceCode<span class="token punctuation">,</span> config<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>_verifyWithoutProcessors</p> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">_verifyWithoutProcessors</span><span class="token punctuation">(</span><span class="token parameter">textOrSourceCode<span class="token punctuation">,</span> providedConfig<span class="token punctuation">,</span> providedOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> parser <span class="token operator">=</span> espree<span class="token punctuation">;</span><span class="token comment">//espree作为默认的parser</span>
             <span class="token comment">// search and apply &quot;eslint-env *&quot;.</span>
        <span class="token keyword">const</span> envInFile <span class="token operator">=</span> options<span class="token punctuation">.</span>allowInlineConfig <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>options<span class="token punctuation">.</span>warnInlineConfig
            <span class="token operator">?</span> <span class="token function">findEslintEnv</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
            <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token comment">//合并所有config中的env</span>
        <span class="token keyword">const</span> resolvedEnvConfig <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">builtin</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>env<span class="token punctuation">,</span> envInFile<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//解析所有的 parserOptions，合并在一起</span>
        <span class="token keyword">const</span> parserOptions <span class="token operator">=</span> <span class="token function">resolveParserOptions</span><span class="token punctuation">(</span>parser<span class="token punctuation">,</span> config<span class="token punctuation">.</span>parserOptions <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> enabledEnvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//解析 globals,除了自己定义一些globals选项，eslint内部也会把一些js常用的全局对象加进来，例如  addEventListener  Blob  alert 等等</span>
        <span class="token comment">//布尔值 false 和字符串值 &quot;readable&quot; 等价于 &quot;readonly&quot;。类似地，布尔值 true 和字符串值 &quot;writeable&quot; 等价于 &quot;writable&quot;</span>
        <span class="token keyword">const</span> configuredGlobals <span class="token operator">=</span> <span class="token function">resolveGlobals</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>globals <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> enabledEnvs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//将global，parserOption，sourceType等配置组合起来</span>
        <span class="token keyword">const</span> languageOptions <span class="token operator">=</span> <span class="token function">createLanguageOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">globals</span><span class="token operator">:</span> config<span class="token punctuation">.</span>globals<span class="token punctuation">,</span>
            parser<span class="token punctuation">,</span>
            parserOptions
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//解析为ast语法树  parseResult = {success:true,sourceCode:{ast:....}} 其中就包含了ast节点，如果你的语法有错误，此处会解析错误</span>
        <span class="token keyword">const</span> parseResult <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span>languageOptions<span class="token punctuation">,</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parseResult<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>parseResult<span class="token punctuation">.</span>error<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//运行规则</span>

         slots<span class="token punctuation">.</span>lastSourceCode <span class="token operator">=</span> parseResult<span class="token punctuation">.</span>sourceCode<span class="token punctuation">;</span>
         <span class="token keyword">const</span> sourceCode <span class="token operator">=</span> slots<span class="token punctuation">.</span>lastSourceCode<span class="token punctuation">;</span>
         <span class="token comment">//获取到所有的规则</span>
         <span class="token keyword">const</span> configuredRules <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> config<span class="token punctuation">.</span>rules<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//解析规则 runRules</span>
          <span class="token keyword">let</span>  lintingProblems <span class="token operator">=</span> <span class="token function">runRules</span><span class="token punctuation">(</span>
                sourceCode<span class="token punctuation">,</span>
                configuredRules<span class="token punctuation">,</span>
                <span class="token parameter">ruleId</span> <span class="token operator">=&gt;</span> <span class="token function">getRule</span><span class="token punctuation">(</span>slots<span class="token punctuation">,</span> ruleId<span class="token punctuation">)</span><span class="token punctuation">,</span>
                parserName<span class="token punctuation">,</span>
                languageOptions<span class="token punctuation">,</span>
                settings<span class="token punctuation">,</span>
                options<span class="token punctuation">.</span>filename<span class="token punctuation">,</span>
                options<span class="token punctuation">.</span>disableFixes<span class="token punctuation">,</span>
                slots<span class="token punctuation">.</span>cwd<span class="token punctuation">,</span>
                providedOptions<span class="token punctuation">.</span>physicalFilename
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>runRules</p> <p>拍平的 node queue
<img src="/assets/img/node-flat.ac356e34.png" alt="node-flat"></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">runRules</span><span class="token punctuation">(</span><span class="token parameter">configuredRules</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> emitter <span class="token operator">=</span> <span class="token function">createEmitter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//创建一个触发器</span>
  <span class="token keyword">let</span> currentNode <span class="token operator">=</span> sourceCode<span class="token punctuation">.</span>ast
  <span class="token comment">//遍历ast语法树</span>
  Traverser<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span>sourceCode<span class="token punctuation">.</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>parent <span class="token operator">=</span> parent
      <span class="token comment">//拍平树中的节点</span>
      nodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isEntering</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> node <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">leave</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      nodeQueue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">isEntering</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> node <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">visitorKeys</span><span class="token operator">:</span> sourceCode<span class="token punctuation">.</span>visitorKeys<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> lintingProblems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token comment">//遍历所有的规则</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>configuredRules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">ruleId</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//ruleId 每一个规则的名字</span>
    <span class="token keyword">const</span> severity <span class="token operator">=</span> ConfigOps<span class="token punctuation">.</span><span class="token function">getRuleSeverity</span><span class="token punctuation">(</span>configuredRules<span class="token punctuation">[</span>ruleId<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// 标识这个规则是禁用的</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>severity <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//拿到每一个规则</span>
    <span class="token keyword">const</span> rule <span class="token operator">=</span> <span class="token function">ruleMapper</span><span class="token punctuation">(</span>ruleId<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>rule<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      lintingProblems<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">createLintingProblem</span><span class="token punctuation">(</span><span class="token punctuation">{</span> ruleId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">const</span> ruleContext <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">freeze</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//此处省略一些代码，目的就是创建一个规则上下文，该上下文中会收集report出来的错误，然后放到 lintingProblems 这个数组中</span>

    <span class="token comment">//创建一个规则的监听器，一个规则里面可能会有多个不同节点类型的监听器</span>
    <span class="token comment">//可以查看 这个地方的定义 https://eslint.bootcss.com/docs/developer-guide/working-with-rules</span>
    <span class="token keyword">const</span> ruleListeners <span class="token operator">=</span> <span class="token function">createRuleListeners</span><span class="token punctuation">(</span>rule<span class="token punctuation">,</span> ruleContext<span class="token punctuation">)</span> <span class="token comment">//createRuleListeners下面有定义</span>

    <span class="token comment">// add all the selectors from the rule as listeners</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>ruleListeners<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> ruleListener <span class="token operator">=</span> timing<span class="token punctuation">.</span>enabled
        <span class="token operator">?</span> timing<span class="token punctuation">.</span><span class="token function">time</span><span class="token punctuation">(</span>ruleId<span class="token punctuation">,</span> ruleListeners<span class="token punctuation">[</span>selector<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token operator">:</span> ruleListeners<span class="token punctuation">[</span>selector<span class="token punctuation">]</span>

      emitter<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> <span class="token function">addRuleErrorHandler</span><span class="token punctuation">(</span>ruleListener<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//创建一个事件生成器</span>
  <span class="token keyword">const</span> eventGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeEventGenerator</span><span class="token punctuation">(</span>emitter<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">visitorKeys</span><span class="token operator">:</span> sourceCode<span class="token punctuation">.</span>visitorKeys<span class="token punctuation">,</span>
    <span class="token literal-property property">fallback</span><span class="token operator">:</span> Traverser<span class="token punctuation">.</span>getKeys<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//遍历平铺的ast 节点，根据每一个节点的类型去触发对应的监听函数,如果规则校验失败，eslint会收集每一个规则里面report出来的问题</span>
  nodeQueue<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">traversalInfo</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    currentNode <span class="token operator">=</span> traversalInfo<span class="token punctuation">.</span>node

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>traversalInfo<span class="token punctuation">.</span>isEntering<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        eventGenerator<span class="token punctuation">.</span><span class="token function">enterNode</span><span class="token punctuation">(</span>currentNode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        eventGenerator<span class="token punctuation">.</span><span class="token function">leaveNode</span><span class="token punctuation">(</span>currentNode<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      err<span class="token punctuation">.</span>currentNode <span class="token operator">=</span> currentNode
      <span class="token keyword">throw</span> err
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">//返回所以收集到的问题</span>
  <span class="token keyword">return</span> lintingProblems
<span class="token punctuation">}</span>
</code></pre></div><p>创建规则监听器 <code>createRuleListeners</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createRuleListeners</span><span class="token punctuation">(</span><span class="token parameter">rule<span class="token punctuation">,</span> ruleContext</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//调用每一个规则的create方法，并且传入规则上下午</span>
    <span class="token keyword">return</span> rule<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>ruleContext<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ex<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error while loading rule '</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ruleContext<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">': </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ex<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token keyword">throw</span> ex
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>规则监听数组 ruleListeners：
<img src="/assets/img/rule-listener.61eaed2a.png" alt="rule-listener"></p> <p>//规则订阅</p> <p>规则订阅的主要作用是后续 ast 中的 node 节点和规则匹配上了之后，就会去触发对应的规则校验，本质是一个发布订阅</p> <h2 id="插件编写"><a href="#插件编写" class="header-anchor">#</a> 插件编写</h2> <p>Eslint 官⽅提供了可以使⽤ Yeoman 脚⼿架⽣成插件模板</p> <p>安装</p> <div class="language-js extra-class"><pre class="language-js"><code>npm install yo generator<span class="token operator">-</span>eslint <span class="token operator">-</span>g

</code></pre></div><p>模板初始化</p> <div class="language-js extra-class"><pre class="language-js"><code>mkdir eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>lint
cd eslint<span class="token operator">-</span>plugin<span class="token operator">-</span>lint
yo eslint<span class="token operator">:</span>plugin <span class="token comment">// 插件模板初始化</span>
</code></pre></div><img src="/assets/img/generator.75cd17d3.png" alt="generator"> <p>规则模版初始化</p> <div class="language-js extra-class"><pre class="language-js"><code>yo eslint<span class="token operator">:</span>rule <span class="token comment">// 规则模版初始化</span>

</code></pre></div><img src="/assets/img/rule-config.111ab60e.png" alt="rule-config"> <p><a href="https://eslint.bootcss.com/docs/developer-guide/working-with-rules" target="_blank" rel="noopener noreferrer">eslint 中文文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>基本语法可以参考文档</p></div> <footer class="page-edit"><!----> <!----></footer> <div><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Vue/基于Element-plus实现虚拟下拉组件.html" class="prev">
        基于Element-plus实现虚拟下拉组件
      </a></span> <span class="next"><a href="/前端生态/flutter实践.html">
        flutter实践
      </a>
      →
    </span></p></div> <div class="icp-footer"><p>Copyright© 2022-2023 _妄想何方</p> <a href="https://beian.miit.gov.cn/" target="_blank">蜀ICP备2022010321号-1</a></div></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a5e2a326.js" defer></script><script src="/assets/js/2.a6634917.js" defer></script><script src="/assets/js/3.c79fccf9.js" defer></script><script src="/assets/js/11.8af1e3cd.js" defer></script>
  </body>
</html>
