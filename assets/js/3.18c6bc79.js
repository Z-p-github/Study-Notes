(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{470:function(t,s,a){t.exports=a.p+"assets/img/priority.574943cb.png"},471:function(t,s,a){t.exports=a.p+"assets/img/use.cc5a05ef.png"},472:function(t,s,a){t.exports=a.p+"assets/img/change.1298ba88.png"},473:function(t,s,a){t.exports=a.p+"assets/img/transform.14e9c6e7.png"},474:function(t,s,a){t.exports=a.p+"assets/img/start.f7d011c2.png"},475:function(t,s,a){t.exports=a.p+"assets/img/create.0305d08b.png"},476:function(t,s,a){t.exports=a.p+"assets/img/vite.17539c6b.png"},477:function(t,s,a){t.exports=a.p+"assets/img/build1.9fc6017f.png"},478:function(t,s,a){t.exports=a.p+"assets/img/build2.db0602af.png"},479:function(t,s,a){t.exports=a.p+"assets/img/build3.ad18e77c.png"},480:function(t,s,a){t.exports=a.p+"assets/img/webcom1.f5563921.png"},481:function(t,s,a){t.exports=a.p+"assets/img/webcom2.edd5b5d0.png"},482:function(t,s,a){t.exports=a.p+"assets/img/use-com1.6864d50e.png"},483:function(t,s,a){t.exports=a.p+"assets/img/use-com2.054a14d6.png"},484:function(t,s,a){t.exports=a.p+"assets/img/props1.624bb697.png"},485:function(t,s,a){t.exports=a.p+"assets/img/props2.63391267.png"},486:function(t,s,a){t.exports=a.p+"assets/img/event1.b478b80b.png"},487:function(t,s,a){t.exports=a.p+"assets/img/event2.eec9785e.png"},488:function(t,s,a){t.exports=a.p+"assets/img/when.aaac70ea.png"},549:function(t,s,a){"use strict";a.r(s);var n=a(65),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"svelte"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#svelte"}},[t._v("#")]),t._v(" svelte")]),t._v(" "),n("p",[t._v("最近由于公司内部需求，需要将一个组件提成公共组件，可以跨项目和跨技术栈使用，我们公司同时存在"),n("code",[t._v("vue")]),t._v("和"),n("code",[t._v("react")]),t._v("技术栈，考虑到以下几个问题：")]),t._v(" "),n("ul",[n("li",[t._v("1、"),n("code",[t._v("不同技术栈的存在")]),t._v("，由于前端项目中同时存在 React 和 Vue 框架，以及前端框架的不同版本，需要确保 Copilot 能够跨这些不同的技术栈进行使用")]),t._v(" "),n("li",[t._v("2、"),n("code",[t._v("维护性和可扩展性")]),t._v("，为了降低维护成本并提高项目的可扩展性，期望将 Copilot 作为一个公共组件库来统一管理和维护")]),t._v(" "),n("li",[t._v("3、"),n("code",[t._v("多平台应用")]),t._v("，提取的公共组件需要跨平台使用，需要考虑平台接入的兼容性和难易程度")]),t._v(" "),n("li",[t._v("4、"),n("code",[t._v("学习成本")]),t._v("，需要团队成员能够快速上手开发或接入，减少团队成员的学习成本")])]),t._v(" "),n("p",[t._v("我们决定使用 "),n("code",[t._v("svelte")]),t._v("框架来实现")]),t._v(" "),n("h3",{attrs:{id:"如何封装一个能够支持跨前端框架-的组件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何封装一个能够支持跨前端框架-的组件"}},[t._v("#")]),t._v(" 如何封装一个能够支持跨前端框架 的组件")]),t._v(" "),n("p",[t._v("目前市场上有其他几种方案可以支持")]),t._v(" "),n("p",[n("code",[t._v("Vanilla JS")])]),t._v(" "),n("p",[t._v("优点：")]),t._v(" "),n("ul",[n("li",[t._v("1、所有框架中都支持")])]),t._v(" "),n("p",[t._v("缺点：")]),t._v(" "),n("ul",[n("li",[t._v("1、命令式编程方式")]),t._v(" "),n("li",[t._v("2、DOM 操作繁琐")]),t._v(" "),n("li",[t._v("3、开发效率低")]),t._v(" "),n("li",[t._v("4、代码冗余")])]),t._v(" "),n("p",[n("code",[t._v("Web Components")])]),t._v(" "),n("p",[t._v("优点：")]),t._v(" "),n("ul",[n("li",[t._v("1、原生浏览器支持，具备天然的跨框架特性")])]),t._v(" "),n("p",[t._v("缺点：")]),t._v(" "),n("ul",[n("li",[t._v("1、兼容性问题，浏览器支持不完全")]),t._v(" "),n("li",[t._v("2、引入的新概念比较多，学习成本较大")]),t._v(" "),n("li",[t._v("3、仍存在很多试验性 API，仍存在变动的可能")])]),t._v(" "),n("h3",{attrs:{id:"svelte-优点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#svelte-优点"}},[t._v("#")]),t._v(" svelte 优点")]),t._v(" "),n("p",[t._v("选择的"),n("code",[t._v("svelte")]),t._v("的原因如下：")]),t._v(" "),n("p",[t._v("优点：")]),t._v(" "),n("ul",[n("li",[n("p",[t._v("1、语法简单，语法和 vue 3 很像")])]),t._v(" "),n("li",[n("p",[t._v("2、高性能前端框架")])]),t._v(" "),n("li",[n("p",[t._v("3、打包的产物很小，它可以把组件打包成 "),n("code",[t._v("JS Class")]),t._v(" 的形式，打包产物是无框架的，"),n("code",[t._v("Svelte")]),t._v(" 的核心思想在于『通过静态编译减少框架运行时的代码量』。举例来说，当前的框架无论是 React Angular 还是 Vue，不管你怎么编译，使用的时候必然需要『引入』框架本身，也就是所谓的"),n("code",[t._v("运行时 (runtime)")]),t._v("。但是用 "),n("code",[t._v("Svelte")]),t._v(" 就不一样，一个 "),n("code",[t._v("Svelte")]),t._v(" 组件编译了以后，所有需要的运行时代码都包含在里面了，除了引入这个组件本身，你不需要再额外引入一个所谓的框架运行时！")])]),t._v(" "),n("li",[n("p",[t._v("4、无虚拟 DOM、无运行时")])]),t._v(" "),n("li",[n("p",[t._v("5、基于 "),n("code",[t._v("Svelte")]),t._v(" 开发的组件，可以直接给使用 "),n("code",[t._v("Vue、React、Angular、Svelte")]),t._v(" 技术栈的团队用， 而不需要额外引入 "),n("code",[t._v("Svelte")]),t._v(" 去承载解析翻译的工作。")])]),t._v(" "),n("li",[n("p",[t._v("6、上手简单，"),n("code",[t._v("Svelte")]),t._v(" 把框架代码编写风格设计跟 "),n("code",[t._v("Vue")]),t._v(" 很像。编写一个 "),n("code",[t._v("Svelte")]),t._v(" 组件的体验，跟开发"),n("code",[t._v("原生 Web")]),t._v(" 基本相同")])])]),t._v(" "),n("img",{attrs:{src:a(470),alt:"center",height:"150"}}),t._v(" "),n("p",[n("code",[t._v("Svelte")]),t._v("放弃了流行的"),n("code",[t._v("虚拟DOM")]),t._v("方案，虽然"),n("code",[t._v("虚拟DOM")]),t._v("足够的快，但是"),n("code",[t._v("虚拟DOM")]),t._v("最致命的问题是不管状态是否发生变化，都会被重新计算并且更新，"),n("code",[t._v("Svelte")]),t._v(" 将需要在运行时做的事情，提前到编译阶段完成，所以它几乎没有运行时。提前分析依赖，运行阶段无需处理依赖收集、"),n("code",[t._v("虚拟 DOM")]),t._v("比较等额外计算，减少了运行时的负担。"),n("code",[t._v("Svelte")]),t._v(" 的编译风格是将模板编译为"),n("code",[t._v("命令式 (imperative)")]),t._v("的"),n("code",[t._v("原生 DOM")]),t._v(" 操作。比如这段代码：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world123'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("p",[t._v("会被编译为:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world123'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_fragment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("c")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t\th1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("element")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\th1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("Hello ")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("m")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("p")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" noop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" noop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("o")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" noop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("detaching")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detaching"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("detach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("p",[t._v("可以看到，跟基于 Virtual DOM 的框架相比，这样的输出不需要 Virtual DOM 的 diff/patch 操作，自然可以省去大量代码。")]),t._v(" "),n("p",[t._v("对于特定功能，"),n("code",[t._v("Svelte")]),t._v(" 依然有对应的运行时代码，比如组件逻辑，"),n("code",[t._v("if/else")]),t._v(" 切换逻辑，循环逻辑等等... 但它在编译时，如果一个功能没用到，对应的代码就根本不会被编译到结果里去。这就好像用 "),n("code",[t._v("Babel")]),t._v(" 的时候没有用到的功能的 "),n("code",[t._v("helper")]),t._v(" 是不会被引入的，又好像用 "),n("code",[t._v("lodash")]),t._v(" 或者 "),n("code",[t._v("RxJS")]),t._v(" 的时候只选择性地引入对应的函数。")]),t._v(" "),n("h3",{attrs:{id:"svelte缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#svelte缺点"}},[t._v("#")]),t._v(" svelte缺点")]),t._v(" "),n("ul",[n("li",[t._v("1、生态不够成熟，"),n("code",[t._v("Svelte")]),t._v(" 生态数量仅有 "),n("code",[t._v("Vue 生态的 7.7%，React 的 1.5%")])]),t._v(" "),n("li",[t._v("2、多个组件中会有很多重复的代码，虽然在简单的 "),n("code",[t._v("demo")]),t._v(" 里面代码量确实非常小，但同样的组件模板，这样的 命令式 操作生成的代码量会比 "),n("code",[t._v("vdom 渲染函数")]),t._v("要大，多个组件中会有很多重复的代码"),n("code",[t._v("（虽然 gzip 时候可以缓解，但 parse 是免不了的）")]),t._v("。项目里的组件越多，代码量的差异就会逐渐缩小。同时，并不是真正的如宣传的那样 没有 runtime““，而是根据你的代码按需 "),n("code",[t._v("import")]),t._v(" 而已。使用的功能越多，"),n("code",[t._v("Svelte")]),t._v(" 要包含的运行时代码也越多，最终在实际生产项目中能有多少尺寸优势，其实很难说")]),t._v(" "),n("li",[t._v("3、"),n("code",[t._v("Svelte")]),t._v(" 在大型应用中的性能还有待观察，尤其是在大量动态内容和嵌套组件的情况下")]),t._v(" "),n("li",[t._v("4、"),n("code",[t._v("Svelte")]),t._v("的编译策略决定了它跟 "),n("code",[t._v("Virtual DOM")]),t._v(" 绝缘（渲染函数由于其动态性，无法像模板那样可以被可靠地静态分析），也就享受不到"),n("code",[t._v("Virtual DOM")]),t._v("带来的诸多好处，比如基于 "),n("code",[t._v("render function")]),t._v(" 的组件的强大抽象能力，基于 "),n("code",[t._v("vdom")]),t._v(" 做测试，服务端/原生渲染亲和性等等。")])]),t._v(" "),n("img",{attrs:{src:a(471),alt:"center",height:"150"}}),t._v(" "),n("h3",{attrs:{id:"svelte核心原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#svelte核心原理"}},[t._v("#")]),t._v(" svelte核心原理")]),t._v(" "),n("p",[n("code",[t._v("Svelte")]),t._v(" 没有使用 "),n("code",[t._v("API")]),t._v(" 来创建响应式，那么它是怎么追踪变量的变化呢？")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'world123'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("handleClick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        name "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'你好'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("Hello "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("button on"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("click"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("handleClick"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("点击改变"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("button"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),n("p",[t._v("会被编译为:")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_fragment")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" t0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" t1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" t2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" t3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" button"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" mounted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" dispose"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    \t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("c")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t\th1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("element")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"h1"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\tt0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Hello "')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//变量的值会从ctx中去获取")]),t._v("\n    \t\t\tt1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*name*/")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//会将静态节点和变量之间分开")]),t._v("\n    \t\t\tt2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("text")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"!"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\tt3 "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("space")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\tbutton "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("element")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"button"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\tbutton"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("textContent "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"点击改变"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("m")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t0"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("append")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" t3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" button"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" anchor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("mounted"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//给button绑定点击事件")]),t._v("\n    \t\t\t\tdispose "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"click"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*handleClick*/")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t\tmounted "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("p")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dirty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//通过 dirty 按位与 1 的结果判断是否要更新")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dirty "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*name*/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/*name*/")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("i")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" noop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("o")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" noop"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("d")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("detaching")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detaching"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("detach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("h1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detaching"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("detach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("t3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("detaching"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("detach")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("button"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\tmounted "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t\t"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispose")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    \t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("Svelte")]),t._v("在编译时，会检测所有变量的赋值行为，并将变化后的值和赋值的行为，作为创建片段的参数。")]),t._v(" "),n("p",[t._v("当变量更新时：")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("make_dirty")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" i")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果组件的 dirty[0] 为 -1")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dirty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//需要往脏组件数组中添加，然后更新")]),t._v("\n            dirty_components"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//更新")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("schedule_update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//更新完了，清空脏组件数组")]),t._v("\n            component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dirty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fill")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dirty"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("31")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("schedule_update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("update_scheduled"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            update_scheduled "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//调用flush方法")]),t._v("\n            resolved_promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flush"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//更新")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("flush")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" saved_component "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" current_component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("do")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// first, call beforeUpdate functions")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// and update components")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("while")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flushidx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" dirty_components"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" component "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" dirty_components"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("flushidx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    flushidx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_current_component")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("update")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("component"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("p",[n("code",[t._v("component.$$.dirty")]),t._v("  是什么?")]),t._v(" "),n("p",[t._v("在一个文件中，我们设置一些变量修改，在打印一下"),n("code",[t._v("component.$$.dirty")])]),t._v(" "),n("img",{attrs:{src:a(472),alt:"center",height:"150"}}),t._v(" "),n("p",[t._v("转化成二进制就是:")]),t._v(" "),n("img",{attrs:{src:a(473),alt:"center"}}),t._v(" "),n("p",[t._v("上面数组中的每一项中的每一个比特位，如果是"),n("strong",[t._v("1")]),t._v("，则代表着该数据是否是脏数据。如果是脏数据，则意味着更新。")]),t._v(" "),n("ul",[n("li",[n("p",[t._v('第一行 ["0000000000000000000000000000001", "0000000000000000000000000000000"], 表示第一个数据脏了，需要更新第一个数据对应的dom节点')])]),t._v(" "),n("li",[n("p",[t._v('第二行 ["0000000000000000000000000000011", "0000000000000000000000000000000"], 表示第一个、第二个数据都脏了，需要更新第一个，第二个数据对应的dom节点。')])])]),t._v(" "),n("h3",{attrs:{id:"如何跨框架使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#如何跨框架使用"}},[t._v("#")]),t._v(" 如何跨框架使用")]),t._v(" "),n("p",[t._v("1、如果你查阅 "),n("code",[t._v("Svelte")]),t._v(" 官网，官方建议我们使用 "),n("code",[t._v("SvelteKit")]),t._v(" 创建项目")]),t._v(" "),n("img",{attrs:{src:a(474),alt:"center"}}),t._v(" "),n("p",[n("code",[t._v("SvelteKit")]),t._v(" 为"),n("code",[t._v("Svelte")]),t._v(" 提供了开发完整 "),n("code",[t._v("APP")]),t._v(" 的能力，例如"),n("code",[t._v("router、SSR")]),t._v("等特性。但事实上我们如果开发组件库，是用不上 "),n("code",[t._v("SvelteKit")]),t._v(" 提供的额外功能的。\n因此我们使用 "),n("code",[t._v("Vite")]),t._v(" 提供的脚手架来创建 "),n("code",[t._v("Svelte")]),t._v(" 项目")]),t._v(" "),n("img",{attrs:{src:a(475),alt:"center"}}),t._v(" "),n("p",[t._v("2、"),n("code",[t._v("Vite Config")]),t._v(" 中引入 "),n("code",[t._v("Svelte")]),t._v(" 插件")]),t._v(" "),n("img",{attrs:{src:a(476),alt:"center",height:"150"}}),t._v(" "),n("p",[n("code",[t._v("svelte-preprocess")]),t._v(" 为 "),n("code",[t._v("Svelte")]),t._v(" 扩展了诸多预处理特性，例如在 "),n("code",[t._v("style 中使用 less、sass，global css")]),t._v("等")]),t._v(" "),n("p",[t._v("3、组件打包配置")]),t._v(" "),n("ol",[n("li",[t._v("build 配置中设置为库打包的模式")])]),t._v(" "),n("img",{attrs:{src:a(477),alt:"center",height:"150"}}),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("使用 tsup 打包出类型定义dts")])]),t._v(" "),n("img",{attrs:{src:a(478),alt:"center",height:"150"}}),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("在 package.json 编写打包脚本让 vite和 tsup 同时构建")])]),t._v(" "),n("img",{attrs:{src:a(479),alt:"center",height:"150"}}),t._v(" "),n("p",[t._v("4、如何编译为 "),n("code",[t._v("Web Components")])]),t._v(" "),n("p",[t._v("将 "),n("code",[t._v("Svelte")]),t._v(" 编写的组件编译成 "),n("code",[t._v("Web Components")]),t._v(" 组件非常简单，只需要 :")]),t._v(" "),n("ul",[n("li",[t._v("在 "),n("code",[t._v("svelte")]),t._v(" 插件编译配置中开启 "),n("code",[t._v("Custom Element")])]),t._v(" "),n("li",[t._v("在组件上声明"),n("code",[t._v("svelte:options")]),t._v("，并配置组件名称即可")])]),t._v(" "),n("img",{attrs:{src:a(480),alt:"center",height:"150"}}),t._v(" "),n("img",{attrs:{src:a(481),alt:"center",height:"150"}}),t._v(" "),n("p",[t._v("5、 跨框架组件使用方式")]),t._v(" "),n("img",{attrs:{src:a(482),alt:"center",height:"150"}}),t._v(" "),n("img",{attrs:{src:a(483),alt:"center",height:"150"}}),t._v(" "),n("p",[t._v("6、处理组件传入的 "),n("code",[t._v("Props")])]),t._v(" "),n("ul",[n("li",[n("ol",[n("li",[t._v("通过 svelte/store 全局存储业务系统传入的用户信息和平台信息")])])]),t._v(" "),n("li",[n("ol",{attrs:{start:"2"}},[n("li",[t._v("通过 ConfigProvider 中调用setContext 共享全局配置")])])])]),t._v(" "),n("img",{attrs:{src:a(484),alt:"center"}}),t._v(" "),n("img",{attrs:{src:a(485),alt:"center"}}),t._v(" "),n("p",[t._v("7、如何接收组件事件\n"),n("img",{attrs:{src:a(486),alt:"center"}})]),t._v(" "),n("p",[n("code",[t._v("Svelte")]),t._v(" 打包的组件无法直接在 "),n("code",[t._v("DOM")]),t._v(" 上监听事件，可以调用导入组件实例上的 "),n("code",[t._v("$on")]),t._v(" 方法监听。\n因但因业务需要，我们系统内是将外部事件抛到全局中的")]),t._v(" "),n("img",{attrs:{src:a(487),alt:"center"}}),t._v(" "),n("p",[t._v("8、遇到的问题")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("如何使用原子化 CSS 库\n因为 Scoped 的存在使用 UnoCSS 需要按需使用不同的插件，TailwindCSS 可以使用 PostCSS 后置处理")])]),t._v(" "),n("li",[n("p",[t._v("使用原子化 CSS 导致的样式污染\n使用 PostCSS 插件编译时加前缀的方式解决，但这种方式也导致原子化 CSS类的权重变高，会出现一些问题需要手动处理。")])]),t._v(" "),n("li",[n("p",[t._v("使用原子化 CSS 导致编译为 Web Components 后样式失效\n因为 Web Components 无样式侵入的特点，可以使用 UnoCSS 的 Web Components 模式，或者不用原子化CSS库，只用 scoped style。")])]),t._v(" "),n("li",[n("p",[t._v("打包出的类型枚举在业务系统中导入后 undefined\n需要在vite打包入口中显式导出TS枚举变量，vite会处理为JS对象")])])]),t._v(" "),n("img",{attrs:{src:a(488),alt:"center"}}),t._v(" "),n("h3",{attrs:{id:"建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#建议"}},[t._v("#")]),t._v(" 建议")]),t._v(" "),n("p",[n("strong",[t._v("1. 充分利用编译时性能优势")]),t._v("\n构建轻量级组件库时，发挥 "),n("code",[t._v("Svelte")]),t._v(" 的编译时性能优势，创造高性能、轻便的组件。")]),t._v(" "),n("p",[n("strong",[t._v("2. 状态管理和数据流")]),t._v("\n使用"),n("code",[t._v("Svelte")]),t._v(" 内置的状态管理系统，简化全局状态管理，提高代码可读性和可维护性。")]),t._v(" "),n("p",[n("strong",[t._v("3. 样式处理")]),t._v("\n充分利用 "),n("code",[t._v("Svelte")]),t._v("  的内置 "),n("code",[t._v("Scoped")]),t._v(" 样式功能，避免样式污染问题，提高组件的可重用性和可维护性。")]),t._v(" "),n("p",[n("strong",[t._v("4. 轻松编译成 Web Components")]),t._v("\n利用 "),n("code",[t._v("Svelte")]),t._v("  内置的 "),n("code",[t._v("Custom Elements")]),t._v(" 功能，轻松将组件编译成 "),n("code",[t._v("Web Components")]),t._v("，提高组件的可移植性，便于在不同项目中重用。")])])}),[],!1,null,null,null);s.default=e.exports}}]);