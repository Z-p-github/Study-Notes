<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="前端技术相关的文章，包含不限于vue，react，webpack，nodejs，算法等等">
    
    <link rel="preload" href="/assets/css/0.styles.1bd58bef.css" as="style"><link rel="preload" href="/assets/js/app.126f0258.js" as="script"><link rel="preload" href="/assets/js/2.30bd822f.js" as="script"><link rel="preload" href="/assets/js/10.0a7f23f5.js" as="script"><link rel="preload" href="/assets/js/11.b85d9fb6.js" as="script"><link rel="prefetch" href="/assets/js/12.ed1e11ae.js"><link rel="prefetch" href="/assets/js/13.90e0f4c3.js"><link rel="prefetch" href="/assets/js/14.3a06bb32.js"><link rel="prefetch" href="/assets/js/15.11062623.js"><link rel="prefetch" href="/assets/js/16.690a0ab0.js"><link rel="prefetch" href="/assets/js/17.56fb5d03.js"><link rel="prefetch" href="/assets/js/18.9ef78e2f.js"><link rel="prefetch" href="/assets/js/19.44aed15d.js"><link rel="prefetch" href="/assets/js/20.1520b443.js"><link rel="prefetch" href="/assets/js/21.1ecb9e2c.js"><link rel="prefetch" href="/assets/js/22.9c032f47.js"><link rel="prefetch" href="/assets/js/23.30e66d45.js"><link rel="prefetch" href="/assets/js/24.67f7c144.js"><link rel="prefetch" href="/assets/js/25.430a8b61.js"><link rel="prefetch" href="/assets/js/26.b0b74904.js"><link rel="prefetch" href="/assets/js/27.af28f136.js"><link rel="prefetch" href="/assets/js/28.ca92da75.js"><link rel="prefetch" href="/assets/js/29.cc7e5601.js"><link rel="prefetch" href="/assets/js/3.e545e13e.js"><link rel="prefetch" href="/assets/js/30.524144bb.js"><link rel="prefetch" href="/assets/js/31.8585f27d.js"><link rel="prefetch" href="/assets/js/32.f53bfec9.js"><link rel="prefetch" href="/assets/js/33.13a7ce60.js"><link rel="prefetch" href="/assets/js/34.5d2e856b.js"><link rel="prefetch" href="/assets/js/35.a08d0b95.js"><link rel="prefetch" href="/assets/js/36.66177157.js"><link rel="prefetch" href="/assets/js/37.12e11a01.js"><link rel="prefetch" href="/assets/js/38.0550cd6c.js"><link rel="prefetch" href="/assets/js/39.04ac9ed9.js"><link rel="prefetch" href="/assets/js/4.c18256f0.js"><link rel="prefetch" href="/assets/js/40.8f429f83.js"><link rel="prefetch" href="/assets/js/41.f5e6cf34.js"><link rel="prefetch" href="/assets/js/42.d5e97e1c.js"><link rel="prefetch" href="/assets/js/43.66ac2eb9.js"><link rel="prefetch" href="/assets/js/5.75db888e.js"><link rel="prefetch" href="/assets/js/6.2afba461.js"><link rel="prefetch" href="/assets/js/7.2f4d31d1.js"><link rel="prefetch" href="/assets/js/8.4f713717.js"><link rel="prefetch" href="/assets/js/9.a559d100.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1bd58bef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/doc-front-end" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/Z-p-github/doc-front-end" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">主页</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaScript/小顶堆.html" class="sidebar-link">小顶堆</a></li><li><a href="/JavaScript/位运算.html" class="sidebar-link">位运算</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>React Fiber</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/React-Fiber/React理念.html" class="sidebar-link">React理念</a></li><li><a href="/React/React-Fiber/ReactFiber架构.html" class="sidebar-link">Fiber架构</a></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>React Fiber Render</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/React-Fiber/Fiber-dom-diff/beginWork.html" class="sidebar-link">beginWork阶段</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/completeWork.html" class="sidebar-link">completeWork阶段</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/commit.html" class="sidebar-link">commit阶段</a></li><li><a href="/React/React-Fiber/Fiber-dom-diff/domdiff.html" class="sidebar-link">completeWork-diff阶段</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>Concurrent Mode</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/React/Concurrent-Mode/React中的事件优先级调度.html" class="sidebar-link">React事件优先级调度</a></li><li><a href="/React/Concurrent-Mode/scheduler.html" class="sidebar-link">scheduler具体实现</a></li><li><a href="/React/Concurrent-Mode/lane.html" class="sidebar-link">lane模型</a></li></ul></section></li><li><a href="/React/React17.html" class="sidebar-link">React17</a></li><li><a href="/React/React18.html" class="sidebar-link">React18</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/Vue/Vue3+Typescript实现Form组件.html" class="sidebar-link">Vue3+Typescript实现Form组件</a></li><li><a href="/Vue/搭建vue3和ts组件库开发环境.html" class="sidebar-link">搭建vue3和ts组件库开发环境</a></li><li><a href="/Vue/Vite2配置项目开发环境.html" class="sidebar-link">Vite2配置项目开发环境</a></li><li><a href="/Vue/基于Element-plus实现虚拟下拉组件.html" class="active sidebar-link">基于Element-plus实现虚拟下拉组件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/Vue/基于Element-plus实现虚拟下拉组件.html#虚拟滚动思路" class="sidebar-link">虚拟滚动思路</a></li><li class="sidebar-sub-header"><a href="/Vue/基于Element-plus实现虚拟下拉组件.html#使用方式" class="sidebar-link">使用方式</a></li><li class="sidebar-sub-header"><a href="/Vue/基于Element-plus实现虚拟下拉组件.html#实现-virtual-list" class="sidebar-link">实现 virtual-list</a></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端生态</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/前端生态/eslint.html" class="sidebar-link">eslint</a></li><li><a href="/前端生态/flutter实践.html" class="sidebar-link">flutter实践</a></li><li><a href="/前端生态/flutter消息推送.html" class="sidebar-link">flutter消息推送</a></li><li><a href="/前端生态/antd5架构分析.html" class="sidebar-link">antd5研究</a></li><li><a href="/前端生态/element-plus架构分析.html" class="sidebar-link">element-plus样式+打包分析</a></li><li><a href="/前端生态/ts类型打包.html" class="sidebar-link">ts类型打包</a></li><li><a href="/前端生态/vscode扩展工具.html" class="sidebar-link">vscode扩展工具实现</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>go</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/go/mac如何安装grpc.html" class="sidebar-link">mac安装grpc</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>最近在项目中，遇到一个渲染的性能问题，就是有一个下拉组件会请求几千条数据回来，然后在<code>element-ui</code> 的下拉组件中渲染出来，发现这个渲染的过程中，性能非常的糟糕，页面会出现卡顿，因为 <code>element-ui</code> 目前的 <code>Select</code> 组件没有做虚拟滚动，所以没办法就只能自己搞一个了，下面我就来说说我的实现方式。</p> <h2 id="虚拟滚动思路"><a href="#虚拟滚动思路" class="header-anchor">#</a> 虚拟滚动思路</h2> <p>我们可以单独封装一个虚拟列表的组件，然后将我们需要处理成虚拟滚动的<code>Select</code>组件包裹一下就可以了，这样子不仅做到了组件之间的解耦，也方便后续的一个维护</p> <p>那么虚拟列表主要分为三个部分：</p> <img src="/assets/img/virtual.65a7737d.png" alt="form-list" width="300"> <ul><li>最外层的容器<code>scroll-container</code>，主要用来做滚动列表的外层的容器，需要进行滚动</li> <li><code>scroll-bar</code>，盒子的高度是根据具体的总数据量计算出来的，主要是目的是为了撑开 <code>scroll-container</code> ，让<code>scroll-container</code>出现对应高度的滚动条，可以进行滚动</li> <li><code>scroll-list</code>，存放所有被渲染的出来的下拉选项的盒子，他需要根据 外层<code>scroll-container</code>的滚动做向上或者向下的偏移运动</li></ul> <h2 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h2> <p>我们可以先来看看使用方式，下面是一个封装的下拉组件，里面引入的<code>virtual-list</code>组件，和原始的<code>el-select</code>使用方式不同的是，<code>el-option</code>不再是通过<code>v-for</code>循环出来的，而是通过我们的<code>virtual-list</code>组件的插槽渲染出来的</p> <p><code>filterValue</code> 是我的组件需要支持输入过滤加的，如果不需要的就不用加</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>el<span class="token operator">-</span>select <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;props.modelValue&quot;</span>  @change<span class="token operator">=</span><span class="token string">&quot;handleChange&quot;</span> v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;props&quot;</span> <span class="token operator">:</span>popper<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;$style.virtual_select&quot;</span> <span class="token operator">:</span>filter<span class="token operator">-</span>method<span class="token operator">=</span><span class="token string">&quot;filterItems&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>virtual<span class="token operator">-</span>list <span class="token operator">:</span>items<span class="token operator">=</span><span class="token string">&quot;filterDatas&quot;</span> <span class="token operator">:</span>remain<span class="token operator">=</span><span class="token string">&quot;props.remain&quot;</span> <span class="token operator">:</span>size<span class="token operator">=</span><span class="token string">&quot;props.size&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>template #<span class="token keyword">default</span><span class="token operator">=</span><span class="token string">&quot;{ node }&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>el<span class="token operator">-</span>option
            <span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">&quot;node.value&quot;</span>
            <span class="token operator">:</span>label<span class="token operator">=</span><span class="token string">&quot;node.label&quot;</span>
            <span class="token operator">:</span>key<span class="token operator">=</span><span class="token string">&quot;node.value&quot;</span>
          <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>option<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>virtual<span class="token operator">-</span>list<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>el<span class="token operator">-</span>select<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script lang<span class="token operator">=</span><span class="token string">&quot;ts&quot;</span> setup<span class="token operator">&gt;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> VirtualSelectProps<span class="token punctuation">,</span>selectEmits <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./VirtualSelectProps&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> type <span class="token punctuation">{</span> OptionType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./VirtualSelectProps&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> VirtualList <span class="token keyword">from</span> <span class="token string">&quot;@/components/virtual-list&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> toRef<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> computed<span class="token punctuation">,</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">defineProps</span><span class="token punctuation">(</span>VirtualSelectProps<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span>selectEmits<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">defineOptions</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;VirtualSelect&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">inheritAttrs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">filterValue</span><span class="token operator">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">value</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token literal-property property">options</span><span class="token operator">:</span> Ref<span class="token operator">&lt;</span>OptionType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">|</span> any<span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token function">toRef</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token string">&quot;options&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> filterDatas <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//过滤</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span>filterValue<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> options<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> options<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">item</span><span class="token operator">:</span>OptionType</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> item<span class="token punctuation">.</span>label<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>filterValue<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">filterItems</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span>string</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>filterValue  <span class="token operator">=</span> value
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleChange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">val</span><span class="token operator">:</span>string</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">//vue3中触发值的更新</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'update:modelValue'</span><span class="token punctuation">,</span>val<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>style  lang<span class="token operator">=</span><span class="token string">&quot;scss&quot;</span> module<span class="token operator">&gt;</span>
<span class="token punctuation">.</span>virtual_select<span class="token punctuation">{</span>
    <span class="token operator">:</span>global <span class="token punctuation">.</span>el<span class="token operator">-</span>scrollbar__bar<span class="token punctuation">.</span>is<span class="token operator">-</span>vertical <span class="token punctuation">{</span>
        <span class="token literal-property property">display</span><span class="token operator">:</span> none <span class="token operator">!</span>important<span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token operator">:</span>global <span class="token punctuation">.</span>el<span class="token operator">-</span>scrollbar__wrap <span class="token punctuation">{</span>
      <span class="token literal-property property">overflow</span><span class="token operator">:</span> hidden<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>

</code></pre></div><h2 id="实现-virtual-list"><a href="#实现-virtual-list" class="header-anchor">#</a> 实现 <code>virtual-list</code></h2> <p>现在我们来定义 <code>virtual-list</code>的<code>html</code>结构，这里我是使用的<code>Vue3</code>的<code>jsx</code>的写法做的</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;VirtualList&quot;</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> slots <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-bar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">这里面存放list</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>接下来我们需要定义<code>VirtualList</code>组件需要接受的<code>props</code></p> <ul><li>items：所有的需要渲染的数据，是一个数组</li> <li>remain：需要在滚动的区域内展示多少个选项，默认为 8 个</li> <li>size： 每一个下拉项的高度大小，默认为 34（参考的 element-ui 的 select 组件）</li></ul> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> defineComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;VirtualList&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">size</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">34</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">remain</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Array<span class="token punctuation">,</span>
      <span class="token function-variable function">default</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> slots <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-bar<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">这里面存放list</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>首先，我们在初始化的时候就需要去设置 <code>scroll-container</code> 和 <code>scroll-bar</code> 的高度，并且需要给<code>scroll-container</code> 绑定一个<code>onScroll</code>方法</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineComponent</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> slots <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapperRef <span class="token operator">=</span> ref<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLElement</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">();
    const barRef = ref</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">HTMLElement</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">();
    function initWrapper() </span><span class="token punctuation">{</span>
      wrapperRef<span class="token punctuation">.</span>value<span class="token operator">!</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> props<span class="token punctuation">.</span>remain <span class="token operator">*</span> props<span class="token punctuation">.</span>size <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span><span class="token comment">//实际显示的高度</span>
      barRef<span class="token punctuation">.</span>value<span class="token operator">!</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>height <span class="token operator">=</span> props<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">*</span> props<span class="token punctuation">.</span>size <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span><span class="token punctuation">;</span><span class="token comment">//总高度</span>
    <span class="token punctuation">}</span><span class="token plain-text">
    watch(() =&gt; props.items, initWrapper);
    return () =&gt; </span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-container<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>wrapperRef<span class="token punctuation">}</span></span> <span class="token attr-name">onScroll</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleScroll<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
           </span><span class="token punctuation">{</span><span class="token comment">/* 就是模拟总长度，感觉好像很多数据 */</span><span class="token punctuation">}</span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-bar<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>barRef<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>scroll-list<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">这里面存放list</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token plain-text">;
  },
})

</span></code></pre></div><p>接下来，我们就需要去计算页面上面需要渲染的数据，然后再通过作用域插槽传递数据进行渲染</p> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token function">setup</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> <span class="token punctuation">{</span> slots <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 计算显示的区域</span>
      <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token literal-property property">end</span><span class="token operator">:</span> props<span class="token punctuation">.</span>remain<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> visibleData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">//其实就是去截取数据</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>start<span class="token punctuation">,</span> state<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;scroll-container&quot;</span><span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;scroll-bar&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;scroll-list&quot;</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>visibleData<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> slots<span class="token punctuation">.</span>default<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span> node <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>这个时候应该就可以渲染出来下拉选项了
<img src="/assets/img/select.62d00f20.png" alt="select" width="300"></p> <p>滚动的时候，我们需要<code>scroll-list</code>组件进行相应的平移，所以需要去增加列表滚动的相关操作</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> <span class="token literal-property property">handleScroll</span><span class="token operator">:</span> <span class="token function-variable function">any</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 根据当前滚动的距离 来算，过去了几个数据</span>
      <span class="token keyword">const</span> scrollTop <span class="token operator">=</span> wrapperRef<span class="token punctuation">.</span>value<span class="token operator">!</span><span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
      <span class="token keyword">const</span> slidePrev <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>scrollTop <span class="token operator">/</span> props<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 划过去了多少个</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> slidePrev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>start <span class="token operator">=</span> slidePrev<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      state<span class="token punctuation">.</span>end <span class="token operator">=</span> state<span class="token punctuation">.</span>start <span class="token operator">+</span> props<span class="token punctuation">.</span>remain<span class="token punctuation">;</span><span class="token comment">//末尾结束的位置</span>
         <span class="token comment">//设置sroll-list的偏移量</span>
      offset<span class="token punctuation">.</span>value <span class="token operator">=</span> state<span class="token punctuation">.</span>start <span class="token operator">*</span> props<span class="token punctuation">.</span>size<span class="token punctuation">;</span> <span class="token comment">// 滚过去了多少个</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这个时候其实已经可以进行滚动渲染了，但是你会发现，在滚动的时候，顶部或者底部会有一小段间隔，让整个滚动看着不是特别流畅</p> <img src="/assets/img/select-space.6bb6fec7.png" alt="select-space" width="300"> <p>原因： 是因为在滚动的过程中，会去计算即将要渲染出来的数据，由于滚动的触发频率比较快，所以可能在渲染的时候就有会一丝延迟</p> <p>解决办法：</p> <p>我们可以在前面和后面分别补充一些数据，这样子，我滚动的时候是已经渲染过的数据，整个滚动的过程就会比较流畅</p> <p>修改代码</p> <div class="language-js extra-class"><pre class="language-js"><code>   <span class="token keyword">const</span> offset <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//前面的数据</span>
    <span class="token keyword">const</span> prev <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当前开始第四条</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>start<span class="token punctuation">,</span> props<span class="token punctuation">.</span>remain<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//后面的数据</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>props<span class="token punctuation">.</span>remain<span class="token punctuation">,</span> props<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">-</span> state<span class="token punctuation">.</span>end<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 这里应该多展示 上8条和下8条，保证用户在快速滚动的时候 不会白屏</span>
    <span class="token keyword">const</span> visibleData <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> result <span class="token operator">=</span> props<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>
        state<span class="token punctuation">.</span>start <span class="token operator">-</span> prev<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        state<span class="token punctuation">.</span>end <span class="token operator">+</span> next<span class="token punctuation">.</span>value
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 上下都补点</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token keyword">const</span> <span class="token literal-property property">handleScroll</span><span class="token operator">:</span> <span class="token function-variable function">any</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 根据当前滚动的距离 来算，过去了几个数据</span>
      <span class="token keyword">const</span> scrollTop <span class="token operator">=</span> wrapperRef<span class="token punctuation">.</span>value<span class="token operator">!</span><span class="token punctuation">.</span>scrollTop<span class="token punctuation">;</span>
      <span class="token keyword">const</span> slidePrev <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>scrollTop <span class="token operator">/</span> props<span class="token punctuation">.</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 划过去了多少个</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> slidePrev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>start <span class="token operator">=</span> slidePrev<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        state<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      state<span class="token punctuation">.</span>end <span class="token operator">=</span> state<span class="token punctuation">.</span>start <span class="token operator">+</span> props<span class="token punctuation">.</span>remain<span class="token punctuation">;</span>
      <span class="token comment">//设置sroll-list的偏移量</span>
      offset<span class="token punctuation">.</span>value <span class="token operator">=</span> state<span class="token punctuation">.</span>start <span class="token operator">*</span> props<span class="token punctuation">.</span>size <span class="token operator">-</span> props<span class="token punctuation">.</span>size <span class="token operator">*</span> prev<span class="token punctuation">.</span>value<span class="token punctuation">;</span> <span class="token comment">// 滚过去了多少个</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;scroll-container&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>wrapperRef<span class="token punctuation">}</span> onScroll<span class="token operator">=</span><span class="token punctuation">{</span>handleScroll<span class="token punctuation">}</span><span class="token operator">&gt;</span>
           <span class="token punctuation">{</span><span class="token comment">/* 就是模拟总长度，感觉好像很多数据 */</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;scroll-bar&quot;</span> ref<span class="token operator">=</span><span class="token punctuation">{</span>barRef<span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
          <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;scroll-list&quot;</span>  style<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token literal-property property">transform</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translate3d(0,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>offset<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px,0)</span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
            <span class="token punctuation">{</span>visibleData<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> slots<span class="token punctuation">.</span>default<span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">{</span> node <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>这个时候我们就可以正常的滚动和渲染了</p> <p>如果我们的组件有支持过滤的功能，需要监听一下 <code>filterValue</code>属性，在这个属性变更的时候重置一下<code>start</code>的值</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span>filterValue<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">.</span>filterValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      state<span class="token punctuation">.</span>start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以上我的虚拟下拉组件就完成了 ✌️</p></div> <footer class="page-edit"><!----> <!----></footer> <div><div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/Vue/Vite2配置项目开发环境.html" class="prev">
        Vite2配置项目开发环境
      </a></span> <span class="next"><a href="/前端生态/eslint.html">
        eslint
      </a>
      →
    </span></p></div> <div class="icp-footer"><p>Copyright© 2022-2023 _妄想何方</p> <a href="https://beian.miit.gov.cn/" target="_blank">蜀ICP备2022010321号-1</a></div></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.126f0258.js" defer></script><script src="/assets/js/2.30bd822f.js" defer></script><script src="/assets/js/10.0a7f23f5.js" defer></script><script src="/assets/js/11.b85d9fb6.js" defer></script>
  </body>
</html>
